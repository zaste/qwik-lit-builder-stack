import{c as O,i as y,u as Le,b as t,d as $,e as R,L as me,f as ae,g as S,S as Y,h as ie,j as w,k as z,l as g,m as C,n as P,o as Ee,r as ue,F as Fe,p as Ie,R as ze}from"./q-BFBoRxOI.js";import{createClient as Z}from"@supabase/supabase-js";import{z as _}from"zod";import j from"dompurify";class Ue{constructor(e={}){this.logQueue=[],this.flushInterval=5e3,this.maxQueueSize=100,this.config={level:"info",service:"qwik-lit-builder",version:"1.0.0",environment:"development",enableConsole:!0,enableRemote:!1,...e},this.startFlushTimer()}levelToNumber(e){return{debug:0,info:1,warn:2,error:3,critical:4}[e]}shouldLog(e){return this.levelToNumber(e)>=this.levelToNumber(this.config.level)}get configuration(){return this.config}createLogEntry(e,l,s,a){const r={timestamp:new Date().toISOString(),level:e,message:l,context:{service:this.config.service,version:this.config.version,environment:this.config.environment,...s}};return typeof window<"u"&&(r.route=window.location.pathname,r.userAgent=navigator.userAgent),a&&(r.stack=a.stack,r.context={...r.context,errorName:a.name,errorMessage:a.message}),r}logToConsole(e){if(!this.config.enableConsole)return;const l=e.level==="critical"||e.level==="error"?"error":e.level==="warn"?"warn":"log",s=`[${e.timestamp}] [${e.level.toUpperCase()}]`;this.config.environment==="development"?console[l](`${s} ${e.message}`,e.context):console[l](JSON.stringify(e))}queueForRemote(e){if(this.config.enableRemote){if(this.logQueue.push(e),e.level==="critical"){this.flushLogs();return}this.logQueue.length>=this.maxQueueSize&&this.flushLogs()}}startFlushTimer(){typeof window>"u"||(this.flushTimer=window.setInterval(()=>{this.flushLogs()},this.flushInterval))}async flushLogs(){if(this.logQueue.length===0)return;const e=[...this.logQueue];this.logQueue=[];try{this.config.remoteEndpoint&&typeof fetch<"u"&&await fetch(this.config.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:e})})}catch{this.logQueue.length<this.maxQueueSize&&this.logQueue.unshift(...e.slice(0,this.maxQueueSize-this.logQueue.length))}}log(e,l,s,a){if(!this.shouldLog(e))return;const r=this.createLogEntry(e,l,s,a);this.logToConsole(r),this.queueForRemote(r)}debug(e,l){this.log("debug",e,l)}info(e,l){this.log("info",e,l)}warn(e,l){this.log("warn",e,l)}error(e,l,s){this.log("error",e,l,s)}critical(e,l,s){this.log("critical",e,l,s)}apiCall(e,l,s,a,r){this.info(`API ${e} ${l}`,{...r,method:e,url:l,statusCode:s,duration:a,type:"api_call"})}userAction(e,l,s){this.info(`User action: ${e}`,{...s,userId:l,action:e,type:"user_action"})}performance(e,l,s){this.info(`Performance: ${e}`,{...s,metric:e,value:l,type:"performance"})}security(e,l,s){const a=l==="critical"?"critical":l==="high"?"error":l==="medium"?"warn":"info";this.log(a,`Security event: ${e}`,{...s,event:e,severity:l,type:"security"})}destroy(){this.flushTimer&&clearInterval(this.flushTimer),this.flushLogs()}}const p=new Ue({level:process.env.NODE_ENV==="production"?"info":"debug",environment:process.env.NODE_ENV==="production"?"production":process.env.NODE_ENV==="staging"?"staging":"development",enableRemote:process.env.NODE_ENV==="production",remoteEndpoint:"/api/logs"});typeof window<"u"&&window.addEventListener("beforeunload",()=>{p.destroy()});const je={enableCSP:!0,enableHSTS:!0,enableFrameGuard:!0,enableContentTypeNoSniff:!0,enableReferrerPolicy:!0,enablePermissionsPolicy:!0,corsOrigins:["http://localhost:5176","https://*.pages.dev"],rateLimitWindowMs:9e5,rateLimitMaxRequests:100};function Be(n=!1){const e=typeof process<"u"&&process.env.CODESPACES==="true",l={"default-src":["'self'"],"script-src":["'self'","'unsafe-inline'","https://cdn.jsdelivr.net","https://unpkg.com","https://*.supabase.co",...n?["'unsafe-eval'"]:[]],"style-src":["'self'","'unsafe-inline'","https://fonts.googleapis.com","https://cdn.jsdelivr.net"],"img-src":["'self'","data:","blob:","https:","https://*.supabase.co","https://*.cloudflare.com","https://*.githubusercontent.com"],"font-src":["'self'","https://fonts.gstatic.com","https://cdn.jsdelivr.net"],"connect-src":["'self'","https://*.supabase.co","https://*.cloudflare.com","https://*.sentry.io","wss://*.supabase.co","https://api.github.com",...n?["ws://localhost:*","http://localhost:*"]:[]],"frame-src":["'self'"],"worker-src":["'self'","blob:"],"manifest-src":["'self'",...e?["https://github.dev","https://*.github.dev"]:[]],"media-src":["'self'","https://*.supabase.co","https://*.cloudflare.com"],"object-src":["'none'"],"base-uri":["'self'"],"form-action":["'self'"],"frame-ancestors":["'none'"]},s=Object.entries(l).map(([a,r])=>`${a} ${r.join(" ")}`).join("; ");return n?s:`${s}; upgrade-insecure-requests`}async function qe(n,e){try{if(!n.KV)return p.warn("KV not available, rate limiting disabled"),null;const l=await n.KV.get(e);return l?JSON.parse(l):null}catch(l){return p.error("Failed to get rate limit data from KV",{key:e,error:l instanceof Error?l.message:String(l)}),null}}async function he(n,e,l){try{if(!n.KV)return;const s=Math.max(1,Math.ceil((l.resetTime-Date.now())/1e3));await n.KV.put(e,JSON.stringify(l),{expirationTtl:s})}catch(s){p.error("Failed to set rate limit data in KV",{key:e,error:s instanceof Error?s.message:String(s)})}}function J(n){return`rate_limit:${n.headers.get("cf-connecting-ip")||n.headers.get("x-forwarded-for")||n.headers.get("x-real-ip")||"unknown"}`}async function Ne(n,e,l){const s=J(n),a=Date.now(),r=a-e.rateLimitWindowMs,o=await qe(l,s);if(!o||o.resetTime<r){const i={count:1,resetTime:a+e.rateLimitWindowMs};return await he(l,s,i),!0}return o.count>=e.rateLimitMaxRequests?(p.security("Rate limit exceeded","medium",{ip:s,currentCount:o.count,maxRequests:e.rateLimitMaxRequests,windowMs:e.rateLimitWindowMs}),!1):(o.count++,await he(l,s,o),!0)}const Ge=async({headers:n,request:e,next:l,json:s,platform:a})=>{const r=a==null?void 0:a.env,o=je,i=process.env.NODE_ENV==="development",u=Date.now();try{if(!i&&r&&!await Ne(e,o,r))throw p.security("Rate limit exceeded","medium",{ip:J(e),userAgent:e.headers.get("user-agent"),path:new URL(e.url).pathname}),s(429,{error:"Rate limit exceeded",retryAfter:Math.ceil(o.rateLimitWindowMs/1e3)});o.enableFrameGuard&&n.set("X-Frame-Options","DENY"),o.enableContentTypeNoSniff&&n.set("X-Content-Type-Options","nosniff"),o.enableReferrerPolicy&&n.set("Referrer-Policy","strict-origin-when-cross-origin"),o.enablePermissionsPolicy&&n.set("Permissions-Policy","camera=(), microphone=(), geolocation=(), payment=(), usb=()"),o.enableHSTS&&!i&&n.set("Strict-Transport-Security","max-age=31536000; includeSubDomains; preload"),o.enableCSP&&n.set("Content-Security-Policy",Be(i)),n.set("X-DNS-Prefetch-Control","off"),n.set("X-Download-Options","noopen"),n.set("X-Permitted-Cross-Domain-Policies","none"),n.set("Cross-Origin-Embedder-Policy","require-corp"),n.set("Cross-Origin-Opener-Policy","same-origin"),n.set("Cross-Origin-Resource-Policy","same-origin"),await l();const c=Date.now()-u;c>1e3&&p.security("Slow request detected","low",{method:e.method,path:new URL(e.url).pathname,duration:c,ip:J(e)})}catch(c){const m={error:c instanceof Error?c.message:String(c),stack:c instanceof Error?c.stack:void 0,method:e.method,path:new URL(e.url).pathname,ip:J(e),timestamp:new Date().toISOString(),env:{hasKV:!!(r!=null&&r.KV),nodeEnv:process.env.NODE_ENV,kvType:typeof(r==null?void 0:r.KV)}};throw p.security("Security middleware error - DETAILED","high",m),console.error("SECURITY MIDDLEWARE ERROR DETAILS:",JSON.stringify(m,null,2)),c}},Ve=async({request:n,headers:e,next:l})=>{const s=n.headers.get("origin"),a=["http://localhost:5173","http://localhost:4173","https://localhost:5173",process.env.SITE_URL,/https:\/\/.*\.github\.dev$/,/https:\/\/.*\.vercel\.app$/,/https:\/\/.*\.pages\.dev$/].filter(Boolean);if(s&&a.some(o=>typeof o=="string"?o===s:o&&typeof o.test=="function"?o.test(s):!1)&&(e.set("Access-Control-Allow-Origin",s),e.set("Access-Control-Allow-Credentials","true")),n.method==="OPTIONS"){e.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.set("Access-Control-Allow-Headers","Content-Type, Authorization, X-Requested-With"),e.set("Access-Control-Max-Age","86400");return}await l()},He=async n=>{await Ge(n),n.pathname.startsWith("/api/")&&await Ve(n)},We=Object.freeze(Object.defineProperty({__proto__:null,onRequest:He},Symbol.toStringTag,{value:"Module"})),Ke=()=>{const e=Le().url.pathname,l=[{path:"/dashboard",label:"🏠 Dashboard",description:"System overview and real-time stats",status:"live"},{path:"/dashboard/analytics",label:"📈 Analytics",description:"Real database metrics and performance",status:"live"},{path:"/dashboard/media",label:"📁 Media",description:"Cloudflare R2 file storage",status:"live"},{path:"/dashboard/components",label:"🧩 Components",description:"LIT Web Components with Spectrum tokens",status:"live"},{path:"/dashboard/posts",label:"📝 Posts",description:"Content management with Supabase",status:"live"},{path:"/dashboard/pages",label:"📄 Pages",description:"Content pages (basic implementation)",status:"basic"}];return t("div",null,{class:"min-h-screen bg-gray-50"},[t("nav",null,{class:"bg-white shadow-sm border-b"},t("div",null,{class:"container"},[t("div",null,{class:"flex items-center justify-between py-4"},[t("div",null,{class:"flex items-center space-x-4"},[$(me,{href:"/",class:"text-2xl font-bold text-blue-600 hover:text-blue-700",children:"🚀 Production Platform",[R]:{href:R,class:R}},3,"ya_0"),t("span",null,{class:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full"},"✅ LIVE",3,null)],1,null),t("div",null,{class:"flex items-center space-x-4"},[t("span",null,{class:"text-sm text-gray-500"},"Real-time system status",3,null),t("a",null,{href:"/api/health",target:"_blank",class:"text-green-600 hover:text-green-700 text-sm font-medium"},"Health Check →",3,null)],3,null)],1,null),t("div",null,{class:"flex space-x-1 pb-4"},l.map(s=>$(me,{get href(){return s.path},class:`relative flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${e===s.path?"bg-blue-100 text-blue-700 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,get title(){return s.description},children:[t("span",null,null,S(s,"label"),1,null),s.status==="live"&&t("span",null,{class:"w-2 h-2 bg-green-500 rounded-full"},null,3,"ya_1"),s.status==="basic"&&t("span",null,{class:"w-2 h-2 bg-yellow-500 rounded-full"},null,3,"ya_2")],[R]:{href:ae(s,"path"),title:ae(s,"description")}},1,s.path)),1,null)],1,null),1,null),t("main",null,{class:"container py-8"},$(Y,null,3,"ya_3"),1,null)],1,"ya_4")},Qe=O(y(Ke,"s_spkpV1Js00Y")),Je=Object.freeze(Object.defineProperty({__proto__:null,default:Qe},Symbol.toStringTag,{value:"Module"}));let se=null;function M(){return se||(se=Z("https://wprgiqjcabmhhmwmurcp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwcmdpcWpjYWJtaGhtd211cmNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMDM3NTUsImV4cCI6MjA2NjY3OTc1NX0.Q_teLY9vCvBElFVaJpIJzcXTJ_HBQdBgBGcMIeqFRoo",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{headers:{"x-application-name":"qwik-lit-builder"}},realtime:{params:{eventsPerSecond:10}}})),se}const ce={async signIn(n,e){const l=M();return l?l.auth.signInWithPassword({email:n,password:e}):{data:null,error:new Error("Supabase not available")}},async signUp(n,e,l){const s=M();return s?s.auth.signUp({email:n,password:e,options:{data:l}}):{data:null,error:new Error("Supabase not available")}},async signInWithOAuth(n){const e=M();if(!e)throw new Error("Supabase client not available");return e.auth.signInWithOAuth({provider:n,options:{redirectTo:`${window.location.origin}/auth/callback`}})},async signInWithMagicLink(n){const e=M();return e?e.auth.signInWithOtp({email:n,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}}):{data:null,error:new Error("Supabase not available")}},async signOut(){const n=M();return n?n.auth.signOut():{error:null}},async getSession(){const n=M();return n?n.auth.getSession():{data:{session:null},error:null}},async getUser(){const n=M();return n?n.auth.getUser():{data:{user:null},error:null}},onAuthStateChange(n){const e=M();return e?e.auth.onAuthStateChange(n):{data:{subscription:{unsubscribe:()=>{}}}}}};async function X(n){const e=M();if(!e)throw new Error("Supabase client not available - check configuration");const l=n.get("sb-auth-token");if(!l)return null;try{const{data:{user:s}}=await e.auth.getUser(l.value);return s}catch{return null}}function Ce(n){n.delete("sb-auth-token",{path:"/"})}const Ye=Object.freeze(Object.defineProperty({__proto__:null,clearSession:Ce,getCurrentUser:X},Symbol.toStringTag,{value:"Module"})),Ze=async({cookie:n,redirect:e,next:l})=>{if(!await X(n))throw e(302,"/login");try{await l()}catch{throw Ce(n),e(302,"/login")}},Xe=Ze,et=()=>t("div",null,{class:"app-layout"},t("div",null,{class:"flex h-screen bg-gray-50"},[t("aside",null,{class:"w-64 bg-white shadow-sm"},[t("div",null,{class:"p-4"},t("h2",null,{class:"text-lg font-semibold text-gray-900"},"Dashboard",3,null),3,null),t("nav",null,{class:"mt-4"},[t("a",null,{href:"/dashboard",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},"Overview",3,null),t("a",null,{href:"/dashboard/posts",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},"Posts",3,null),t("a",null,{href:"/dashboard/media",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},"Media",3,null),t("a",null,{href:"/dashboard/settings",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},"Settings",3,null)],3,null)],3,null),t("main",null,{class:"flex-1 overflow-y-auto"},t("div",null,{class:"p-8"},$(Y,null,3,"qu_0"),1,null),1,null)],1,null),1,"qu_1"),tt=O(y(et,"s_0GWINbuBB7E")),lt=Object.freeze(Object.defineProperty({__proto__:null,default:tt,onRequest:Xe},Symbol.toStringTag,{value:"Module"})),st=(n,e)=>{const[l,s,a]=P();a.value=!0,s.value=n.message,l.value=e,import("./q-Ci-oPvrI.js").then(({handleUIError:r})=>{r(n,{metadata:{component:"ErrorBoundary",details:e}})}).catch(r=>{p.error("Failed to load error handler",{error:r instanceof Error?r.message:String(r)})})},nt=({track:n})=>{const[e]=P();n(()=>e.value)},at=()=>{const[n]=P();if(typeof window<"u"){const e=s=>{n(s.error||new Error(s.message),{filename:s.filename,lineno:s.lineno,colno:s.colno})},l=s=>{n(new Error(s.reason),{type:"unhandledrejection",reason:s.reason})};return window.addEventListener("error",e),window.addEventListener("unhandledrejection",l),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",l)}}},rt=n=>{ie();const e=w(!1),l=w(""),s=w(null),a=y(st,"s_ca8NcdAAFlg",[s,l,e]);return z(y(nt,"s_td3CAKTRFPQ",[e])),e.value&&n.onError&&queueMicrotask(()=>{var o;const r=new Error(l.value);(o=n.onError)==null||o.call(n,r,s.value)}),z(y(at,"s_ssUYr8QvGrs",[a])),e.value?n.fallback?n.fallback:t("div",null,{class:"error-boundary"},t("div",null,{class:"bg-red-50 border border-red-200 rounded-lg p-6 m-4"},[t("div",null,{class:"flex items-center mb-4"},[t("svg",null,{class:"w-6 h-6 text-red-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t("path",null,{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"},null,3,null),3,null),t("h3",null,{class:"text-lg font-semibold text-red-800"},"Something went wrong",3,null)],3,null),t("p",null,{class:"text-red-700 mb-4"},"We encountered an unexpected error. The error has been reported and our team will investigate.",3,null),t("details",null,{class:"mb-4"},[t("summary",null,{class:"cursor-pointer text-red-600 hover:text-red-800 font-medium"},"Error Details",3,null),t("div",null,{class:"mt-2 p-3 bg-red-100 rounded border font-mono text-sm text-red-800"},[t("p",null,null,[t("strong",null,null,"Message:",3,null)," ",g(r=>r.value,[l],"p0.value")],3,null),s.value&&t("pre",null,{class:"mt-2 whitespace-pre-wrap overflow-x-auto"},JSON.stringify(s.value,null,2),1,"OV_0")],1,null)],1,null),t("div",null,{class:"flex gap-3"},[t("button",null,{class:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors",onClick$:C("s_NKJGUpOkD7g",[s,l,e])},"Try Again",3,null),t("button",null,{class:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors",onClick$:C("s_oZpj050doXE")},"Go Home",3,null)],3,null)],1,null),1,"OV_1"):(re.reportError=a,$(Y,null,3,"OV_2"))},re=O(y(rt,"s_sV00tvE05gA")),ot=async()=>{},it=()=>(Ee(C("s_9qLjiAMeM8U")),$(re,{children:[t("nav",null,{class:"bg-white shadow-sm border-b border-gray-200"},t("div",null,{class:"container"},t("div",null,{class:"flex justify-between h-16"},[t("div",null,{class:"flex items-center"},t("a",null,{href:"/",class:"text-xl font-bold text-gray-900"},["🚀 ",t("span",null,{class:"text-blue-600"},"Qwik + LIT",3,null)," Production Stack"],3,null),3,null),t("div",null,{class:"flex items-center space-x-6"},[t("a",null,{href:"/",class:"text-gray-600 hover:text-gray-900 font-medium"},"Home",3,null),t("a",null,{href:"/dashboard",class:"text-gray-600 hover:text-gray-900 font-medium"},"📊 Dashboard",3,null),t("a",null,{href:"/dashboard/analytics",class:"text-gray-600 hover:text-gray-900 font-medium"},"📈 Analytics",3,null),t("a",null,{href:"/dashboard/media",class:"text-gray-600 hover:text-gray-900 font-medium"},"📁 Media",3,null),t("a",null,{href:"/api/health",target:"_blank",class:"text-green-600 hover:text-green-700 font-medium"},"💚 Health",3,null),t("a",null,{href:"/login",class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium transition-colors"},"🔐 Demo Login",3,null)],3,null)],3,null),3,null),3,null),t("main",null,{class:"min-h-screen"},$(re,{children:$(Y,null,3,"LZ_0")},1,"LZ_1"),1,null),t("footer",null,{class:"bg-gradient-to-r from-gray-50 to-gray-100 mt-12"},t("div",null,{class:"container py-8"},t("div",null,{class:"text-center"},[t("p",null,{class:"text-lg font-semibold text-gray-900 mb-2"},"🚀 Production-Ready Platform",3,null),t("p",null,{class:"text-gray-600 mb-4"},"Built with ⚡ Qwik City • 🧩 LIT Elements • 🗄️ Supabase • ☁️ Cloudflare",3,null),t("div",null,{class:"flex justify-center space-x-6 text-sm"},[t("span",null,{class:"text-green-600 font-medium"},"✅ 0 TypeScript Errors",3,null),t("span",null,{class:"text-blue-600 font-medium"},"⚡ Zero Hydration",3,null),t("span",null,{class:"text-purple-600 font-medium"},"🔐 Enterprise Security",3,null),t("span",null,{class:"text-yellow-600 font-medium"},"🌐 Edge Computing",3,null)],3,null)],3,null),3,null),3,null)]},1,"LZ_2")),ut=O(y(it,"s_Ko4dh3oGD7U")),ct=Object.freeze(Object.defineProperty({__proto__:null,default:ut,onRequest:ot},Symbol.toStringTag,{value:"Module"})),dt=({cleanup:n})=>{const[e]=P(),l=setInterval(()=>{e.value=new Date().toLocaleTimeString()},1e3);n(()=>clearInterval(l))},gt=async()=>{const[n]=P();if(!(typeof window>"u"))try{const e=await fetch("/api/health");if(e.ok){const l=await e.json();n.value=l}}catch(e){p.error("Failed to load system status",{error:e instanceof Error?e.message:String(e)})}},pt=n=>{const[e]=P();e.value=n},mt=()=>{const n=w(null),e=w(new Date().toLocaleTimeString());w(!1);const l=w("button");z(y(dt,"s_rWqtG5m0xRg",[e])),z(y(gt,"s_j3Kr0B9FRBw",[n]));const s=y(pt,"s_fR0Y7GocRTY",[l]);return t("div",null,{class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},[t("section",null,{class:"container py-20 text-center"},t("div",null,{class:"max-w-4xl mx-auto"},[t("h1",null,{class:"text-6xl font-bold text-gray-900 mb-6"},["🚀 ",t("span",null,{class:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"},"Qwik + LIT + Supabase",3,null),t("br",null,null,null,3,null),"Production Stack"],3,null),t("p",null,{class:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto"},["Live demonstration of a production-ready platform with ",t("strong",null,null,"zero mocks",3,null),", real databases, edge storage, and enterprise security. Everything you see is functional."],3,null),t("div",null,{class:"flex flex-wrap justify-center gap-3 mb-8"},[t("span",null,{class:"px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium"},"✅ 0 TypeScript Errors",3,null),t("span",null,{class:"px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-medium"},"⚡ O(1) Loading",3,null),t("span",null,{class:"px-4 py-2 bg-purple-100 text-purple-800 rounded-full text-sm font-medium"},"🔐 Enterprise Security",3,null),t("span",null,{class:"px-4 py-2 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium"},"🌐 Edge Computing",3,null)],3,null),t("div",null,{class:"flex flex-wrap justify-center gap-4"},[t("a",null,{href:"/dashboard",class:"btn bg-blue-600 text-white hover:bg-blue-700 px-8 py-3 rounded-lg font-semibold transition-all transform hover:scale-105"},"🏠 Live Dashboard",3,null),t("a",null,{href:"/login",class:"btn bg-purple-600 text-white hover:bg-purple-700 px-8 py-3 rounded-lg font-semibold transition-all transform hover:scale-105"},"🔐 Auth Demo",3,null),t("a",null,{href:"/api/health",target:"_blank",class:"btn bg-green-600 text-white hover:bg-green-700 px-8 py-3 rounded-lg font-semibold transition-all transform hover:scale-105"},"💚 Health Check",3,null)],3,null)],3,null),3,null),t("section",null,{class:"container py-12"},t("div",null,{class:"bg-white rounded-2xl shadow-lg p-8"},[t("div",null,{class:"flex items-center justify-between mb-6"},[t("h2",null,{class:"text-3xl font-bold text-gray-900"},"🔥 Live System Status",3,null),t("div",null,{class:"text-sm text-gray-500"},["Updated: ",g(a=>a.value,[e],"p0.value")],3,null)],3,null),n.value?t("div",null,{class:"grid md:grid-cols-3 lg:grid-cols-6 gap-6"},[t("div",null,{class:"text-center"},[t("div",null,{class:g(a=>`text-3xl mb-2 ${a.value.checks.database.status==="pass"?"text-green-500":"text-red-500"}`,[n],'`text-3xl mb-2 ${p0.value.checks.database.status==="pass"?"text-green-500":"text-red-500"}`')},g(a=>a.value.checks.database.status==="pass"?"✅":"❌",[n],'p0.value.checks.database.status==="pass"?"✅":"❌"'),3,null),t("h3",null,{class:"font-semibold"},"Supabase DB",3,null),t("p",null,{class:"text-sm text-gray-600"},[g(a=>a.value.checks.database.responseTime,[n],"p0.value.checks.database.responseTime"),"ms"],3,null)],3,null),t("div",null,{class:"text-center"},[t("div",null,{class:g(a=>`text-3xl mb-2 ${a.value.checks.storage.status==="pass"?"text-green-500":"text-red-500"}`,[n],'`text-3xl mb-2 ${p0.value.checks.storage.status==="pass"?"text-green-500":"text-red-500"}`')},g(a=>a.value.checks.storage.status==="pass"?"✅":"❌",[n],'p0.value.checks.storage.status==="pass"?"✅":"❌"'),3,null),t("h3",null,{class:"font-semibold"},"R2 Storage",3,null),t("p",null,{class:"text-sm text-gray-600"},[g(a=>a.value.checks.storage.responseTime,[n],"p0.value.checks.storage.responseTime"),"ms"],3,null)],3,null),t("div",null,{class:"text-center"},[t("div",null,{class:g(a=>`text-3xl mb-2 ${a.value.checks.cache.status==="pass"?"text-green-500":"text-red-500"}`,[n],'`text-3xl mb-2 ${p0.value.checks.cache.status==="pass"?"text-green-500":"text-red-500"}`')},g(a=>a.value.checks.cache.status==="pass"?"✅":"❌",[n],'p0.value.checks.cache.status==="pass"?"✅":"❌"'),3,null),t("h3",null,{class:"font-semibold"},"KV Cache",3,null),t("p",null,{class:"text-sm text-gray-600"},[g(a=>a.value.checks.cache.responseTime,[n],"p0.value.checks.cache.responseTime"),"ms"],3,null)],3,null),t("div",null,{class:"text-center"},[t("div",null,{class:g(a=>`text-3xl mb-2 ${a.value.checks.external.status==="pass"?"text-green-500":"text-red-500"}`,[n],'`text-3xl mb-2 ${p0.value.checks.external.status==="pass"?"text-green-500":"text-red-500"}`')},g(a=>a.value.checks.external.status==="pass"?"✅":"❌",[n],'p0.value.checks.external.status==="pass"?"✅":"❌"'),3,null),t("h3",null,{class:"font-semibold"},"External APIs",3,null),t("p",null,{class:"text-sm text-gray-600"},[g(a=>a.value.checks.external.responseTime,[n],"p0.value.checks.external.responseTime"),"ms"],3,null)],3,null),t("div",null,{class:"text-center"},[t("div",null,{class:g(a=>`text-3xl mb-2 ${a.value.checks.memory.status==="pass"?"text-green-500":"text-red-500"}`,[n],'`text-3xl mb-2 ${p0.value.checks.memory.status==="pass"?"text-green-500":"text-red-500"}`')},g(a=>a.value.checks.memory.status==="pass"?"✅":"❌",[n],'p0.value.checks.memory.status==="pass"?"✅":"❌"'),3,null),t("h3",null,{class:"font-semibold"},"Memory",3,null),t("p",null,{class:"text-sm text-gray-600"},"Optimal",3,null)],3,null),t("div",null,{class:"text-center"},[t("div",null,{class:g(a=>`text-3xl mb-2 ${a.value.checks.platform.status==="pass"?"text-green-500":"text-red-500"}`,[n],'`text-3xl mb-2 ${p0.value.checks.platform.status==="pass"?"text-green-500":"text-red-500"}`')},g(a=>a.value.checks.platform.status==="pass"?"✅":"❌",[n],'p0.value.checks.platform.status==="pass"?"✅":"❌"'),3,null),t("h3",null,{class:"font-semibold"},"Cloudflare",3,null),t("p",null,{class:"text-sm text-gray-600"},"Edge Ready",3,null)],3,null)],3,"UG_0"):t("div",null,{class:"text-center py-8"},[t("div",null,{class:"animate-spin text-4xl mb-4"},"⚡",3,null),t("p",null,{class:"text-gray-600"},"Loading real system status...",3,null)],3,null)],1,null),1,null),t("section",null,{class:"container py-12"},t("div",null,{class:"bg-white rounded-2xl shadow-lg p-8"},[t("h2",null,{class:"text-3xl font-bold text-gray-900 mb-6 text-center"},"🎨 Live Design System with Spectrum Tokens",3,null),t("div",null,{class:"flex justify-center gap-4 mb-8"},[t("button",null,{class:g(a=>`px-4 py-2 rounded-lg transition-all ${a.value==="button"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,[l],'`px-4 py-2 rounded-lg transition-all ${p0.value==="button"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`'),onClick$:C("s_5k0fPY9uNBg",[s])},"Buttons",3,null),t("button",null,{class:g(a=>`px-4 py-2 rounded-lg transition-all ${a.value==="input"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,[l],'`px-4 py-2 rounded-lg transition-all ${p0.value==="input"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`'),onClick$:C("s_0SRyEbnJ408",[s])},"Inputs",3,null),t("button",null,{class:g(a=>`px-4 py-2 rounded-lg transition-all ${a.value==="upload"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,[l],'`px-4 py-2 rounded-lg transition-all ${p0.value==="upload"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`'),onClick$:C("s_QKGBDBTwM0Y",[s])},"File Upload",3,null)],3,null),t("div",null,{class:"text-center p-8 bg-gray-50 rounded-xl"},[l.value==="button"&&t("div",null,{class:"space-y-4"},[t("h3",null,{class:"text-xl font-semibold mb-4"},"LIT Web Components - Buttons",3,null),t("div",null,{class:"flex justify-center gap-4 flex-wrap"},[t("ds-button",null,{variant:"primary",size:"medium"},"Primary Button",3,null),t("ds-button",null,{variant:"secondary",size:"medium"},"Secondary Button",3,null),t("ds-button",null,{variant:"primary",size:"large"},"Large Button",3,null),t("ds-button",null,{variant:"secondary",size:"large",disabled:!0},"Disabled",3,null)],3,null),t("p",null,{class:"text-sm text-gray-600 mt-4"},"Powered by Adobe Spectrum design tokens • Web Components • Framework agnostic",3,null)],3,"UG_1"),l.value==="input"&&t("div",null,{class:"space-y-4 max-w-md mx-auto"},[t("h3",null,{class:"text-xl font-semibold mb-4"},"LIT Web Components - Inputs",3,null),t("ds-input",null,{type:"text",label:"Demo Input",placeholder:"Try typing here...",class:"w-full"},null,3,null),t("ds-input",null,{type:"email",label:"Email Input",placeholder:"user@example.com",required:!0,class:"w-full"},null,3,null),t("p",null,{class:"text-sm text-gray-600 mt-4"},"Real validation • Spectrum design tokens • Accessible by default",3,null)],3,"UG_2"),l.value==="upload"&&t("div",null,{class:"space-y-4"},[t("h3",null,{class:"text-xl font-semibold mb-4"},"LIT Web Components - File Upload",3,null),t("div",null,{class:"max-w-md mx-auto"},t("ds-file-upload",null,{endpoint:"/api/upload",accept:"image/*,application/pdf",maxSize:10485760,multiple:!0,bucket:"demo",class:"w-full"},null,3,null),3,null),t("p",null,{class:"text-sm text-gray-600 mt-4"},"Real Cloudflare R2 upload • Drag & drop • Progress tracking • Security validated",3,null)],3,"UG_3")],1,null)],1,null),1,null),t("section",null,{class:"container py-12"},[t("h2",null,{class:"text-3xl font-bold text-center text-gray-900 mb-12"},"🏆 Production Features Showcase",3,null),t("div",null,{class:"grid md:grid-cols-2 lg:grid-cols-3 gap-8"},[t("div",null,{class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[t("div",null,{class:"text-3xl mb-4"},"📊",3,null),t("h3",null,{class:"text-xl font-semibold mb-3"},"Real-Time Analytics",3,null),t("p",null,{class:"text-gray-600 mb-4"},"Live database queries with performance metrics. No simulations.",3,null),t("a",null,{href:"/dashboard/analytics",class:"text-blue-600 hover:text-blue-800 font-medium"},"View Live Data →",3,null)],3,null),t("div",null,{class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[t("div",null,{class:"text-3xl mb-4"},"🔐",3,null),t("h3",null,{class:"text-xl font-semibold mb-3"},"JWT Authentication",3,null),t("p",null,{class:"text-gray-600 mb-4"},"Supabase Auth with Row Level Security. Enterprise grade.",3,null),t("a",null,{href:"/login",class:"text-purple-600 hover:text-purple-800 font-medium"},"Try Login Flow →",3,null)],3,null),t("div",null,{class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[t("div",null,{class:"text-3xl mb-4"},"☁️",3,null),t("h3",null,{class:"text-xl font-semibold mb-3"},"Edge Storage",3,null),t("p",null,{class:"text-gray-600 mb-4"},"Cloudflare R2 with global CDN. Upload and see permanent URLs.",3,null),t("a",null,{href:"/dashboard/media",class:"text-green-600 hover:text-green-800 font-medium"},"Manage Files →",3,null)],3,null),t("div",null,{class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[t("div",null,{class:"text-3xl mb-4"},"🛡️",3,null),t("h3",null,{class:"text-xl font-semibold mb-3"},"Security Hardened",3,null),t("p",null,{class:"text-gray-600 mb-4"},"CSP headers, rate limiting, input validation, RBAC.",3,null),t("a",null,{href:"/api/health",target:"_blank",class:"text-red-600 hover:text-red-800 font-medium"},"Security Report →",3,null)],3,null),t("div",null,{class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[t("div",null,{class:"text-3xl mb-4"},"⚡",3,null),t("h3",null,{class:"text-xl font-semibold mb-3"},"Zero Hydration",3,null),t("p",null,{class:"text-gray-600 mb-4"},"Qwik resumability means instant interactivity.",3,null),t("span",null,{class:"text-blue-600 font-medium"},"Active on this page!",3,null)],3,null),t("div",null,{class:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow"},[t("div",null,{class:"text-3xl mb-4"},"🧩",3,null),t("h3",null,{class:"text-xl font-semibold mb-3"},"Web Components",3,null),t("p",null,{class:"text-gray-600 mb-4"},"LIT components with Spectrum tokens. Framework agnostic.",3,null),t("a",null,{href:"/dashboard/components",class:"text-yellow-600 hover:text-yellow-800 font-medium"},"Component Library →",3,null)],3,null)],3,null)],3,null),t("section",null,{class:"container py-12"},t("div",null,{class:"bg-gradient-to-r from-green-500 to-blue-600 rounded-2xl text-white p-8 text-center"},[t("h2",null,{class:"text-3xl font-bold mb-6"},"🚀 Production Performance",3,null),t("div",null,{class:"grid md:grid-cols-4 gap-6"},[t("div",null,null,[t("div",null,{class:"text-4xl font-bold"},"0ms",3,null),t("div",null,{class:"text-sm opacity-90"},"Hydration Time",3,null)],3,null),t("div",null,null,[t("div",null,{class:"text-4xl font-bold"},"<500ms",3,null),t("div",null,{class:"text-sm opacity-90"},"API Response",3,null)],3,null),t("div",null,null,[t("div",null,{class:"text-4xl font-bold"},"0",3,null),t("div",null,{class:"text-sm opacity-90"},"TypeScript Errors",3,null)],3,null),t("div",null,null,[t("div",null,{class:"text-4xl font-bold"},"100%",3,null),t("div",null,{class:"text-sm opacity-90"},"Real Systems",3,null)],3,null)],3,null),t("div",null,{class:"mt-8"},t("a",null,{href:"/dashboard",class:"inline-flex items-center px-8 py-3 bg-white text-blue-600 rounded-lg hover:bg-gray-100 font-semibold transition-colors"},"🏠 Explore Full Dashboard",3,null),3,null)],3,null),3,null),t("section",null,{class:"container py-12"},t("div",null,{class:"bg-white rounded-2xl shadow-lg p-8"},[t("h2",null,{class:"text-3xl font-bold text-center text-gray-900 mb-8"},"⚙️ Tech Stack",3,null),t("div",null,{class:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 text-center"},[t("div",null,{class:"p-4"},[t("div",null,{class:"text-4xl mb-2"},"⚡",3,null),t("h3",null,{class:"font-semibold"},"Qwik City",3,null),t("p",null,{class:"text-sm text-gray-600"},"O(1) Loading",3,null)],3,null),t("div",null,{class:"p-4"},[t("div",null,{class:"text-4xl mb-2"},"🧩",3,null),t("h3",null,{class:"font-semibold"},"LIT Elements",3,null),t("p",null,{class:"text-sm text-gray-600"},"Web Components",3,null)],3,null),t("div",null,{class:"p-4"},[t("div",null,{class:"text-4xl mb-2"},"🗄️",3,null),t("h3",null,{class:"font-semibold"},"Supabase",3,null),t("p",null,{class:"text-sm text-gray-600"},"Backend + Auth",3,null)],3,null),t("div",null,{class:"p-4"},[t("div",null,{class:"text-4xl mb-2"},"☁️",3,null),t("h3",null,{class:"font-semibold"},"Cloudflare",3,null),t("p",null,{class:"text-sm text-gray-600"},"Edge Computing",3,null)],3,null)],3,null),t("div",null,{class:"mt-8 text-center"},[t("p",null,{class:"text-gray-600 mb-4"},"Built with Adobe Spectrum design tokens and enterprise security standards",3,null),t("div",null,{class:"flex justify-center flex-wrap gap-2"},[t("span",null,{class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"},"TypeScript",3,null),t("span",null,{class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"},"Vite",3,null),t("span",null,{class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"},"Tailwind CSS",3,null),t("span",null,{class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"},"ESLint",3,null),t("span",null,{class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"},"Vitest",3,null),t("span",null,{class:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"},"Playwright",3,null)],3,null)],3,null)],3,null),3,null)],1,"UG_4")},ht=O(y(mt,"s_WrwGpWxLnZE")),ft={title:"Qwik + LIT + Supabase Production Platform - Live Demo",meta:[{name:"description",content:"Live demonstration of a production-ready platform built with Qwik City, LIT Web Components, Supabase backend, and Cloudflare edge services. Zero mocks, 100% functional."},{property:"og:title",content:"Production-Ready Qwik + LIT Platform Demo"},{property:"og:description",content:"Experience a fully functional platform with real databases, authentication, file storage, and analytics. No simulations."}]},bt=Object.freeze(Object.defineProperty({__proto__:null,default:ht,head:ft},Symbol.toStringTag,{value:"Module"})),yt=async({json:n,headers:e})=>{e.set("Cache-Control","public, max-age=3600"),e.set("Access-Control-Allow-Origin","*"),e.set("Access-Control-Allow-Methods","GET"),e.set("Access-Control-Allow-Headers","Content-Type"),e.set("Content-Type","application/manifest+json"),n(200,{name:"Qwik + LIT + Builder.io Stack",short_name:"Qwik Stack",description:"Modern web application with Qwik, LIT, and Builder.io",start_url:"/",display:"standalone",background_color:"#ffffff",theme_color:"#2563eb",icons:[{src:"/favicon.svg",sizes:"any",type:"image/svg+xml"}]})},xt=Object.freeze(Object.defineProperty({__proto__:null,onGet:yt},Symbol.toStringTag,{value:"Module"})),vt=async({url:n,json:e})=>{try{const l=n.searchParams.get("range")||"7d",s=M(),a=new Date,{startDate:r,endDate:o,previousStartDate:i,previousEndDate:u}=wt(l,a);p.info("Fetching real analytics data",{timeRange:l,startDate:r.toISOString(),endDate:o.toISOString()});const[c,m,d,h]=await Promise.all([fe(s,r,o),fe(s,i,u),_t(s,r,o),St()]),v={pageViews:{value:c.pageViews,change:Q(c.pageViews,m.pageViews)},uniqueVisitors:{value:c.uniqueVisitors,change:Q(c.uniqueVisitors,m.uniqueVisitors)},bounceRate:{value:`${Math.round(c.bounceRate)}%`,change:Q(m.bounceRate,c.bounceRate)},avgSessionTime:{value:kt(c.avgSessionTimeMs),change:Q(c.avgSessionTimeMs,m.avgSessionTimeMs)}},T={analytics:v,performance:{builderContent:{loadTime:`${(h.builderContentLoadTime/1e3).toFixed(1)}s`,rating:ne(h.builderContentLoadTime)},mediaFiles:{loadTime:`${(h.mediaLoadTime/1e3).toFixed(1)}s`,rating:ne(h.mediaLoadTime)},cacheHitRate:{value:`${Math.round(h.cacheHitRate)}%`,rating:Et(h.cacheHitRate)},apiResponseTime:{value:`${Math.round(h.apiResponseTime)}ms`,rating:ne(h.apiResponseTime)}},content:d,lastUpdated:a.toISOString()};p.info("Real analytics data retrieved successfully",{timeRange:l,pageViews:v.pageViews.value,uniqueVisitors:v.uniqueVisitors.value,contentItemsCount:d.length}),e(200,T)}catch(l){const s=l instanceof Error?l.message:String(l),a=l instanceof Error?l.stack:void 0;p.error("Failed to fetch analytics data",{error:s,stack:a}),e(500,{error:"Failed to fetch analytics data",message:"Unable to retrieve dashboard metrics. Please try again later."})}};function wt(n,e){const l=new Date(e);let s,a,r;switch(n){case"24h":s=new Date(e.getTime()-864e5),r=new Date(s),a=new Date(s.getTime()-864e5);break;case"30d":s=new Date(e.getTime()-2592e6),r=new Date(s),a=new Date(s.getTime()-2592e6);break;case"90d":s=new Date(e.getTime()-7776e6),r=new Date(s),a=new Date(s.getTime()-7776e6);break;default:s=new Date(e.getTime()-6048e5),r=new Date(s),a=new Date(s.getTime()-6048e5)}return{startDate:s,endDate:l,previousStartDate:a,previousEndDate:r}}async function fe(n,e,l){try{const{data:s,error:a}=await n.from("analytics_events").select("user_id, session_id, event_type, created_at").eq("event_type","page_view").gte("created_at",e.toISOString()).lte("created_at",l.toISOString());if(a)throw p.error("Failed to fetch page view data",{error:a}),new Error("Page view data unavailable");const{data:r,error:o}=await n.from("user_sessions").select("user_id, session_id, session_duration, bounce, created_at").gte("created_at",e.toISOString()).lte("created_at",l.toISOString());if(o)throw p.error("Failed to fetch session data",{error:o}),new Error("Session data unavailable");const i=(s==null?void 0:s.length)||0,u=new Set((s==null?void 0:s.map(d=>d.user_id))||[]).size,c=(r==null?void 0:r.length)>0?r.filter(d=>d.bounce).length/r.length*100:0,m=(r==null?void 0:r.length)>0?r.reduce((d,h)=>d+(h.session_duration||0),0)/r.length:0;return{pageViews:i,uniqueVisitors:u,bounceRate:c,avgSessionTimeMs:m,previousPeriodViews:0,previousUniqueVisitors:0,previousBounceRate:0,previousSessionTimeMs:0}}catch(s){const a=s instanceof Error?s.message:String(s);return p.error("Error fetching analytics period data",{error:a}),{pageViews:0,uniqueVisitors:0,bounceRate:0,avgSessionTimeMs:0,previousPeriodViews:0,previousUniqueVisitors:0,previousBounceRate:0,previousSessionTimeMs:0}}}async function _t(n,e,l){var s,a,r,o,i,u,c,m,d,h,v,T;try{const[b,A,f,x]=await Promise.all([n.from("builder_pages").select("id, title, view_count, engagement_score").gte("created_at",e.toISOString()).lte("created_at",l.toISOString()),n.from("content_posts").select("id, title, view_count, engagement_score").gte("created_at",e.toISOString()).lte("created_at",l.toISOString()),n.from("media_files").select("id, filename, download_count, view_count").gte("created_at",e.toISOString()).lte("created_at",l.toISOString()),n.from("component_usage").select("component_id, usage_count, performance_score").gte("created_at",e.toISOString()).lte("created_at",l.toISOString())]);return[{type:"Pages",count:((s=b.data)==null?void 0:s.length)||0,views:((a=b.data)==null?void 0:a.reduce((E,D)=>E+(D.view_count||0),0))||0,engagement:((r=b.data)==null?void 0:r.reduce((E,D)=>E+(D.engagement_score||0),0))||0},{type:"Posts",count:((o=A.data)==null?void 0:o.length)||0,views:((i=A.data)==null?void 0:i.reduce((E,D)=>E+(D.view_count||0),0))||0,engagement:((u=A.data)==null?void 0:u.reduce((E,D)=>E+(D.engagement_score||0),0))||0},{type:"Media",count:((c=f.data)==null?void 0:c.length)||0,views:((m=f.data)==null?void 0:m.reduce((E,D)=>E+(D.view_count||0),0))||0,engagement:((d=f.data)==null?void 0:d.reduce((E,D)=>E+(D.download_count||0),0))||0},{type:"Components",count:((h=x.data)==null?void 0:h.length)||0,views:((v=x.data)==null?void 0:v.reduce((E,D)=>E+(D.usage_count||0),0))||0,engagement:((T=x.data)==null?void 0:T.reduce((E,D)=>E+(D.performance_score||0),0))||0}]}catch(b){const A=b instanceof Error?b.message:String(b);return p.error("Error fetching content metrics",{error:A}),[{type:"Pages",count:0,views:0,engagement:0},{type:"Posts",count:0,views:0,engagement:0},{type:"Media",count:0,views:0,engagement:0},{type:"Components",count:0,views:0,engagement:0}]}}async function St(){try{const n=M(),{data:e}=await n.from("cache_entries").select("hit_count").not("hit_count","is",null),l=(e==null?void 0:e.reduce((d,h)=>d+(h.hit_count||0),0))||0,s=(e==null?void 0:e.length)||0,a=s>0?l/s*100:0,r=Date.now();try{await fetch("/api/content/pages?limit=1",{method:"HEAD"})}catch{}const o=Date.now()-r,i=Date.now();try{await fetch("/api/files/list?limit=1",{method:"HEAD"})}catch{}const u=Date.now()-i,{data:c}=await n.from("analytics_events").select("load_time").eq("event_type","api_request").not("load_time","is",null).order("created_at",{ascending:!1}).limit(100),m=c&&c.length>0?c.reduce((d,h)=>d+(h.load_time||0),0)/c.length:250;return{builderContentLoadTime:o,mediaLoadTime:u,cacheHitRate:a,apiResponseTime:m}}catch(n){const e=n instanceof Error?n.message:String(n);return p.error("Error fetching performance metrics",{error:e}),{builderContentLoadTime:1200,mediaLoadTime:800,cacheHitRate:0,apiResponseTime:300}}}function Q(n,e){if(e===0)return n>0?"+100%":"0%";const l=(n-e)/e*100;return`${l>=0?"+":""}${Math.round(l)}%`}function kt(n){const e=Math.round(n/1e3),l=Math.floor(e/60),s=e%60;return`${l}m ${s}s`}function ne(n){return n<1e3?"Excellent":n<2e3?"Good":n<3e3?"Fair":"Poor"}function Et(n){return n>=90?"Excellent":n>=75?"Good":n>=50?"Fair":"Poor"}const Ct=Object.freeze(Object.defineProperty({__proto__:null,onGet:vt},Symbol.toStringTag,{value:"Module"})),Tt=async({json:n,cookie:e,env:l,request:s})=>{try{const a=e.get("sb-auth-token"),r=s.headers.get("authorization"),o=(a==null?void 0:a.value)||(r!=null&&r.startsWith("Bearer ")?r.substring(7):null);if(!o){n(200,{authenticated:!1,hasToken:!1,tokenPresent:!1,reason:"No token provided"});return}const i=l.get("VITE_SUPABASE_URL")||process.env.VITE_SUPABASE_URL||"",u=l.get("SUPABASE_SERVICE_KEY")||process.env.SUPABASE_SERVICE_KEY||"";if(!i||!u){n(500,{authenticated:!1,error:"Server configuration error - Supabase not configured"});return}const c=Z(i,u),{data:{user:m},error:d}=await c.auth.getUser(o);if(d||!m){n(200,{authenticated:!1,hasToken:!0,tokenPresent:!0,valid:!1,reason:"Authentication token is invalid or expired",error:"Invalid token"});return}n(200,{authenticated:!0,hasToken:!0,tokenPresent:!0,valid:!0,user:{id:m.id,email:m.email,emailVerified:m.email_confirmed_at!==null,lastSignIn:m.last_sign_in_at,createdAt:m.created_at}})}catch(a){p.error("Auth status check failed",{},a),n(500,{authenticated:!1,error:"Internal server error"})}},Pt=Object.freeze(Object.defineProperty({__proto__:null,onGet:Tt},Symbol.toStringTag,{value:"Module"}));class Rt{constructor(e){this.config=e,this.history=[],this.keyStats=new Map,this.strategyStats=new Map}recordHit(e){this.history.push(e),this.history.length>this.config.maxHistorySize&&(this.history=this.history.slice(-this.config.maxHistorySize));const l=e.key,s=this.keyStats.get(l)||{requests:0,hits:0,totalTime:0};if(s.requests++,s.totalTime+=e.responseTime,(e.type==="hit"||e.type==="stale")&&s.hits++,this.keyStats.set(l,s),e.strategy){const a=e.strategy,r=this.strategyStats.get(a)||{requests:0,hits:0,totalTime:0};r.requests++,r.totalTime+=e.responseTime,(e.type==="hit"||e.type==="stale")&&r.hits++,this.strategyStats.set(a,r)}}getMetrics(e){const l=Date.now(),s=e?l-e*6e4:0,a=this.history.filter(f=>f.timestamp>=s),r=a.length,o=a.filter(f=>f.type==="hit").length,i=a.filter(f=>f.type==="stale").length,u=a.filter(f=>f.type==="miss").length,c=a.filter(f=>f.type==="error").length,m=r>0?(o+i)/r*100:0,d=r>0?a.reduce((f,x)=>f+x.responseTime,0)/r:0,h=a.filter(f=>f.size).reduce((f,x)=>f+(x.size||0),0),v=new Map;a.forEach(f=>{const x=v.get(f.key)||{requests:0,hits:0};x.requests++,(f.type==="hit"||f.type==="stale")&&x.hits++,v.set(f.key,x)});const T=Array.from(v.entries()).map(([f,x])=>({key:f,requests:x.requests,hitRate:x.requests>0?x.hits/x.requests*100:0})).sort((f,x)=>x.requests-f.requests).slice(0,10),b=new Map;a.forEach(f=>{if(f.strategy){const x=b.get(f.strategy)||{requests:0,hits:0,totalTime:0};x.requests++,x.totalTime+=f.responseTime,(f.type==="hit"||f.type==="stale")&&x.hits++,b.set(f.strategy,x)}});const A={};return b.forEach((f,x)=>{A[x]={requests:f.requests,hitRate:f.requests>0?f.hits/f.requests*100:0,averageTime:f.requests>0?f.totalTime/f.requests:0}}),{totalRequests:r,hits:o,misses:u,staleHits:i,errors:c,hitRate:m,averageResponseTime:d,totalSize:h,topKeys:T,strategiesPerformance:A}}generateInsights(e=60){const l=this.getMetrics(e),s=[];l.hitRate<this.config.alertThresholds.minHitRate?s.push(`⚠️ Low hit rate: ${l.hitRate.toFixed(1)}% (target: ${this.config.alertThresholds.minHitRate}%)`):l.hitRate>90&&s.push(`✅ Excellent hit rate: ${l.hitRate.toFixed(1)}%`),l.averageResponseTime>this.config.alertThresholds.maxResponseTime&&s.push(`⚠️ Slow response time: ${l.averageResponseTime.toFixed(1)}ms (target: <${this.config.alertThresholds.maxResponseTime}ms)`);const a=l.totalRequests>0?l.errors/l.totalRequests*100:0;a>this.config.alertThresholds.maxErrorRate&&s.push(`⚠️ High error rate: ${a.toFixed(1)}% (target: <${this.config.alertThresholds.maxErrorRate}%)`);const r=l.topKeys[0];return r&&r.hitRate<50&&s.push(`🔍 Most requested key "${r.key}" has low hit rate: ${r.hitRate.toFixed(1)}%`),Object.entries(l.strategiesPerformance).forEach(([o,i])=>{i.hitRate<50&&i.requests>10&&s.push(`🎯 Strategy "${o}" underperforming: ${i.hitRate.toFixed(1)}% hit rate`)}),l.totalSize>10485760&&s.push(`📊 Large cache usage: ${(l.totalSize/1024/1024).toFixed(1)}MB`),s}exportData(e){const l=Date.now(),s=e?l-e*6e4:0;return{metrics:this.getMetrics(e),insights:this.generateInsights(e),rawData:this.history.filter(a=>a.timestamp>=s)}}clear(){this.history=[],this.keyStats.clear(),this.strategyStats.clear()}getPerformanceScore(){const e=this.getMetrics(60);if(e.totalRequests===0)return 100;let l=0;l+=e.hitRate/100*50;const s=Math.max(0,100-e.averageResponseTime/10);l+=s/100*30;const a=e.errors/e.totalRequests*100,r=Math.max(0,100-a*10);return l+=r/100*20,Math.round(Math.max(0,Math.min(100,l)))}}const Mt={maxHistorySize:1e4,aggregationWindow:60,alertThresholds:{minHitRate:80,maxResponseTime:100,maxErrorRate:1}},H=new Rt(Mt),At=async({json:n,url:e,cacheControl:l})=>{try{l({maxAge:0,sMaxAge:60,public:!0,staleWhileRevalidate:300});const s=parseInt(e.searchParams.get("window")||"60");switch(e.searchParams.get("action")||"metrics"){case"metrics":const r=H.getMetrics(s),o=H.getPerformanceScore(),i=H.generateInsights(s);n(200,{success:!0,data:{metrics:r,performanceScore:o,insights:i,window:s,timestamp:Date.now()}});break;case"export":const u=H.exportData(s);n(200,{success:!0,data:u,timestamp:Date.now()});break;default:n(400,{success:!1,error:"Invalid action. Use: metrics or export"})}}catch(s){n(500,{success:!1,error:"Internal server error",details:s instanceof Error?s.message:"Unknown error"})}},Dt=async({json:n,parseBody:e})=>{try{const l=await e(),{action:s}=l;switch(s){case"clear":H.clear(),n(200,{success:!0,data:{cleared:"analytics",timestamp:Date.now()}});break;default:n(400,{success:!1,error:"Invalid action. Use: clear"})}}catch(l){n(500,{success:!1,error:"Internal server error",details:l instanceof Error?l.message:"Unknown error"})}},$t=Object.freeze(Object.defineProperty({__proto__:null,onGet:At,onPost:Dt},Symbol.toStringTag,{value:"Module"}));class Te extends Error{constructor(e,l,s=500,a){super(e),this.code=l,this.statusCode=s,this.details=a,this.name="AppError",Error.captureStackTrace(this,this.constructor)}}class be extends Te{constructor(e){super(`${e} not found`,"NOT_FOUND",404),this.name="NotFoundError"}}function de(n){if(p.error("API Error occurred",{error:n instanceof Error?n.message:String(n)}),n instanceof Te)return{statusCode:n.statusCode,body:{error:{code:n.code,message:n.message,details:n.details}}};if(n&&typeof n=="object"&&"code"in n){const e=n;return{statusCode:400,body:{error:{code:e.code,message:e.message||"Database error"}}}}return{statusCode:500,body:{error:{code:"INTERNAL_ERROR",message:"An unexpected error occurred"}}}}const Pe=async({json:n,env:e,request:l,url:s})=>{try{const a=parseInt(s.searchParams.get("page")||"1"),r=parseInt(s.searchParams.get("limit")||"20"),o=s.searchParams.get("filter")||"all",i=s.searchParams.get("search")||"",u=l.headers.get("authorization");if(!u||!u.startsWith("Bearer ")){n(401,{error:"Authentication required"});return}const c=e.get("SUPABASE_URL")||"",m=e.get("SUPABASE_SERVICE_ROLE_KEY")||"";if(!c||!m){n(500,{error:"Server configuration error"});return}const d=Z(c,m),h=u.replace("Bearer ",""),{data:{user:v},error:T}=await d.auth.getUser(h);if(T||!v){n(401,{error:"Invalid authentication"});return}let b=d.from("file_metadata").select("*",{count:"exact"}).eq("user_id",v.id).eq("upload_status","completed").order("created_at",{ascending:!1});if(o!=="all")switch(o){case"images":b=b.like("mime_type","image/%");break;case"videos":b=b.like("mime_type","video/%");break;case"audio":b=b.like("mime_type","audio/%");break;case"documents":b=b.or("mime_type.like.application/%,mime_type.like.text/%");break}i&&(b=b.textSearch("search_vector",i));const A=(a-1)*r;b=b.range(A,A+r-1);const{data:f,error:x,count:E}=await b;if(x){n(500,{error:"Failed to fetch files"});return}const D=e.get("CLOUDFLARE_ACCOUNT_ID")||"",U=L=>`https://qwik-production-files.${D}.r2.cloudflarestorage.com/${L}`,G=(f||[]).map(L=>({id:L.id,name:L.file_name,size:L.file_size,type:L.mime_type||"application/octet-stream",url:U(L.storage_path),uploadedAt:L.created_at,thumbnailUrl:L.thumbnail_path?U(L.thumbnail_path):void 0,tags:L.tags||[]})),V=E||0,te=Math.ceil(V/r),le=a<te;n(200,{files:G,pagination:{page:a,limit:r,total:V,totalPages:te,hasMore:le},stats:{totalFiles:V,filteredCount:G.length}})}catch(a){const{statusCode:r,body:o}=de(a);n(r,o)}},Ot=Object.freeze(Object.defineProperty({__proto__:null,onGet:Pe},Symbol.toStringTag,{value:"Module"}));_.object({id:_.string().uuid(),email:_.string().email(),name:_.string().min(1)});const Lt=_.object({file:_.any().refine(n=>{if(!n||typeof n!="object")return!1;const e="name"in n&&typeof n.name=="string",l="size"in n&&typeof n.size=="number",s="type"in n&&typeof n.type=="string";return l&&n.size>1073741824||e&&(n.name.length===0||n.name.includes("../")||n.name.includes("\\"))?!1:e&&l&&s},"Must be a valid file with name, size, and type. Max size 1GB. No path traversal characters."),bucket:_.string().min(1,"Bucket name is required").max(63,"Bucket name too long").regex(/^[a-z0-9][a-z0-9-]*[a-z0-9]$/,"Invalid bucket name format").default("uploads")}),Ft=(n,e)=>n.safeParse(e);class It{constructor(e={}){this.storageDir=e.storageDir||"./dev-storage",this.baseUrl=e.baseUrl||"http://localhost:5173/dev-files"}async put(e,l,s={}){try{return console.log(`[DevR2] Mock upload: ${e} (${l instanceof ArrayBuffer?l.byteLength:l.length} bytes)`),{success:!0,key:e,size:l instanceof ArrayBuffer?l.byteLength:l.length,etag:`dev-${Date.now()}`,httpMetadata:s.httpMetadata||{}}}catch(a){throw console.error(`[DevR2] Mock upload error for ${e}:`,a),a}}async uploadBuffer(e,l,s){return console.log(`[DevR2] Mock buffer upload: ${l} (${e.length} bytes, ${s})`),{success:!0,url:`${this.baseUrl}/${l}`,path:l,size:e.length}}async uploadFile(e,l){return console.log(`[DevR2] Mock file upload: ${l} (${e.size} bytes, ${e.type})`),{success:!0,url:`${this.baseUrl}/${l}`,path:l,size:e.size}}async get(e){return console.log(`[DevR2] Mock get: ${e}`),null}async delete(e){return console.log(`[DevR2] Mock delete: ${e}`),{success:!0}}async list(e={}){return console.log("[DevR2] Mock list operation"),{objects:[],truncated:!1}}getPublicUrl(e){return`${this.baseUrl}/${e}`}}var Se;const zt=typeof process<"u"&&((Se=process.env)==null?void 0:Se.NODE_ENV)==="development";var ke;const Ut=zt&&(typeof globalThis.R2>"u"||((ke=process.env)==null?void 0:ke.R2_DEV_MODE)==="true");class ye{constructor(e,l,s){this.bucket=e,this.accountId=l,this.bucketName=s}async uploadFile(e,l){try{const s=await e.arrayBuffer(),a=await this.bucket.put(l,s,{httpMetadata:{contentType:e.type||"application/octet-stream",cacheControl:"public, max-age=31536000"},customMetadata:{originalName:e.name,uploadedAt:new Date().toISOString(),size:e.size.toString()}});return a?{success:!0,url:this.getFileUrl(l),path:l,size:e.size,etag:a.etag}:{success:!1,error:"Failed to upload file to R2"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown R2 upload error"}}}async uploadBuffer(e,l,s){try{const a=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),r=await this.bucket.put(l,a,{httpMetadata:{contentType:s||"application/octet-stream",cacheControl:"public, max-age=31536000"},customMetadata:{processedImage:"true",uploadedAt:new Date().toISOString(),size:e.length.toString()}});return r?{success:!0,url:this.getFileUrl(l),path:l,size:e.length,etag:r.etag}:{success:!1,error:"Failed to upload buffer to R2"}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown R2 buffer upload error"}}}async deleteFile(e){try{return await this.bucket.delete(e),{success:!0}}catch(l){return{success:!1,error:l instanceof Error?l.message:"Unknown R2 delete error"}}}getFileUrl(e){return`https://${this.bucketName}.${this.accountId}.r2.cloudflarestorage.com/${e}`}async getFile(e){try{const l=await this.bucket.get(e);return l?{success:!0,data:await l.arrayBuffer(),metadata:l.customMetadata||{}}:{success:!1,error:"File not found"}}catch(l){return{success:!1,error:l instanceof Error?l.message:"Unknown R2 get error"}}}async listFiles(e){try{return(await this.bucket.list({prefix:e,limit:1e3})).objects.map(s=>s.key)}catch{return[]}}async healthCheck(){try{return await this.bucket.list({limit:1}),!0}catch{return!1}}}function jt(n){const e="qwik-production-files";if(Ut||!(n!=null&&n.R2)){console.log("🔧 Using R2 development mock for file operations");const l=new It;return new ye(l,"dev-account-id",e)}return new ye(n.R2,n.CLOUDFLARE_ACCOUNT_ID||"unknown",e)}class Bt{constructor(e){this.r2Client=jt({R2:e.r2Bucket,CLOUDFLARE_ACCOUNT_ID:e.cloudflareAccountId})}async uploadFile(e,l){try{const s=this.validateFile(e);return s.valid?await this.uploadToR2(e,l):{success:!1,provider:"r2",error:s.error}}catch(s){return p.error("Storage upload failed",{error:s instanceof Error?s.message:String(s)}),{success:!1,provider:"r2",error:s instanceof Error?s.message:"Unknown upload error"}}}async uploadFileBuffer(e,l,s,a,r){try{if(!e||e.length===0)return{success:!1,provider:"r2",error:"Buffer is empty"};const o=this.generateFilePathFromBuffer(l,a,r);return{...await this.r2Client.uploadBuffer(e,o,s),provider:"r2"}}catch(o){return p.error("Storage buffer upload failed",{error:o instanceof Error?o.message:String(o)}),{success:!1,provider:"r2",error:o instanceof Error?o.message:"Unknown upload error"}}}async deleteFile(e){try{return await this.r2Client.deleteFile(e)}catch(l){return p.error("Storage deletion failed",{error:l instanceof Error?l.message:String(l)}),{success:!1,error:l instanceof Error?l.message:"Unknown delete error"}}}getFileUrl(e){return this.r2Client.getFileUrl(e)}async listFiles(e){try{const l=e?`users/${e}/`:"uploads/";return await this.r2Client.listFiles(l)}catch(l){return p.error("Storage listing failed",{error:l instanceof Error?l.message:String(l)}),[]}}async uploadToR2(e,l){const s=this.generateFilePath(e,l);return{...await this.r2Client.uploadFile(e,s),provider:"r2"}}validateFile(e){return e.size>5368709120?{valid:!1,error:"File size exceeds maximum limit of 5GB"}:e.size===0?{valid:!1,error:"File is empty"}:!e.name||e.name.trim().length===0?{valid:!1,error:"File name is required"}:{valid:!0}}generateFilePath(e,l){const s=Date.now(),a=Math.random().toString(36).substring(7),r=e.name.split(".").pop()||"",o=e.name.replace(/\.[^/.]+$/,"").substring(0,50),i=this.getFileCategory(e);return`${l?`users/${l}/`:"uploads/"}${i}/${s}-${a}-${o}.${r}`}generateFilePathFromBuffer(e,l,s){const a=l?`users/${l}/`:"uploads/",r=s||"";return`${a}${r}${r?"/":""}${e}`}getFileCategory(e){const l=e.type.toLowerCase();return l.startsWith("image/")?"images":l.startsWith("video/")?"videos":l.startsWith("audio/")?"audio":l.includes("pdf")||l.includes("text/")||l.includes("application/json")?"documents":"files"}async getStorageStats(e){const l=await this.listFiles(e);let s=0;for(const a of l)try{s+=1024}catch{}return{totalFiles:l.length,totalSize:s}}}function qt(n){return new Bt(n)}const xe={"image/jpeg":{ext:["jpg","jpeg"],maxSize:52428800},"image/png":{ext:["png"],maxSize:52428800},"image/gif":{ext:["gif"],maxSize:20971520},"image/webp":{ext:["webp"],maxSize:52428800},"image/svg+xml":{ext:["svg"],maxSize:5242880},"video/mp4":{ext:["mp4"],maxSize:524288e3},"video/webm":{ext:["webm"],maxSize:524288e3},"video/quicktime":{ext:["mov"],maxSize:524288e3},"audio/mpeg":{ext:["mp3"],maxSize:104857600},"audio/wav":{ext:["wav"],maxSize:104857600},"audio/ogg":{ext:["ogg"],maxSize:104857600},"audio/mp4":{ext:["m4a"],maxSize:104857600},"application/pdf":{ext:["pdf"],maxSize:104857600},"text/plain":{ext:["txt"],maxSize:10485760},"application/json":{ext:["json"],maxSize:10485760},"text/csv":{ext:["csv"],maxSize:52428800},"application/msword":{ext:["doc"],maxSize:104857600},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:["docx"],maxSize:104857600},"application/vnd.ms-excel":{ext:["xls"],maxSize:104857600},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:["xlsx"],maxSize:104857600},"application/zip":{ext:["zip"],maxSize:104857600},"application/x-tar":{ext:["tar"],maxSize:104857600}},ve=["exe","bat","cmd","com","pif","scr","vbs","js","jar","app","deb","pkg","rpm","dmg","iso","sh","ps1","msi","dll","sys","ini","reg","lnk","url","desktop","php","asp","jsp","py","rb","pl","cgi","htaccess","config"],Nt={exe:[77,90],elf:[127,69,76,70],script:[35,33],jpeg:[255,216,255],png:[137,80,78,71],gif:[71,73,70],webp:[82,73,70,70],pdf:[37,80,68,70]};class Gt{static async validateFile(e,l={}){const s=[],a=[],r={checkMagicNumbers:!0,sanitizeFileName:!0,...l};try{if(!e||!e.name)return s.push("File object is invalid or missing name"),{valid:!1,errors:s,warnings:a};const o=r.maxSize||1073741824;e.size>o&&s.push(`File size (${this.formatFileSize(e.size)}) exceeds maximum allowed size (${this.formatFileSize(o)})`),e.size===0&&s.push("File is empty");const i=e.name.toLowerCase(),u=this.getFileExtension(i);ve.includes(u)&&s.push(`File extension '.${u}' is not allowed for security reasons`);const c=this.validateMimeType(e,r.allowedTypes);c.valid||s.push(...c.errors),a.push(...c.warnings);let m;if(r.checkMagicNumbers){const v=await this.validateMagicNumbers(e);v.valid||s.push(...v.errors),a.push(...v.warnings),m=v.detectedType}let d;r.sanitizeFileName&&(d=this.sanitizeFileName(e.name),d!==e.name&&a.push(`File name was sanitized: "${e.name}" → "${d}"`));const h=this.performSecurityChecks(e);return s.push(...h.errors),a.push(...h.warnings),{valid:s.length===0,errors:s,warnings:a,sanitizedName:d,detectedType:m}}catch(o){return s.push(`Validation error: ${o instanceof Error?o.message:"Unknown error"}`),{valid:!1,errors:s,warnings:a}}}static validateMimeType(e,l){const s=[],a=[],r=e.type.toLowerCase(),o=this.getFileExtension(e.name.toLowerCase());r in xe||s.push(`MIME type '${r}' is not in the allowed types list`),l&&l.length>0&&(l.some(c=>c.endsWith("/*")?r.startsWith(c.slice(0,-2)):r===c)||s.push(`MIME type '${r}' is not in the custom allowed types`));const i=xe[r];return i&&!i.ext.includes(o)&&a.push(`File extension '.${o}' doesn't match MIME type '${r}'`),i&&e.size>i.maxSize&&s.push(`File size exceeds limit for ${r}: ${this.formatFileSize(e.size)} > ${this.formatFileSize(i.maxSize)}`),{valid:s.length===0,errors:s,warnings:a}}static async validateMagicNumbers(e){const l=[],s=[];let a;try{const r=await e.slice(0,20).arrayBuffer(),o=new Uint8Array(r);for(const[i,u]of Object.entries(Nt))if(this.matchesSignature(o,u)){a=i;break}if(a){const i=e.type.toLowerCase();(a==="exe"||a==="elf"||a==="script")&&l.push(`File contains executable code (detected: ${a}) but is not declared as such`),a==="jpeg"&&!i.includes("jpeg")&&s.push(`File appears to be JPEG but MIME type is '${i}'`),a==="png"&&i!=="image/png"&&s.push(`File appears to be PNG but MIME type is '${i}'`),a==="pdf"&&i!=="application/pdf"&&s.push(`File appears to be PDF but MIME type is '${i}'`)}}catch(r){s.push(`Could not read file content for magic number validation: ${r instanceof Error?r.message:"Unknown error"}`)}return{valid:l.length===0,errors:l,warnings:s,detectedType:a}}static performSecurityChecks(e){const l=[],s=[],a=e.name.toLowerCase(),r=[/\.(exe|bat|cmd|scr|pif|com|vbs|js|jar)$/i,/^(con|prn|aux|nul|com[1-9]|lpt[1-9])(\.|$)/i,/[\x00-\x1f\x7f-\x9f]/,/[<>:"|?*]/,/^\./,/\s+$/,/\.(php|asp|jsp|cgi|pl|py|rb|sh|ps1)$/i];for(const i of r)if(i.test(a)){s.push(`Suspicious file name pattern detected: ${a}`);break}const o=a.split(".");if(o.length>2){const i=o[o.length-2];ve.includes(i)&&l.push(`Suspicious double extension detected: ...${i}.${o[o.length-1]}`)}return e.name.length>255&&l.push("File name is too long (maximum 255 characters)"),{errors:l,warnings:s}}static sanitizeFileName(e){return e.replace(/[<>:"|?*\x00-\x1f\x7f-\x9f]/g,"_").replace(/^[.\s]+|[.\s]+$/g,"").replace(/_+/g,"_")||"unnamed_file"}static getFileExtension(e){const l=e.toLowerCase().split(".");return l.length>1?l[l.length-1]:""}static matchesSignature(e,l){if(e.length<l.length)return!1;for(let s=0;s<l.length;s++)if(e[s]!==l[s])return!1;return!0}static formatFileSize(e){const l=["B","KB","MB","GB"];let s=e,a=0;for(;s>=1024&&a<l.length-1;)s/=1024,a++;return`${s.toFixed(1)} ${l[a]}`}static async validateImageFile(e){return this.validateFile(e,{allowedTypes:["image/jpeg","image/png","image/gif","image/webp"],maxSize:52428800,checkMagicNumbers:!0})}static async validateDocumentFile(e){return this.validateFile(e,{allowedTypes:["application/pdf","text/plain","application/json"],maxSize:104857600,checkMagicNumbers:!0})}static async validateMediaFile(e){return this.validateFile(e,{allowedTypes:["video/*","audio/*"],maxSize:524288e3,checkMagicNumbers:!0})}}const pe=class pe{static async processImage(e,l){try{const s=await this.extractBasicMetadata(e),a=Date.now(),r=Math.random().toString(36).substring(2,8),o=`${a}-${r}-${e.name.replace(/\.[^/.]+$/,"")}`;return l?this.generateCloudflareImageUrls(l,o,s):this.generateFallbackResult(e,o,s)}catch(s){const a=s instanceof Error?s.message:String(s);throw p.error("Cloudflare image processing failed",{error:a,filename:e.name}),new Error(`Image processing failed: ${a}`)}}static async extractBasicMetadata(e){try{return{width:0,height:0,format:e.type.split("/")[1]||"unknown",size:e.size}}catch(l){const s=l instanceof Error?l.message:String(l);throw p.error("Basic metadata extraction failed",{error:s}),new Error(`Metadata extraction failed: ${s}`)}}static generateCloudflareImageUrls(e,l,s){const a=`https://imagedelivery.net/${process.env.CLOUDFLARE_ACCOUNT_HASH}/${e}`;return{original:{url:`${a}/public`,filename:`${l}.${this.getFileExtension(s.format)}`,contentType:this.getMimeType(s.format),size:s.size},thumbnails:{thumbnail:{url:`${a}/thumbnail`,filename:`${l}-thumbnail.webp`,contentType:"image/webp",width:this.SIZES.thumbnail.width,height:this.SIZES.thumbnail.height},medium:{url:`${a}/medium`,filename:`${l}-medium.webp`,contentType:"image/webp",width:this.SIZES.medium.width,height:this.SIZES.medium.height},large:{url:`${a}/large`,filename:`${l}-large.webp`,contentType:"image/webp",width:this.SIZES.large.width,height:this.SIZES.large.height}},metadata:s}}static generateFallbackResult(e,l,s){const r=`${process.env.R2_PUBLIC_URL||"https://files.example.com"}/images/original/${l}.${this.getFileExtension(s.format)}`;return{original:{url:r,filename:`${l}.${this.getFileExtension(s.format)}`,contentType:this.getMimeType(s.format),size:s.size},thumbnails:{thumbnail:{url:`${r}?width=${this.SIZES.thumbnail.width}&height=${this.SIZES.thumbnail.height}&fit=cover&f=webp`,filename:`${l}-thumbnail.webp`,contentType:"image/webp",width:this.SIZES.thumbnail.width,height:this.SIZES.thumbnail.height},medium:{url:`${r}?width=${this.SIZES.medium.width}&height=${this.SIZES.medium.height}&fit=cover&f=webp`,filename:`${l}-medium.webp`,contentType:"image/webp",width:this.SIZES.medium.width,height:this.SIZES.medium.height},large:{url:`${r}?width=${this.SIZES.large.width}&height=${this.SIZES.large.height}&fit=cover&f=webp`,filename:`${l}-large.webp`,contentType:"image/webp",width:this.SIZES.large.width,height:this.SIZES.large.height}},metadata:s}}static async uploadToCloudflareImages(e,l){try{return l.CLOUDFLARE_IMAGES_API_TOKEN||p.warn("Cloudflare Images API not configured, using R2 fallback"),null}catch(s){const a=s instanceof Error?s.message:String(s);return p.error("Cloudflare Images upload failed",{error:a}),null}}static getFileExtension(e){return{jpeg:"jpg",jpg:"jpg",png:"png",webp:"webp",gif:"gif",tiff:"tiff",bmp:"bmp"}[e.toLowerCase()]||"jpg"}static getMimeType(e){return{jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",tiff:"image/tiff",bmp:"image/bmp"}[e.toLowerCase()]||"image/jpeg"}static async createImageVariants(e){try{if(!e.CLOUDFLARE_IMAGES_API_TOKEN){p.info("Cloudflare Images API not configured, skipping variant creation");return}p.info("Image variants creation would be implemented here")}catch(l){const s=l instanceof Error?l.message:String(l);p.error("Failed to create Cloudflare Images variants",{error:s})}}};pe.SIZES={thumbnail:{width:150,height:150},medium:{width:800,height:600},large:{width:1920,height:1080}};let oe=pe;const Vt=async({json:n})=>{n(405,{error:"Method not allowed. Use POST to upload files."})},Re=async({request:n,json:e,env:l,cookie:s})=>{var a,r;try{const{getCurrentUser:o}=await Promise.resolve().then(()=>Ye),i=await o(s);if(!i){e(401,{error:"Authentication required for file uploads"});return}const u=await n.formData(),c=u.get("file"),m=u.get("bucket"),d=i.id,h=Ft(Lt,{file:c,bucket:m});if(!h.success){e(400,{error:"Invalid file upload data",details:h.error.issues.map(x=>x.message)});return}const T=h.data.file,b=await Gt.validateFile(T,{maxSize:1073741824,checkMagicNumbers:!0,sanitizeFileName:!0});if(!b.valid){e(400,{success:!1,error:"File security validation failed",details:b.errors,warnings:b.warnings});return}b.warnings&&b.warnings.length>0&&console.warn("File upload security warnings:",b.warnings);const A=qt({r2Bucket:l.get("R2"),cloudflareAccountId:l.get("CLOUDFLARE_ACCOUNT_ID")||""});if(T.type.startsWith("image/")){const x=await A.uploadFile(T,d);if(!x.success){e(500,{success:!1,error:x.error||"Original image upload failed"});return}const E=await oe.processImage(T);e(200,{success:!0,storage:"r2",type:"image",original:{path:x.path,url:x.url,size:x.size},thumbnails:{thumbnail:{url:E.thumbnails.thumbnail.url,size:0,dimensions:{width:E.thumbnails.thumbnail.width,height:E.thumbnails.thumbnail.height}},medium:{url:E.thumbnails.medium.url,size:0,dimensions:{width:E.thumbnails.medium.width,height:E.thumbnails.medium.height}},large:{url:E.thumbnails.large.url,size:0,dimensions:{width:E.thumbnails.large.width,height:E.thumbnails.large.height}}},metadata:E.metadata,message:"Image uploaded with Cloudflare transformations available",processingType:"cloudflare-images",security:{validated:!0,detectedType:b.detectedType,sanitizedName:b.sanitizedName,warnings:((a=b.warnings)==null?void 0:a.length)>0?b.warnings:void 0}})}else{const x=await A.uploadFile(T,d);if(!x.success){e(500,{success:!1,error:x.error||"Upload failed"});return}e(200,{success:!0,storage:"r2",type:"file",path:x.path,url:x.url,size:x.size,message:"File uploaded successfully to R2",security:{validated:!0,detectedType:b.detectedType,sanitizedName:b.sanitizedName,warnings:((r=b.warnings)==null?void 0:r.length)>0?b.warnings:void 0}})}}catch(o){const{statusCode:i,body:u}=de(o);e(i,u)}},Ht=Object.freeze(Object.defineProperty({__proto__:null,onGet:Vt,onPost:Re},Symbol.toStringTag,{value:"Module"})),Wt=async n=>Pe(n),Kt=async n=>Re(n),Qt=Object.freeze(Object.defineProperty({__proto__:null,onGet:Wt,onPost:Kt},Symbol.toStringTag,{value:"Module"}));class Jt{constructor(){this.supabase=M()}async getPages(e={}){try{const{page:l=1,limit:s=20,search:a,published:r,author_id:o}=e,i=(l-1)*s;let u=this.supabase.from("pages").select("*",{count:"exact"}).is("deleted_at",null).order("created_at",{ascending:!1});r!==void 0&&(u=u.eq("published",r)),o&&(u=u.eq("author_id",o)),a&&(u=u.or(`title.ilike.%${a}%,description.ilike.%${a}%,slug.ilike.%${a}%`)),u=u.range(i,i+s-1);const{data:c,error:m,count:d}=await u;if(m)throw new Error(`Failed to fetch pages: ${m.message}`);const h=d||0,v=Math.ceil(h/s);return{data:c||[],pagination:{page:l,limit:s,total:h,totalPages:v,hasMore:l<v}}}catch(l){throw p.error("Error fetching pages",{},l),l}}async getPage(e,l=!1){try{const s=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e);let a=this.supabase.from("pages").select("*").is("deleted_at",null).single();s?a=a.eq("id",e):a=a.eq("slug",e);const{data:r,error:o}=await a;if(o&&o.code!=="PGRST116")throw new Error(`Failed to fetch page: ${o.message}`);if(!r)return null;let i=[];if(l){const{data:u,error:c}=await this.supabase.from("content_blocks").select("*").eq("page_id",r.id).order("order_index",{ascending:!0});c?p.error("Error fetching content blocks",{pageId:r.id},c):i=u||[]}return{...r,blocks:i}}catch(s){throw p.error("Error fetching page",{identifier:e},s),s}}async createPage(e,l){try{if(await this.getPage(e.slug))throw new Error(`Page with slug "${e.slug}" already exists`);e.title,e.slug,e.description,e.template,e.published,e.published&&new Date().toISOString();const{data:a,error:r}=await this.supabase.rpc("create_page_with_template",{page_title:e.title,page_slug:e.slug,template_name:e.template||"default",author_uuid:l});if(r)throw new Error(`Failed to create page: ${r.message}`);const o=await this.getPage(a);if(!o)throw new Error("Page was created but could not be retrieved");return p.info("Page created successfully",{pageId:o.id,title:o.title,slug:o.slug}),o}catch(s){throw p.error("Error creating page",e,s),s}}async updatePage(e,l,s){try{const a=await this.getPage(e);if(!a)throw new Error("Page not found");if(a.author_id!==s)throw new Error("Permission denied: You can only update your own pages");if(l.slug&&l.slug!==a.slug&&await this.getPage(l.slug))throw new Error(`Page with slug "${l.slug}" already exists`);const r={...l,updated_at:new Date().toISOString()};l.published!==void 0&&(l.published&&!a.published?r.published_at=new Date().toISOString():!l.published&&a.published&&(r.published_at=null));const{data:o,error:i}=await this.supabase.from("pages").update(r).eq("id",e).eq("author_id",s).select().single();if(i)throw new Error(`Failed to update page: ${i.message}`);return p.info("Page updated successfully",{pageId:e,updates:Object.keys(l)}),o}catch(a){throw p.error("Error updating page",{pageId:e,updates:l},a),a}}async deletePage(e,l){try{const s=await this.getPage(e);if(!s)throw new Error("Page not found");if(s.author_id!==l)throw new Error("Permission denied: You can only delete your own pages");const{error:a}=await this.supabase.from("pages").update({deleted_at:new Date().toISOString(),published:!1,updated_at:new Date().toISOString()}).eq("id",e).eq("author_id",l);if(a)throw new Error(`Failed to delete page: ${a.message}`);p.info("Page deleted successfully",{pageId:e})}catch(s){throw p.error("Error deleting page",{pageId:e},s),s}}async togglePublished(e,l,s){try{return this.updatePage(e,{published:l},s)}catch(a){throw p.error("Error toggling page published status",{pageId:e,published:l},a),a}}async getPagesByAuthor(e,l={}){return this.getPages({...l,author_id:e})}async getPublishedPages(e={}){return this.getPages({...e,published:!0})}async getPageTemplates(){try{const{data:e,error:l}=await this.supabase.from("page_templates").select("*").eq("active",!0).order("name");if(l)throw new Error(`Failed to fetch page templates: ${l.message}`);return e||[]}catch(e){throw p.error("Error fetching page templates",{},e),e}}async searchPages(e,l={}){try{const{published:s,limit:a=10}=l;let r=this.supabase.from("pages").select("*").is("deleted_at",null).or(`title.ilike.%${e}%,description.ilike.%${e}%,content.cs.{"text": "${e}"}`).order("view_count",{ascending:!1}).limit(a);s!==void 0&&(r=r.eq("published",s));const{data:o,error:i}=await r;if(i)throw new Error(`Failed to search pages: ${i.message}`);return o||[]}catch(s){throw p.error("Error searching pages",{query:e,options:l},s),s}}async incrementViewCount(e){try{const{data:l}=await this.supabase.from("pages").select("view_count").eq("id",e).single();if(l){const{error:s}=await this.supabase.from("pages").update({view_count:(l.view_count||0)+1}).eq("id",e);s&&p.warn("Failed to increment view count",{pageId:e,error:s.message})}}catch{p.warn("Error incrementing view count",{pageId:e})}}}const W=new Jt;class Yt{constructor(){this.supabase=M()}async getPageBlocks(e){try{const{data:l,error:s}=await this.supabase.from("content_blocks").select("*").eq("page_id",e).order("order_index",{ascending:!0});if(s)throw new Error(`Failed to fetch content blocks: ${s.message}`);return l||[]}catch(l){throw p.error("Error fetching page blocks",{pageId:e},l),l}}async getBlocksByRegion(e,l){try{const{data:s,error:a}=await this.supabase.from("content_blocks").select("*").eq("page_id",e).eq("region",l).order("order_index",{ascending:!0});if(a)throw new Error(`Failed to fetch blocks for region: ${a.message}`);return s||[]}catch(s){throw p.error("Error fetching blocks by region",{pageId:e,region:l},s),s}}async getBlock(e){try{const{data:l,error:s}=await this.supabase.from("content_blocks").select("*").eq("id",e).single();if(s&&s.code!=="PGRST116")throw new Error(`Failed to fetch content block: ${s.message}`);return l||null}catch(l){throw p.error("Error fetching content block",{blockId:e},l),l}}async createBlock(e){var l;try{let s=e.order_index;if(s===void 0){const{data:i}=await this.supabase.from("content_blocks").select("order_index").eq("page_id",e.page_id).eq("region",e.region||"main").order("order_index",{ascending:!1}).limit(1);s=(((l=i==null?void 0:i[0])==null?void 0:l.order_index)||-1)+1}const a={page_id:e.page_id,block_type:e.block_type,component_name:e.component_name||e.block_type,properties:e.properties||{},children:e.children||[],order_index:s,region:e.region||"main",parent_block_id:e.parent_block_id||null,visibility_rules:{},block_version:"1.0.0"},{data:r,error:o}=await this.supabase.from("content_blocks").insert(a).select().single();if(o)throw new Error(`Failed to create content block: ${o.message}`);return p.info("Content block created successfully",{blockId:r.id,pageId:e.page_id,type:e.block_type}),r}catch(s){throw p.error("Error creating content block",e,s),s}}async updateBlock(e,l){try{const s={...l,updated_at:new Date().toISOString()},{data:a,error:r}=await this.supabase.from("content_blocks").update(s).eq("id",e).select().single();if(r)throw new Error(`Failed to update content block: ${r.message}`);return p.info("Content block updated successfully",{blockId:e,updates:Object.keys(l)}),a}catch(s){throw p.error("Error updating content block",{blockId:e,updates:l},s),s}}async deleteBlock(e){try{const l=await this.getBlock(e);if(!l)throw new Error("Content block not found");const{error:s}=await this.supabase.from("content_blocks").delete().eq("id",e);if(s)throw new Error(`Failed to delete content block: ${s.message}`);await this.reorderBlocksAfterDeletion(l.page_id,l.region,l.order_index),p.info("Content block deleted successfully",{blockId:e})}catch(l){throw p.error("Error deleting content block",{blockId:e},l),l}}async reorderBlocks(e,l,s){var a;try{const r=s.blocks.map(u=>this.supabase.from("content_blocks").update({order_index:u.order_index,updated_at:new Date().toISOString()}).eq("id",u.id).eq("page_id",e).eq("region",l)),i=(await Promise.all(r)).filter(u=>u.error);if(i.length>0)throw new Error(`Failed to reorder blocks: ${(a=i[0].error)==null?void 0:a.message}`);p.info("Blocks reordered successfully",{pageId:e,region:l,blocksCount:s.blocks.length})}catch(r){throw p.error("Error reordering blocks",{pageId:e,region:l,reorderData:s},r),r}}async moveBlockToRegion(e,l,s){var a;try{const r=await this.getBlock(e);if(!r)throw new Error("Content block not found");let o=s;if(o===void 0){const{data:u}=await this.supabase.from("content_blocks").select("order_index").eq("page_id",r.page_id).eq("region",l).order("order_index",{ascending:!1}).limit(1);o=(((a=u==null?void 0:u[0])==null?void 0:a.order_index)||-1)+1}const i=await this.updateBlock(e,{region:l,order_index:o});return await this.reorderBlocksAfterDeletion(r.page_id,r.region,r.order_index),p.info("Block moved to new region",{blockId:e,oldRegion:r.region,newRegion:l,orderIndex:o}),i}catch(r){throw p.error("Error moving block to region",{blockId:e,newRegion:l},r),r}}async duplicateBlock(e){try{const l=await this.getBlock(e);if(!l)throw new Error("Content block not found");const s={page_id:l.page_id,block_type:l.block_type,component_name:l.component_name||void 0,properties:l.properties,children:l.children,region:l.region,parent_block_id:l.parent_block_id||void 0},a=await this.createBlock(s);return p.info("Block duplicated successfully",{originalBlockId:e,duplicatedBlockId:a.id}),a}catch(l){throw p.error("Error duplicating block",{blockId:e},l),l}}async getAvailableComponents(){try{const{data:e,error:l}=await this.supabase.from("component_library").select("*").eq("active",!0).order("category",{ascending:!0}).order("name",{ascending:!0});if(l)throw new Error(`Failed to fetch component library: ${l.message}`);return e||[]}catch(e){throw p.error("Error fetching available components",{},e),e}}async reorderBlocksAfterDeletion(e,l,s){try{const{data:a,error:r}=await this.supabase.from("content_blocks").select("id, order_index").eq("page_id",e).eq("region",l).gt("order_index",s).order("order_index",{ascending:!0});if(r)throw new Error(`Failed to fetch blocks for reordering: ${r.message}`);if(!a||a.length===0)return;const o=a.map(i=>this.supabase.from("content_blocks").update({order_index:i.order_index-1,updated_at:new Date().toISOString()}).eq("id",i.id));await Promise.all(o),p.info("Blocks reordered after deletion",{pageId:e,region:l,reorderedCount:a.length})}catch(a){p.error("Error reordering blocks after deletion",{pageId:e,region:l,deletedOrderIndex:s},a)}}}new Yt;class Me extends Error{constructor(e,l,s){super(e),this.code=l,this.statusCode=s,this.name="CMSError"}}const Zt=n=>/^[a-z0-9-]+$/.test(n),Xt=n=>n.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),el=n=>n.length>=1&&n.length<=200,tl=async({json:n,query:e,cookie:l})=>{try{const s=parseInt(e.get("page")||"1"),a=Math.min(parseInt(e.get("limit")||"20"),50),r=e.get("search")||void 0,o=e.get("published")?e.get("published")==="true":void 0,i=e.get("author_only")==="true";let u;if(i){const m=l.get("sb-access-token");if(!m){n(401,{error:"Authentication required for author-only requests"});return}try{const{data:{user:d},error:h}=await supabase.auth.getUser(m.value);if(h||!d){p.warn("Invalid session token for author filter",{error:h==null?void 0:h.message}),n(401,{error:"Invalid session token"});return}u=d.id}catch(d){p.warn("Failed to validate session token for author filter",{error:d instanceof Error?d.message:String(d)}),n(401,{error:"Invalid session token"});return}}const c=await W.getPages({page:s,limit:a,search:r,published:o,author_id:u});p.info("Pages fetched successfully",{page:s,limit:a,total:c.pagination.total,search:r||"none"}),n(200,{pages:c.data,pagination:c.pagination})}catch(s){p.error("Error fetching pages",{},s),s instanceof Me?n(s.statusCode||500,{error:s.message,code:s.code}):n(500,{error:"Failed to fetch pages",details:s instanceof Error?s.message:"Unknown error"})}},ll=async({json:n,parseBody:e,cookie:l})=>{try{const s=await e();if(!s||typeof s!="object"){n(400,{error:"Invalid request body"});return}const{title:a,slug:r,description:o,template:i,published:u}=s;if(!a||typeof a!="string"){n(400,{error:"Title is required and must be a string"});return}if(!el(a)){n(400,{error:"Title must be between 1 and 200 characters"});return}let c=r;if(!c)c=Xt(a);else if(!Zt(c)){n(400,{error:"Slug must contain only lowercase letters, numbers, and hyphens"});return}const m=l.get("sb-access-token");if(!m){n(401,{error:"Authentication required"});return}let d=null;try{const{data:{user:T},error:b}=await supabase.auth.getUser(m.value);if(b||!T){p.warn("Invalid session token",{error:b==null?void 0:b.message}),n(401,{error:"Invalid session token"});return}d=T.id}catch(T){p.warn("Failed to validate session token",{error:T instanceof Error?T.message:String(T)}),n(401,{error:"Invalid session token"});return}const h={title:a.trim(),slug:c,description:o?o.trim():void 0,template:i||"default",published:u===!0},v=await W.createPage(h,d);p.info("Page created successfully",{pageId:v.id,title:v.title,slug:v.slug,published:v.published}),n(201,{success:!0,page:{id:v.id,title:v.title,slug:v.slug,description:v.description,template:v.template,published:v.published,created_at:v.created_at,url:`/${v.slug}`}})}catch(s){if(p.error("Error creating page",{},s),s instanceof Me)n(s.statusCode||500,{error:s.message,code:s.code});else{const a=s instanceof Error?s.message:"Unknown error";a.includes("duplicate key")||a.includes("already exists")?n(409,{error:"A page with this slug already exists",code:"DUPLICATE_SLUG"}):a.includes("violates check constraint")?n(400,{error:"Invalid page data",code:"VALIDATION_ERROR"}):n(500,{error:"Failed to create page",details:a})}}},sl=Object.freeze(Object.defineProperty({__proto__:null,onGet:tl,onPost:ll},Symbol.toStringTag,{value:"Module"})),nl=async({json:n,query:e})=>{try{const l=M(),s=parseInt(e.get("page")||"1"),a=parseInt(e.get("limit")||"10"),r=(s-1)*a,{data:o,error:i,count:u}=await l.from("pages").select("*",{count:"exact"}).eq("published",!0).order("created_at",{ascending:!1}).range(r,r+a-1);if(i)throw i;n(200,{posts:o||[],pagination:{page:s,limit:a,total:u||0,pages:Math.ceil((u||0)/a)}})}catch(l){n(500,{error:"Failed to fetch posts",details:l instanceof Error?l.message:"Unknown error"})}},al=async({json:n,request:e})=>{var l;try{const s=M(),a=await e.json(),{data:r,error:o}=await s.from("pages").insert([{title:a.title||"Untitled",content:a.content||null,slug:a.slug||((l=a.title)==null?void 0:l.toLowerCase().replace(/\s+/g,"-"))||"untitled",published:a.published||!1,description:a.content||""}]).select().single();if(o)throw o;n(201,{post:r})}catch(s){n(500,{error:"Failed to create post",details:s instanceof Error?s.message:"Unknown error"})}},rl=Object.freeze(Object.defineProperty({__proto__:null,onGet:nl,onPost:al},Symbol.toStringTag,{value:"Module"})),ol=async({json:n,query:e})=>{const l=e.get("q"),s=e.get("type");if(!l){n(400,{error:"Search query is required"});return}try{const a={query:l,results:{pages:[],posts:[],media:[]},total:0};if(!s||s==="posts"){const r=M(),{data:o}=await r.from("posts").select("id, title, content, slug, created_at").or(`title.ilike.%${l}%,content.ilike.%${l}%`).limit(10);a.results.posts=(o==null?void 0:o.map(i=>{var u;return{id:i.id,title:i.title,type:"post",url:`/posts/${i.slug}`,excerpt:((u=i.content)==null?void 0:u.substring(0,150))+"...",created_at:i.created_at}}))||[]}if(!s||s==="pages"){const r=M();try{const{data:o}=await r.from("pages").select("id, title, description, slug, created_at").or(`title.ilike.%${l}%,description.ilike.%${l}%`).eq("published",!0).limit(10);a.results.pages=(o==null?void 0:o.map(i=>({id:i.id,title:i.title,type:"page",url:`/${i.slug}`,excerpt:i.description||"",created_at:i.created_at})))||[]}catch(o){console.error("Pages search error:",o),a.results.pages=[]}}if(!s||s==="media"){const r=M(),{data:o}=await r.from("uploaded_files").select("id, original_name, file_type, url, uploaded_at").ilike("original_name",`%${l}%`).limit(10);a.results.media=(o==null?void 0:o.map(i=>({id:i.id,title:i.original_name,type:"media",url:i.url,file_type:i.file_type,created_at:i.uploaded_at})))||[]}a.total=a.results.pages.length+a.results.posts.length+a.results.media.length,n(200,a)}catch(a){n(500,{error:"Search failed",details:a instanceof Error?a.message:"Unknown error"})}},il=Object.freeze(Object.defineProperty({__proto__:null,onGet:ol},Symbol.toStringTag,{value:"Module"}));async function we(n,e){try{const l=new Date(Date.now()-3e5).toISOString(),{data:s,error:a}=await e.from("user_sessions").select("session_id").eq("user_id",n).gte("last_activity",l).eq("active",!0);return a?(p.warn("Failed to get session count",{userId:n,error:a.message}),0):(s==null?void 0:s.length)||0}catch(l){return p.warn("Session count query failed",{userId:n,error:l instanceof Error?l.message:String(l)}),0}}const ul=async({json:n,env:e,request:l})=>{try{const s=l.headers.get("authorization");if(!s||!s.startsWith("Bearer ")){n(401,{error:"Authentication required"});return}const a=e.get("SUPABASE_URL")||"",r=e.get("SUPABASE_SERVICE_ROLE_KEY")||"";if(!a||!r){n(500,{error:"Server configuration error"});return}const o=Z(a,r),i=s.replace("Bearer ",""),{data:{user:u},error:c}=await o.auth.getUser(i);if(c||!u){n(401,{error:"Invalid authentication"});return}const{data:m,error:d}=await o.from("user_file_stats").select("*").eq("user_id",u.id).single();if(d){n(200,{totalFiles:0,totalSize:0,storageUsed:"0 B",imageCount:0,videoCount:0,audioCount:0,documentCount:0,lastUpload:null,avgFileSize:0,activeSessions:await we(u.id,o)});return}const h=v=>{const T=["B","KB","MB","GB","TB"];if(v===0)return"0 B";const b=Math.floor(Math.log(v)/Math.log(1024));return`${(v/Math.pow(1024,b)).toFixed(1)} ${T[b]}`};n(200,{totalFiles:m.total_files||0,totalSize:m.total_size||0,storageUsed:h(m.total_size||0),imageCount:m.image_count||0,videoCount:m.video_count||0,audioCount:m.audio_count||0,documentCount:m.document_count||0,lastUpload:m.last_upload,avgFileSize:Math.round(m.avg_file_size||0),activeSessions:await we(u.id,o)})}catch(s){const{statusCode:a,body:r}=de(s);n(a,r)}},cl=Object.freeze(Object.defineProperty({__proto__:null,onGet:ul},Symbol.toStringTag,{value:"Module"})),dl=async({query:n,json:e,platform:l,error:s})=>{var o;const a=n.get("key"),r=parseInt(n.get("expires")||"3600");if(!a)throw s(400,"Missing key parameter");if(!((o=l==null?void 0:l.env)!=null&&o.R2))throw s(500,"R2 storage not configured");try{const i=new URL(`/api/storage/proxy/${a}`,l.request.url);e(200,{url:i.toString(),expires:new Date(Date.now()+r*1e3).toISOString()})}catch{throw s(500,"Failed to generate signed URL")}},gl=Object.freeze(Object.defineProperty({__proto__:null,onGet:dl},Symbol.toStringTag,{value:"Module"}));class pl{constructor(e){this.kv=e}async get(e){const l=await this.kv.get(e);if(!l)return null;try{return JSON.parse(l)}catch{return l}}async set(e,l,s){const a={};s&&(a.expirationTtl=s);const r=typeof l=="string"?l:JSON.stringify(l);await this.kv.put(e,r,a)}async delete(e){await this.kv.delete(e)}async list(e){return(await this.kv.list({prefix:e})).keys.map(s=>s.name)}}class ml{constructor(e){this.r2=e}async upload(e,l){return await this.r2.put(e,l)}async get(e){return await this.r2.get(e)}async delete(e){await this.r2.delete(e)}async list(e){return await this.r2.list({prefix:e})}async createSignedUrl(e,l){const s=new URL("/api/storage/signed-url","https://your-domain.com");return s.searchParams.set("key",e),s.searchParams.set("expires",l.toString()),s.toString()}}function ee(n){return n.env?{kv:n.env.KV?new pl(n.env.KV):null,r2:n.env.R2?new ml(n.env.R2):null,env:n.env}:{kv:null,r2:null,env:void 0}}const hl=async({params:n,platform:e,error:l,cacheControl:s,send:a})=>{var o,i;const r=n.path;if(!r||!((o=e==null?void 0:e.env)!=null&&o.R2))throw l(404,"File not found");try{const c=await ee(e).r2.get(r);if(!c)throw new be("File");s({maxAge:2592e3,sMaxAge:31536e3,public:!0,immutable:!0}),a(new Response(c.body,{headers:{"Content-Type":((i=c.httpMetadata)==null?void 0:i.contentType)||"application/octet-stream","Content-Length":c.size.toString(),ETag:c.httpEtag||"","Cache-Control":"public, max-age=2592000, immutable"}}))}catch(u){throw u instanceof be?l(404,"File not found"):l(500,"Failed to retrieve file")}},fl=Object.freeze(Object.defineProperty({__proto__:null,onGet:hl},Symbol.toStringTag,{value:"Module"})),bl=async({json:n,platform:e,error:l,query:s})=>{const a=ee(e);if(!a.kv)throw l(503,"KV storage not available");const r=s.get("key");if(!r)throw l(400,"Key parameter required");try{const o=await a.kv.get(r);n(200,{key:r,value:o,found:o!==null})}catch{throw l(500,"Failed to get cache value")}},yl=async({json:n,platform:e,error:l,request:s})=>{const a=ee(e);if(!a.kv)throw l(503,"KV storage not available");try{const r=await s.json(),{key:o,value:i,ttl:u}=r;if(!o)throw l(400,"Key is required");await a.kv.set(o,i,u),n(200,{success:!0,key:o})}catch{throw l(500,"Failed to set cache value")}},xl=async({json:n,platform:e,error:l,query:s})=>{const a=ee(e);if(!a.kv)throw l(503,"KV storage not available");const r=s.get("key");if(!r)throw l(400,"Key parameter required");try{await a.kv.delete(r),n(200,{success:!0,key:r})}catch{throw l(500,"Failed to delete cache value")}},vl=Object.freeze(Object.defineProperty({__proto__:null,onDelete:xl,onGet:bl,onPost:yl},Symbol.toStringTag,{value:"Module"})),wl=async({json:n})=>{n(200,{message:"Unified Content Management API",version:"1.0.0",contentTypes:{pages:{description:"Visual pages and landing pages",provider:"Builder.io",endpoints:["GET /api/content/pages - List all pages","GET /api/content/pages/{id} - Get specific page","POST /api/content/pages - Create new page","PUT /api/content/pages/{id} - Update page","DELETE /api/content/pages/{id} - Delete page"]},posts:{description:"Blog posts and articles",provider:"Supabase",endpoints:["GET /api/content/posts - List all posts","GET /api/content/posts/{id} - Get specific post","POST /api/content/posts - Create new post","PUT /api/content/posts/{id} - Update post","DELETE /api/content/posts/{id} - Delete post"]},media:{description:"Files, images, and assets",provider:"R2 + Supabase",endpoints:["GET /api/content/media - List all media","POST /api/content/media - Upload new media","DELETE /api/content/media/{id} - Delete media"]},search:{description:"Unified search across all content",provider:"Multi-source",endpoints:["GET /api/content/search?q={query} - Search all content types","GET /api/content/search/{type}?q={query} - Search specific type"]}},documentation:"/api/docs"})},_l=Object.freeze(Object.defineProperty({__proto__:null,onGet:wl},Symbol.toStringTag,{value:"Module"})),N={title:"Qwik LIT Builder App API",version:"2.0.0",description:"REST API for file management, dashboard analytics, cache management, and health monitoring",endpoints:{"GET /api/health":{description:"Health check endpoint with service status",params:{},response:{status:"healthy",timestamp:"ISO string",checks:"object"}},"POST /api/upload":{description:"File upload to R2 storage with database metadata",params:{file:"File",bucket:"string",userId:"string?"},response:{success:!0,storage:"r2",path:"string",url:"string",size:"number"}},"GET /api/dashboard/stats":{description:"Real-time dashboard statistics from database",params:{},headers:{Authorization:"Bearer JWT_TOKEN"},response:{totalFiles:"number",totalSize:"number",storageUsed:"string",imageCount:"number",videoCount:"number",audioCount:"number",documentCount:"number",lastUpload:"string|null",avgFileSize:"number",activeSessions:"number"}},"GET /api/files/list":{description:"List user files with pagination and filtering",params:{page:"number?",limit:"number?",filter:"string?",search:"string?"},headers:{Authorization:"Bearer JWT_TOKEN"},response:{files:"MediaFile[]",pagination:{page:"number",total:"number",hasMore:"boolean"},stats:{totalFiles:"number",filteredCount:"number"}}},"GET /api/cache":{description:"Get cached value by key",params:{key:"string"},response:{key:"string",value:"any",found:"boolean"}},"POST /api/cache":{description:"Set cache value with optional TTL",body:{key:"string",value:"any",ttl:"number?"},response:{success:!0,key:"string"}},"DELETE /api/cache":{description:"Delete cached value by key",params:{key:"string"},response:{success:!0,key:"string"}}},errors:{400:{code:"BAD_REQUEST",message:"Invalid request parameters"},404:{code:"NOT_FOUND",message:"Resource not found"},500:{code:"INTERNAL_ERROR",message:"Internal server error"},503:{code:"SERVICE_UNAVAILABLE",message:"Service temporarily unavailable"}}},Sl=async({json:n,headers:e})=>{e.set("Content-Type","application/json"),n(200,N)},kl=()=>t("div",null,{class:"container mx-auto py-8"},[t("h1",null,{class:"text-3xl font-bold mb-8"},"API Documentation",3,null),t("div",null,{class:"bg-white rounded-lg shadow p-6 mb-8"},[t("h2",null,{class:"text-xl font-semibold mb-4"},"Overview",3,null),t("p",null,{class:"text-gray-600 mb-2"},["Version: ",N.version],3,null),t("p",null,{class:"text-gray-600"},N.description,3,null)],3,null),t("div",null,{class:"space-y-6"},[t("h2",null,{class:"text-2xl font-semibold"},"Endpoints",3,null),Object.entries(N.endpoints).map(([n,e])=>{const[l,s]=n.split(" ");return t("div",null,{class:"bg-white rounded-lg shadow p-6"},[t("div",null,{class:"flex items-center gap-4 mb-4"},[t("span",{class:`px-3 py-1 rounded text-white text-sm font-medium ${l==="GET"?"bg-blue-500":l==="POST"?"bg-green-500":l==="PUT"?"bg-yellow-500":l==="DELETE"?"bg-red-500":"bg-gray-500"}`},null,l,1,null),t("code",null,{class:"text-lg font-mono"},s,1,null)],1,null),t("p",null,{class:"text-gray-600 mb-4"},S(e,"description"),1,null),"params"in e&&e.params&&Object.keys(e.params).length>0&&t("div",null,{class:"mb-4"},[t("h4",null,{class:"font-semibold mb-2"},"Parameters:",3,null),t("pre",null,{class:"bg-gray-100 p-3 rounded text-sm overflow-x-auto"},JSON.stringify(e.params,null,2),1,null)],1,"Q5_0"),"body"in e&&e.body&&t("div",null,{class:"mb-4"},[t("h4",null,{class:"font-semibold mb-2"},"Request Body:",3,null),t("pre",null,{class:"bg-gray-100 p-3 rounded text-sm overflow-x-auto"},typeof e.body=="string"?e.body:JSON.stringify(e.body,null,2),1,null)],1,"Q5_1"),e.response&&t("div",null,null,[t("h4",null,{class:"font-semibold mb-2"},"Response:",3,null),t("pre",null,{class:"bg-gray-100 p-3 rounded text-sm overflow-x-auto"},typeof e.response=="string"?e.response:JSON.stringify(e.response,null,2),1,null)],1,"Q5_2")],1,n)})],1,null),t("div",null,{class:"mt-12"},[t("h2",null,{class:"text-2xl font-semibold mb-6"},"Error Responses",3,null),t("div",null,{class:"grid md:grid-cols-2 gap-4"},Object.entries(N.errors).map(([n,e])=>t("div",null,{class:"bg-white rounded-lg shadow p-4"},[t("div",null,{class:"flex items-center justify-between mb-2"},[t("span",null,{class:"text-lg font-semibold"},["HTTP ",n],1,null),t("code",null,{class:"text-sm text-red-600"},S(e,"code"),1,null)],1,null),t("p",null,{class:"text-gray-600"},S(e,"message"),1,null)],1,n)),1,null)],1,null)],1,"Q5_3"),El=O(y(kl,"s_k97l0w6myfc")),Cl=Object.freeze(Object.defineProperty({__proto__:null,_auto_API_DOCS:N,default:El,onGet:Sl},Symbol.toStringTag,{value:"Module"})),Tl=_.object({message:_.string(),stack:_.string().optional(),context:_.object({userId:_.string().optional(),sessionId:_.string().optional(),route:_.string().optional(),timestamp:_.string(),userAgent:_.string().optional(),metadata:_.record(_.any()).optional()}),severity:_.enum(["low","medium","high","critical"]),category:_.enum(["ui","api","auth","data","network","system"])}),Pl=async({json:n,request:e,platform:l})=>{var s;try{const a=await e.json(),r=Tl.parse(a),o={timestamp:new Date().toISOString(),level:r.severity==="critical"||r.severity==="high"?"error":r.severity==="medium"?"warn":"info",message:r.message,category:r.category,severity:r.severity,context:r.context,stack:r.stack,userAgent:e.headers.get("user-agent"),ip:e.headers.get("cf-connecting-ip")||e.headers.get("x-forwarded-for")||"unknown"};if(console.log(JSON.stringify(o)),r.severity==="critical"&&((s=l==null?void 0:l.env)!=null&&s.ERROR_LOGS)){const i=`critical_error_${Date.now()}_${Math.random().toString(36).slice(2)}`;await l.env.ERROR_LOGS.put(i,JSON.stringify(o),{expirationTtl:604800})}await Rl(o),n(200,{success:!0,data:{errorId:`err_${Date.now()}_${Math.random().toString(36).slice(2)}`}})}catch(a){console.error("Error processing error report:",a),n(500,{error:"Failed to process error report"})}};async function Rl(n){try{const e=process.env.SENTRY_DSN;if(e&&n.severity==="critical"){const l=`${e.replace("/sentry.io/","/sentry.io/api/")}/store/`;await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-Sentry-Auth":`Sentry sentry_version=7, sentry_key=${e.split("@")[0].split("//")[1]}`},body:JSON.stringify({message:n.message,level:n.level,platform:"javascript",timestamp:n.timestamp,tags:{category:n.category,severity:n.severity},extra:{context:n.context,userAgent:n.userAgent,ip:n.ip},exception:n.stack?[{type:"Error",value:n.message,stacktrace:{frames:n.stack.split(`
`).map(s=>({filename:"unknown",function:s.trim(),lineno:0}))}}]:void 0})})}process.env.ERROR_WEBHOOK_URL&&n.severity==="critical"&&await fetch(process.env.ERROR_WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:`🚨 Critical Error: ${n.message}`,attachments:[{color:"danger",fields:[{title:"Category",value:n.category,short:!0},{title:"Route",value:n.context.route||"unknown",short:!0},{title:"User Agent",value:n.userAgent||"unknown",short:!1},{title:"Stack Trace",value:n.stack||"No stack trace",short:!1}]}]})})}catch{}}const Ml=async({json:n})=>{n(200,{success:!0,data:{service:"error-reporting",status:"healthy",timestamp:new Date().toISOString()}})},Al=Object.freeze(Object.defineProperty({__proto__:null,onGet:Ml,onPost:Pl},Symbol.toStringTag,{value:"Module"})),F={requestCount:0,errorCount:0,lastReset:Date.now(),responseTimes:[]};function Dl(){F.requestCount++}function $l(){F.errorCount++}function Ol(n){F.responseTimes.push(n),F.responseTimes.length>100&&F.responseTimes.shift()}async function Ll(n){var l,s;const e=Date.now();try{const a=((l=n==null?void 0:n.env)==null?void 0:l.VITE_SUPABASE_URL)||"",r=((s=n==null?void 0:n.env)==null?void 0:s.VITE_SUPABASE_ANON_KEY)||"";if(a.includes("placeholder")||a.includes("your-project-id")||!a||!r)return{status:"warn",responseTime:Date.now()-e,message:"Database not configured for development",provider:"supabase",details:{mode:"development",configured:!1}};const{createClient:i}=await import("@supabase/supabase-js"),u=i(a,r),{error:c}=await u.from("profiles").select("count").limit(1),m=Date.now()-e;if(c)throw new Error(c.message);return m>1e3?{status:"warn",responseTime:m,message:"Database response time is high",provider:"supabase",details:{threshold:1e3}}:{status:"pass",responseTime:m,message:"Database connection successful",provider:"supabase"}}catch(a){return{status:"warn",responseTime:Date.now()-e,message:"Database connection failed (development mode)",provider:"supabase",details:{error:a instanceof Error?a.message:"Unknown error",mode:"development"}}}}async function Fl(n){var l;const e=Date.now();try{return(l=n==null?void 0:n.env)!=null&&l.R2?(await n.env.R2.head("health-check.txt"),{status:"pass",responseTime:Date.now()-e,message:"Storage service operational",provider:"cloudflare-r2"}):{status:"warn",responseTime:Date.now()-e,message:"R2 storage not configured",provider:"cloudflare-r2"}}catch(s){const a=Date.now()-e;return a<5e3?{status:"pass",responseTime:a,message:"Storage service operational",provider:"cloudflare-r2"}:{status:"fail",responseTime:a,message:"Storage service unavailable",provider:"cloudflare-r2",details:{error:s instanceof Error?s.message:"Unknown error"}}}}async function Il(n){var l;const e=Date.now();try{return(l=n==null?void 0:n.env)!=null&&l.KV?(await n.env.KV.get("health-check"),{status:"pass",responseTime:Date.now()-e,message:"Cache service operational",provider:"cloudflare-kv"}):{status:"warn",responseTime:Date.now()-e,message:"KV cache not configured",provider:"cloudflare-kv"}}catch(s){return{status:"fail",responseTime:Date.now()-e,message:"Cache service unavailable",provider:"cloudflare-kv",details:{error:s instanceof Error?s.message:"Unknown error"}}}}async function zl(){const n=Date.now();try{const l=new AbortController,s=setTimeout(()=>l.abort(),1e3),a=await Promise.allSettled([fetch("https://api.github.com/zen",{method:"GET",signal:l.signal}).then(i=>i.ok),fetch("https://httpbin.org/status/200",{method:"HEAD",signal:l.signal}).then(i=>i.ok)]);clearTimeout(s);const r=Date.now()-n,o=a.filter(i=>i.status==="fulfilled"&&i.value===!0).length;return o===0?{status:"fail",responseTime:r,message:"All external services unavailable",details:{totalChecks:a.length,passed:o}}:o<a.length?{status:"warn",responseTime:r,message:"Some external services unavailable",details:{totalChecks:a.length,passed:o}}:{status:"pass",responseTime:r,message:"External services accessible",details:{totalChecks:a.length,passed:o}}}catch(e){return{status:"fail",responseTime:Date.now()-n,message:"External services check failed",details:{error:e instanceof Error?e.message:"Unknown error"}}}}function Ul(){try{let n=null;if(typeof performance<"u"&&"memory"in performance&&(n=performance.memory),n){const e=n.usedJSHeapSize/1024/1024,l=n.totalJSHeapSize/1024/1024,s=e/l*100;return s>90?{status:"fail",message:"Memory usage critical",details:{usagePercentage:s,usedMB:e,totalMB:l}}:s>75?{status:"warn",message:"Memory usage high",details:{usagePercentage:s,usedMB:e,totalMB:l}}:{status:"pass",message:"Memory usage normal",details:{usagePercentage:s,usedMB:e,totalMB:l}}}return{status:"pass",message:"Memory monitoring not available"}}catch(n){return{status:"fail",message:"Memory check failed",details:{error:n instanceof Error?n.message:"Unknown error"}}}}function jl(n){try{const e={provider:"cloudflare-pages",region:"unknown"};return n!=null&&n.env&&(e.provider=n.env.DEPLOY_TARGET||"cloudflare-pages",e.region=n.env.CF_REGION||"unknown",e.hasKV=!!n.env.KV,e.hasR2=!!n.env.R2,e.hasD1=!!n.env.DB),{status:"pass",message:"Platform operational",details:e}}catch(e){return{status:"fail",message:"Platform check failed",details:{error:e instanceof Error?e.message:"Unknown error"}}}}function Bl(n,e){var o;const l=Object.values(n),s=l.filter(i=>i.status==="fail").length,a=l.filter(i=>i.status==="warn").length,r=((o=e==null?void 0:e.env)==null?void 0:o.NODE_ENV)==="development"||process.env.NODE_ENV==="development";return s>0?"unhealthy":a>0&&!r?"degraded":"healthy"}const ql=async({json:n,platform:e})=>{var s,a,r;const l=Date.now();Dl();try{const o=((s=e==null?void 0:e.env)==null?void 0:s.DEPLOY_TARGET)==="cloudflare",i=[Ll(e),Fl(e),Il(e),Promise.resolve(Ul()),Promise.resolve(jl(e))];o||i.push(zl());const u=await Promise.all(i),[c,m,d,h,v,T]=u,A={database:c,storage:m,cache:d,external:T||{status:"pass",message:"External services check skipped in production",responseTime:0},memory:h,platform:v},f=Bl(A,e),E=Date.now()-F.lastReset,D=F.requestCount>0?F.errorCount/F.requestCount*100:0,U=Date.now()-l;Ol(U);let G=null;typeof performance<"u"&&"memory"in performance&&(G=performance.memory);const V={status:f,timestamp:new Date().toISOString(),uptime:Math.floor(E/1e3),version:((a=e==null?void 0:e.env)==null?void 0:a.npm_package_version)||"1.0.0",environment:((r=e==null?void 0:e.env)==null?void 0:r.NODE_ENV)||"development",checks:A,metrics:{responseTime:U,errorRate:Math.round(D*100)/100,requestCount:F.requestCount,memoryUsage:G}};p.info("Health check completed",{status:f,responseTime:U,checks:Object.entries(A).map(([le,L])=>({name:le,status:L.status,responseTime:L.responseTime}))}),n(f==="healthy"||f==="degraded"?200:503,V)}catch(o){$l(),p.error("Health check failed",{responseTime:Date.now()-l},o),n(503,{error:"Health check failed",message:o instanceof Error?o.message:"Unknown error",details:{status:"unhealthy",timestamp:new Date().toISOString()}})}},Nl=Object.freeze(Object.defineProperty({__proto__:null,onGet:ql},Symbol.toStringTag,{value:"Module"})),Gl=_.object({timestamp:_.string(),level:_.enum(["debug","info","warn","error","critical"]),message:_.string(),context:_.record(_.any()).optional(),userId:_.string().optional(),sessionId:_.string().optional(),requestId:_.string().optional(),route:_.string().optional(),userAgent:_.string().optional(),ip:_.string().optional(),duration:_.number().optional(),stack:_.string().optional()}),Vl=_.object({logs:_.array(Gl)}),Hl=async({json:n,request:e,platform:l})=>{var s;try{const a=await e.json(),{logs:r}=Vl.parse(a),o=r.map(i=>({...i,ip:e.headers.get("cf-connecting-ip")||e.headers.get("x-forwarded-for")||"unknown",serverTimestamp:new Date().toISOString(),userAgent:e.headers.get("user-agent")||i.userAgent}));for(const i of o){const u={"@timestamp":i.serverTimestamp,level:i.level,message:i.message,service:"qwik-lit-builder-client",environment:process.env.NODE_ENV||"development",...i.context,client:{timestamp:i.timestamp,route:i.route,userAgent:i.userAgent,ip:i.ip},user:{userId:i.userId,sessionId:i.sessionId},request:{requestId:i.requestId,duration:i.duration},error:i.stack?{stack:i.stack}:void 0},c=i.level==="critical"||i.level==="error"?"error":i.level==="warn"?"warn":"log";if(console[c]("[CLIENT_LOG]",JSON.stringify(u)),i.level==="critical"&&((s=l==null?void 0:l.env)!=null&&s.ERROR_LOGS)){const m=`client_critical_${Date.now()}_${Math.random().toString(36).slice(2)}`;await l.env.ERROR_LOGS.put(m,JSON.stringify(u),{expirationTtl:604800})}}await Wl(o),n(200,{success:!0,data:{processed:r.length,timestamp:new Date().toISOString()}})}catch{n(500,{error:"Failed to process log batch"})}};async function Wl(n){try{const e=process.env.LOGGING_ENDPOINT,l=process.env.LOGGING_API_KEY;e&&l&&await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({logs:n})})}catch{}}const Kl=async({json:n})=>{n(200,{success:!0,data:{service:"log-collection",status:"healthy",timestamp:new Date().toISOString(),features:{clientLogs:!0,structuredOutput:!0,externalForwarding:!!process.env.LOGGING_ENDPOINT,kvStorage:!0}}})},Ql=Object.freeze(Object.defineProperty({__proto__:null,onGet:Kl,onPost:Hl},Symbol.toStringTag,{value:"Module"})),Jl=async({url:n,redirect:e})=>{const l=n.searchParams.get("code"),s=n.searchParams.get("access_token"),a=n.searchParams.get("next")||"/dashboard";throw l||s?e(302,`/auth/callback?token_present=true&next=${encodeURIComponent(a)}`):e(302,"/login?error=auth_failed")},Yl=()=>(Ee(C("s_ZkIemwK62xs")),t("div",null,{class:"min-h-screen flex items-center justify-center"},t("div",null,{class:"text-center"},[t("div",null,{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"},null,3,null),t("p",null,{class:"text-gray-600"},"Completing sign in...",3,null)],3,null),3,"76_0")),Zl=O(y(Yl,"s_Jj0XOz0agbs")),Xl=Object.freeze(Object.defineProperty({__proto__:null,default:Zl,onGet:Jl},Symbol.toStringTag,{value:"Module"})),es=async n=>{var i,u,c,m;const[e,l,s,a,r,o]=P();try{a.value=!0,s.value=null,p.info("Fetching real analytics data",{timeRange:n});const d=await fetch(`/api/analytics/dashboard?range=${n}`);if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const h=await d.json();e.value=h.analytics||{},o.value=h.performance||{},l.value=h.content||[],r.value=h.lastUpdated?new Date(h.lastUpdated).toLocaleString():"Unknown",p.info("Real analytics data loaded successfully",{pageViews:((u=(i=h.analytics)==null?void 0:i.pageViews)==null?void 0:u.value)||0,uniqueVisitors:((m=(c=h.analytics)==null?void 0:c.uniqueVisitors)==null?void 0:m.value)||0,contentItems:Array.isArray(h.content)?h.content.length:0})}catch(d){const h=`Failed to load analytics: ${d instanceof Error?d.message:String(d)}`;s.value=h,p.error("Analytics data fetch failed",{error:d instanceof Error?d.message:String(d),timeRange:n}),e.value={pageViews:{value:0,change:"Error"},uniqueVisitors:{value:0,change:"Error"},bounceRate:{value:"Error",change:"Error"},avgSessionTime:{value:"Error",change:"Error"}}}finally{a.value=!1}},ts=async({track:n})=>{const[e,l]=P();n(()=>l.value),await e(l.value)},ls=()=>{const n=w("7d"),e=w(!0),l=w(null),s=w(""),a=w({pageViews:{value:0,change:"0%"},uniqueVisitors:{value:0,change:"0%"},bounceRate:{value:"0%",change:"0%"},avgSessionTime:{value:"0m 0s",change:"0%"}}),r=w({builderContent:{loadTime:"0s",rating:"Measuring..."},mediaFiles:{loadTime:"0s",rating:"Measuring..."},cacheHitRate:{value:"0%",rating:"Measuring..."},apiResponseTime:{value:"0ms",rating:"Measuring..."}}),o=w([]),i=y(es,"s_YAwb1prRrtQ",[a,o,l,e,s,r]);return z(y(ts,"s_H1t3zAJGOHQ",[i,n])),t("div",null,null,[t("div",null,{class:"flex justify-between items-center mb-8"},[t("div",null,null,[t("h1",null,{class:"text-3xl font-bold text-gray-900"},"Analytics & Performance",3,null),t("p",null,{class:"text-gray-600 mt-2"},["Real-time monitoring of your content performance and system metrics",s.value&&t("span",null,{class:"ml-2 text-sm text-gray-500"},["• Last updated: ",g(u=>u.value,[s],"p0.value")],3,"M2_0")],1,null)],1,null),t("div",null,{class:"flex items-center gap-4"},[e.value&&t("div",null,{class:"flex items-center text-blue-600"},[t("div",null,{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"},null,3,null),"Loading..."],3,"M2_1"),t("select",null,{class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:g(u=>u.value,[n],"p0.value"),disabled:g(u=>u.value,[e],"p0.value"),onChange$:C("s_YCN88HLlJwA",[n])},[t("option",null,{value:"24h"},"Last 24 hours",3,null),t("option",null,{value:"7d"},"Last 7 days",3,null),t("option",null,{value:"30d"},"Last 30 days",3,null),t("option",null,{value:"90d"},"Last 90 days",3,null)],3,null)],1,null)],1,null),l.value&&t("div",null,{class:"bg-red-50 border border-red-200 rounded-md p-4 mb-8"},t("div",null,{class:"flex"},[t("div",null,{class:"flex-shrink-0"},t("span",null,{class:"text-red-400"},"⚠️",3,null),3,null),t("div",null,{class:"ml-3"},[t("h3",null,{class:"text-sm font-medium text-red-800"},"Analytics Data Error",3,null),t("div",null,{class:"mt-2 text-sm text-red-700"},[t("p",null,null,g(u=>u.value,[l],"p0.value"),3,null),t("button",null,{class:"mt-2 text-red-800 hover:text-red-600 underline",onClick$:C("s_08kI8AH8QFg",[i,n])},"Try again",3,null)],3,null)],3,null)],3,null),3,"M2_2"),t("div",null,{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},[t("div",null,{class:"bg-white rounded-lg shadow-sm border p-6"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,null,[t("p",null,{class:"text-sm font-medium text-gray-600"},"Page Views",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},a.value.pageViews.value.toLocaleString(),1,null)],1,null),t("div",null,{class:"text-green-600 text-sm font-medium"},g(u=>u.value.pageViews.change,[a],"p0.value.pageViews.change"),3,null)],1,null),1,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border p-6"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,null,[t("p",null,{class:"text-sm font-medium text-gray-600"},"Unique Visitors",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},a.value.uniqueVisitors.value.toLocaleString(),1,null)],1,null),t("div",null,{class:"text-green-600 text-sm font-medium"},g(u=>u.value.uniqueVisitors.change,[a],"p0.value.uniqueVisitors.change"),3,null)],1,null),1,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border p-6"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,null,[t("p",null,{class:"text-sm font-medium text-gray-600"},"Bounce Rate",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},g(u=>u.value.bounceRate.value,[a],"p0.value.bounceRate.value"),3,null)],3,null),t("div",null,{class:"text-green-600 text-sm font-medium"},g(u=>u.value.bounceRate.change,[a],"p0.value.bounceRate.change"),3,null)],3,null),3,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border p-6"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,null,[t("p",null,{class:"text-sm font-medium text-gray-600"},"Avg. Session Time",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},g(u=>u.value.avgSessionTime.value,[a],"p0.value.avgSessionTime.value"),3,null)],3,null),t("div",null,{class:"text-green-600 text-sm font-medium"},g(u=>u.value.avgSessionTime.change,[a],"p0.value.avgSessionTime.change"),3,null)],3,null),3,null)],1,null),t("div",null,{class:"grid lg:grid-cols-2 gap-8 mb-8"},[t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"System Performance",3,null),3,null),t("div",null,{class:"p-6 space-y-4"},[t("div",null,{class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"Builder.io Content",3,null),t("p",null,{class:"text-sm text-gray-500"},"Average load time",3,null)],3,null),t("div",null,{class:"text-right"},[t("p",null,{class:"text-xl font-bold text-gray-900"},g(u=>u.value.builderContent.loadTime,[r],"p0.value.builderContent.loadTime"),3,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},g(u=>u.value.builderContent.rating,[r],"p0.value.builderContent.rating"),3,null)],3,null)],3,null),t("div",null,{class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"Media Files",3,null),t("p",null,{class:"text-sm text-gray-500"},"Average load time",3,null)],3,null),t("div",null,{class:"text-right"},[t("p",null,{class:"text-xl font-bold text-gray-900"},g(u=>u.value.mediaFiles.loadTime,[r],"p0.value.mediaFiles.loadTime"),3,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},g(u=>u.value.mediaFiles.rating,[r],"p0.value.mediaFiles.rating"),3,null)],3,null)],3,null),t("div",null,{class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"Cache Hit Rate",3,null),t("p",null,{class:"text-sm text-gray-500"},"Caching efficiency",3,null)],3,null),t("div",null,{class:"text-right"},[t("p",null,{class:"text-xl font-bold text-gray-900"},g(u=>u.value.cacheHitRate.value,[r],"p0.value.cacheHitRate.value"),3,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},g(u=>u.value.cacheHitRate.rating,[r],"p0.value.cacheHitRate.rating"),3,null)],3,null)],3,null),t("div",null,{class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"API Response Time",3,null),t("p",null,{class:"text-sm text-gray-500"},"Average response time",3,null)],3,null),t("div",null,{class:"text-right"},[t("p",null,{class:"text-xl font-bold text-gray-900"},g(u=>u.value.apiResponseTime.value,[r],"p0.value.apiResponseTime.value"),3,null),t("span",null,{class:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full"},g(u=>u.value.apiResponseTime.rating,[r],"p0.value.apiResponseTime.rating"),3,null)],3,null)],3,null)],3,null)],3,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Content Analytics",3,null),3,null),t("div",null,{class:"p-6"},t("div",null,{class:"space-y-4"},o.value.length===0&&!e.value?t("div",null,{class:"text-center py-8 text-gray-500"},[t("div",null,{class:"text-4xl mb-2"},"📊",3,null),t("p",null,null,"No content metrics available",3,null),t("p",null,{class:"text-sm"},"Create some content to see analytics",3,null)],3,"M2_3"):o.value.map((u,c)=>{var m;return t("div",null,{class:"flex items-center justify-between p-4 border rounded-lg"},[t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},S(u,"type"),1,null),t("p",null,{class:"text-sm text-gray-500"},[S(u,"count")," items"],1,null)],1,null),t("div",null,{class:"text-right"},[t("p",null,{class:"text-lg font-semibold text-gray-900"},u.views!==void 0?u.views.toLocaleString():((m=u.usage)==null?void 0:m.toLocaleString())||"0",1,null),t("p",null,{class:"text-xs text-gray-500"},[u.views!==void 0?"views":"usage"," •",u.engagement!==void 0?` ${(u.engagement/1e3).toFixed(1)}k engagement`:u.performance||"No data"],1,null)],1,null)],1,c)}),1,null),1,null)],1,null)],1,null),t("div",null,{class:"grid lg:grid-cols-2 gap-8"},[t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Traffic Trends",3,null),3,null),t("div",null,{class:"p-6"},t("div",null,{class:"h-64 bg-gray-100 rounded-lg flex items-center justify-center"},t("div",null,{class:"text-center"},[t("div",null,{class:"text-4xl mb-2"},"📈",3,null),t("p",null,{class:"text-gray-600"},"Traffic Chart",3,null),t("p",null,{class:"text-sm text-gray-500"},"Integration with Google Analytics",3,null)],3,null),3,null),3,null)],3,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Component Usage",3,null),3,null),t("div",null,{class:"p-6"},t("div",null,{class:"h-64 bg-gray-100 rounded-lg flex items-center justify-center"},t("div",null,{class:"text-center"},[t("div",null,{class:"text-4xl mb-2"},"🧩",3,null),t("p",null,{class:"text-gray-600"},"Component Usage Chart",3,null),t("p",null,{class:"text-sm text-gray-500"},"Most used design system components",3,null)],3,null),3,null),3,null)],3,null)],3,null),t("div",null,{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6"},[t("h3",null,{class:"font-medium text-blue-900 mb-4"},"📊 AI-Powered Insights",3,null),t("div",null,{class:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},[t("div",null,{class:"bg-white rounded-lg p-4"},t("p",null,{class:"text-sm text-blue-800"},[t("strong",null,null,"Performance Tip:",3,null)," Your Builder.io pages load 23% faster than average. Consider using this architecture for more content."],3,null),3,null),t("div",null,{class:"bg-white rounded-lg p-4"},t("p",null,{class:"text-sm text-blue-800"},[t("strong",null,null,"Content Insight:",3,null)," Posts with DS Card components have 31% higher engagement rates."],3,null),3,null),t("div",null,{class:"bg-white rounded-lg p-4"},t("p",null,{class:"text-sm text-blue-800"},[t("strong",null,null,"Optimization:",3,null)," Enable image compression to reduce media load times by ~40%."],3,null),3,null)],3,null)],3,null)],1,"M2_4")},ss=O(y(ls,"s_c7k0xbY1wX8")),ns={title:"Analytics - Performance Metrics",meta:[{name:"description",content:"Monitor your content performance and system metrics"}]},as=Object.freeze(Object.defineProperty({__proto__:null,default:ss,head:ns},Symbol.toStringTag,{value:"Module"})),rs=(n,e)=>{const[l,s]=P();l.value={...l.value,[s.value]:{...l.value[s.value],[n]:e}}},os=()=>{const n=w("ds-button"),e=w({"ds-button":{variant:"primary",size:"medium",text:"Sample Button"},"ds-card":{variant:"default",content:"<p>Sample card content</p>"},"ds-input":{type:"text",placeholder:"Enter text...",label:"Sample Input"},"ds-file-upload":{accept:"image/*",multiple:!1}}),l=[{name:"ds-button",title:"DS Button",description:"Interactive button with variants and sizes",props:[{name:"variant",type:"select",options:["primary","secondary"],default:"primary"},{name:"size",type:"select",options:["medium","large"],default:"medium"},{name:"disabled",type:"boolean",default:!1},{name:"text",type:"string",default:"Button Text"}]},{name:"ds-card",title:"DS Card",description:"Container component with variants",props:[{name:"variant",type:"select",options:["default","elevated"],default:"default"},{name:"content",type:"richtext",default:"<p>Card content</p>"}]},{name:"ds-input",title:"DS Input",description:"Form input with validation",props:[{name:"type",type:"select",options:["text","email","password"],default:"text"},{name:"placeholder",type:"string",default:"Enter text..."},{name:"label",type:"string",default:"Input Label"},{name:"required",type:"boolean",default:!1}]},{name:"ds-file-upload",title:"DS File Upload",description:"File upload with drag & drop",props:[{name:"accept",type:"string",default:"image/*"},{name:"multiple",type:"boolean",default:!1},{name:"maxSize",type:"number",default:10485760}]}],s=y(rs,"s_AAO897lgALA",[e,n]),a=l.find(o=>o.name===n.value),r=e.value[n.value];return t("div",null,null,[t("div",null,{class:"mb-8"},[t("h1",null,{class:"text-3xl font-bold text-gray-900"},"Design System Components",3,null),t("p",null,{class:"text-gray-600 mt-2"},"Manage and preview your LIT web components",3,null)],3,null),t("div",null,{class:"grid lg:grid-cols-3 gap-8"},[t("div",null,{class:"lg:col-span-1"},[t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Available Components",3,null),3,null),t("div",null,{class:"divide-y"},l.map(o=>t("button",{class:`w-full px-6 py-4 text-left hover:bg-gray-50 ${n.value===o.name?"bg-blue-50 border-r-2 border-blue-500":""}`,onClick$:C("s_4kuUfUZleco",[o,n])},null,[t("h3",null,{class:"font-medium text-gray-900"},S(o,"title"),1,null),t("p",null,{class:"text-sm text-gray-500 mt-1"},S(o,"description"),1,null)],0,o.name)),1,null)],1,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border mt-6"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Builder.io Registration",3,null),3,null),t("div",null,{class:"p-6"},[t("div",null,{class:"space-y-3"},l.map(o=>t("div",null,{class:"flex items-center justify-between"},[t("span",null,{class:"text-sm font-medium"},S(o,"title"),1,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},"✅ Registered",3,null)],1,o.name)),1,null),t("button",null,{class:"w-full mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm"},"Re-register Components",3,null)],1,null)],1,null)],1,null),t("div",null,{class:"lg:col-span-2 space-y-6"},[t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},["Live Preview - ",a==null?void 0:a.title],1,null),1,null),t("div",null,{class:"p-8 bg-gray-50 min-h-32 flex items-center justify-center"},[n.value==="ds-button"&&t("ds-button",{variant:S(r,"variant"),size:S(r,"size"),disabled:S(r,"disabled")},null,S(r,"text"),1,"IM_0"),n.value==="ds-card"&&t("ds-card",{variant:S(r,"variant")},null,t("div",{dangerouslySetInnerHTML:S(r,"content")},null,null,3,null),1,"IM_1"),n.value==="ds-input"&&t("ds-input",{type:S(r,"type"),placeholder:S(r,"placeholder"),label:S(r,"label"),required:S(r,"required")},null,null,3,"IM_2"),n.value==="ds-file-upload"&&t("ds-file-upload",{accept:S(r,"accept"),multiple:S(r,"multiple"),maxSize:S(r,"maxSize")},null,null,3,"IM_3")],1,null)],1,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Properties",3,null),3,null),t("div",null,{class:"p-6 space-y-4"},a==null?void 0:a.props.map(o=>t("div",null,null,[t("label",null,{class:"block text-sm font-medium text-gray-700 mb-2"},S(o,"name"),1,null),o.type==="select"?t("select",{value:r[o.name],onChange$:C("s_L54Edk66cBw",[o,s])},{class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},"options"in o&&o.options?o.options.map(i=>t("option",{value:i},null,i,1,i)):null,0,"IM_4"):o.type==="boolean"?t("input",{checked:r[o.name],onChange$:C("s_K8Yq6FHadsE",[o,s])},{type:"checkbox",class:"mr-2"},null,2,"IM_5"):o.type==="number"?t("input",{value:r[o.name],onInput$:C("s_PDNmgpeUMH0",[o,s])},{type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,2,"IM_6"):t("input",{value:r[o.name],onInput$:C("s_sqkaqSKZThg",[o,s])},{type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,2,null)],1,o.name)),1,null)],1,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Generated Code",3,null),3,null),t("div",null,{class:"p-6"},t("pre",null,{class:"bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto"},t("code",null,null,[`<${n.value}${Object.entries(r).map(([o,i])=>typeof i=="boolean"&&i?` ${o}`:typeof i=="boolean"&&!i?"":` ${o}="${i}"`).join("")}>`,n.value==="ds-button"?r.text:"",n.value==="ds-card"?`
  `+r.content+`
`:"",g(o=>`</${o.value}>`,[n],"`</${p0.value}>`")],1,null),1,null),1,null)],1,null)],1,null)],1,null)],1,"IM_7")},is=O(y(os,"s_r0j4X6otVtI")),us={title:"Components - Design System",meta:[{name:"description",content:"Manage and preview your design system components"}]},cs=Object.freeze(Object.defineProperty({__proto__:null,default:is,head:us},Symbol.toStringTag,{value:"Module"})),ds=n=>t("ds-file-upload",{onDsUploadSuccess$:n.onUploadSuccess$,onDsUploadError$:n.onUploadError$,onDsUploadComplete$:n.onUploadComplete$},{endpoint:g(e=>e.endpoint||"/api/upload",[n],'p0.endpoint||"/api/upload"'),accept:g(e=>e.accept||"image/*,application/pdf,text/*",[n],'p0.accept||"image/*,application/pdf,text/*"'),maxSize:g(e=>e.maxSize||10485760,[n],"p0.maxSize||10*1024*1024"),multiple:g(e=>e.multiple||!1,[n],"p0.multiple||false"),bucket:g(e=>e.bucket||"uploads",[n],'p0.bucket||"uploads"'),class:g(e=>e.class,[n],"p0.class")},null,2,"iB_2"),gs=O(y(ds,"s_C03Fqoboh3U")),ps=async({cookie:n})=>{const e=await X(n);if(!e)return null;const l=M(),{data:s}=await l.from("profiles").select("*").eq("id",e.id).single(),{data:a,error:r}=await l.from("file_metadata").select("*").eq("user_id",e.id).eq("upload_status","completed").order("created_at",{ascending:!1}).limit(50),{data:o}=await l.from("user_file_stats").select("*").eq("user_id",e.id).single(),i=c=>{const m=["B","KB","MB","GB","TB"];if(c===0)return"0 B";const d=Math.floor(Math.log(c)/Math.log(1024));return`${(c/Math.pow(1024,d)).toFixed(1)} ${m[d]}`},u=(a||[]).map(c=>({id:c.id,name:c.file_name,size:c.file_size,type:c.mime_type||"application/octet-stream",url:`https://qwik-production-files.e1a6f9414e9b47f056d1731ab791f4db.r2.cloudflarestorage.com/${c.storage_path}`,uploadedAt:c.created_at,thumbnailUrl:c.thumbnail_path?`https://qwik-production-files.e1a6f9414e9b47f056d1731ab791f4db.r2.cloudflarestorage.com/${c.thumbnail_path}`:void 0,tags:c.tags||[]}));return{user:e,profile:s,files:u,stats:{totalFiles:(o==null?void 0:o.total_files)||0,totalSize:(o==null?void 0:o.total_size)||0,storageUsed:i((o==null?void 0:o.total_size)||0)},hasError:!!r}},Ae=ue(y(ps,"s_00pXWz0FAag")),ms=async()=>{var a,r;const[n,e,l,s]=P();if((a=e.value)!=null&&a.user){n.value=!0;try{const o=await fetch("/api/files/list?limit=50",{headers:{Cookie:document.cookie}});if(o.ok){const i=await o.json();l.value=i.files}}catch(o){const i=o instanceof Error?o.message:"Unknown error";p.error("Failed to refresh file list",{error:i,endpoint:"/api/files/list",userId:(r=e.value.user)==null?void 0:r.id}),s.value=`❌ Failed to refresh file list: ${i}`,l.value=[]}finally{n.value=!1}}},hs=n=>{const[e,l,s]=P(),{file:a}=n.detail;s.value=`✅ Uploaded: ${a.name}`,e(),l.value+=1},fs=n=>{const[e]=P(),{file:l,error:s}=n.detail;e.value=`❌ Failed: ${l.name} - ${s}`},bs=n=>{const[e]=P(),{results:l}=n.detail,s=l.filter(r=>r.status==="success").length,a=l.filter(r=>r.status==="error").length;e.value=`📊 Complete: ${s} uploaded, ${a} failed`,setTimeout(()=>{e.value=""},5e3)},ys=()=>{ie();const n=Ae(),e=w(""),l=w(0),s=w([]),a=w(!1);if(!n.value)return t("div",null,{class:"flex items-center justify-center h-64"},t("div",null,{class:"text-gray-500"},"Loading...",3,null),3,"Wk_0");const o=y(hs,"s_cdAui9V38SU",[y(ms,"s_BCO4F9EvjfI",[a,n,s,e]),l,e]),i=y(fs,"s_2VhBVnlzOS4",[e]),u=y(bs,"s_tUSlurN8mDc",[e]);return t("div",null,{class:"space-y-8"},[t("div",null,{class:"border-b border-gray-200 pb-4"},[t("h1",null,{class:"text-3xl font-bold text-gray-900"},"Media Library",3,null),t("p",null,{class:"text-gray-600 mt-2"},"Upload and manage your files with intelligent storage routing",3,null)],3,null),t("div",null,{class:"grid grid-cols-1 md:grid-cols-3 gap-6"},[t("div",null,{class:"bg-white p-6 rounded-lg shadow"},[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Total Files",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900 mt-2"},g(c=>c.value.stats.totalFiles,[n],"p0.value.stats.totalFiles"),3,null)],3,null),t("div",null,{class:"bg-white p-6 rounded-lg shadow"},[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Storage Used",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900 mt-2"},g(c=>c.value.stats.storageUsed,[n],"p0.value.stats.storageUsed"),3,null)],3,null),t("div",null,{class:"bg-white p-6 rounded-lg shadow"},[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Storage Type",3,null),t("p",null,{class:"text-sm text-gray-600 mt-2"},[t("span",null,{class:"block"},"✅ R2: All files (simplified architecture)",3,null),t("span",null,{class:"block text-gray-400"},"Up to 5GB per file",3,null)],3,null)],3,null)],3,null),t("div",null,{class:"bg-white rounded-lg shadow p-6"},[t("h2",null,{class:"text-xl font-semibold text-gray-900 mb-4"},"Upload Files",3,null),$(gs,{endpoint:"/api/upload",accept:"image/*,application/pdf,text/*,video/*",maxSize:52428800,multiple:!0,bucket:"uploads",class:"w-full",onUploadSuccess$:o,onUploadError$:i,onUploadComplete$:u,[R]:{endpoint:R,accept:R,maxSize:R,multiple:R,bucket:R,class:R,onUploadSuccess$:R,onUploadError$:R,onUploadComplete$:R}},3,"Wk_1"),e.value&&t("div",null,{class:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md"},t("p",null,{class:"text-blue-800 text-sm"},g(c=>c.value,[e],"p0.value"),3,null),3,"Wk_2"),t("div",null,{class:"mt-4 text-sm text-gray-600"},[t("p",null,{class:"mb-2"},[t("strong",null,null,"Simplified Storage:",3,null)," All files go to Cloudflare R2 for consistent performance and global CDN delivery."],3,null),t("p",null,null,[t("strong",null,null,"Supported formats:",3,null)," Images, PDFs, text files, videos up to 50MB"],3,null)],3,null)],1,null),t("div",null,{class:"bg-white rounded-lg shadow"},[t("div",null,{class:"px-6 py-4 border-b border-gray-200"},t("h2",null,{class:"text-xl font-semibold text-gray-900"},"Your Files",3,null),3,null),t("div",null,{class:"p-6"},a.value?t("div",null,{class:"text-center py-12"},[t("div",null,{class:"text-gray-400 text-6xl mb-4"},"🔄",3,null),t("h3",null,{class:"text-lg font-medium text-gray-900 mb-2"},"Loading files...",3,null)],3,"Wk_3"):(s.value.length>0?s.value:n.value.files).length===0?t("div",null,{class:"text-center py-12"},[t("div",null,{class:"text-gray-400 text-6xl mb-4"},"📁",3,null),t("h3",null,{class:"text-lg font-medium text-gray-900 mb-2"},"No files yet",3,null),t("p",null,{class:"text-gray-600 mb-4"},"Upload your first file using the upload area above",3,null),t("p",null,{class:"text-sm text-gray-500"},"Files will be stored securely and optimized for global delivery",3,null)],3,"Wk_4"):t("div",null,{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},(s.value.length>0?s.value:n.value.files).map(c=>t("div",null,{class:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"},[t("div",null,{class:"flex items-center justify-between mb-3"},[t("div",null,{class:"text-sm font-medium text-gray-900 truncate"},S(c,"name"),1,null),t("span",null,{class:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800"},"R2",3,null)],1,null),t("div",null,{class:"text-sm text-gray-600 space-y-1"},[t("div",null,null,["Size: ",(c.size/1024/1024).toFixed(2)," MB"],1,null),t("div",null,null,["Type: ",S(c,"type")],1,null),t("div",null,null,["Uploaded: ",new Date(c.uploadedAt).toLocaleDateString()],1,null)],1,null),t("div",null,{class:"mt-4 flex space-x-2"},[t("button",null,{class:"text-blue-600 hover:text-blue-800 text-sm font-medium"},"Download",3,null),t("button",null,{class:"text-red-600 hover:text-red-800 text-sm font-medium"},"Delete",3,null)],3,null)],1,c.id)),1,null),1,null)],1,null)],1,"Wk_5")},xs=O(y(ys,"s_BDZLd0X4JxU")),vs={title:"Media Library - Dashboard",meta:[{name:"description",content:"Upload and manage your media files with intelligent storage routing"}]},ws=Object.freeze(Object.defineProperty({__proto__:null,default:xs,head:vs,useMediaData:Ae},Symbol.toStringTag,{value:"Module"})),_s=async()=>{const[n,e,l]=P();try{e.value=!0,n.value="";const s=await fetch("/api/content/pages");if(s.ok){const a=await s.json();l.value=a.pages||[]}else{const a=await s.json();n.value=a.error||"Failed to load pages"}}catch{n.value="Network error loading pages"}finally{e.value=!1}},Ss=async()=>{const[n,e,l,s,a,r,o]=P();if(!r.value.trim()){e.value="Page title is required";return}try{n.value=!0,e.value="";const i={title:r.value.trim(),slug:a.value.trim()||void 0,description:s.value.trim()||void 0,template:"default",published:!1},u=await fetch("/api/content/pages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(u.ok)await u.json(),r.value="",a.value="",s.value="",o.value=!1,await l();else{const c=await u.json();e.value=c.error||"Failed to create page"}}catch{e.value="Network error creating page"}finally{n.value=!1}},ks=()=>{const[n,e]=P();!n.value&&e.value&&(n.value=e.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""))},Es=async()=>{const[n]=P();await n()},Cs=()=>{const n=w([]),e=w(!0),l=w(!1),s=w(""),a=w(!1),r=w(""),o=w(""),i=w(""),u=y(_s,"s_RSy4z08mHuY",[s,e,n]),c=y(Ss,"s_U0vSjZxjf0g",[l,s,u,i,o,r,a]),m=y(ks,"s_OHe4b3BmXIA",[o,r]);return z(y(Es,"s_q3arvP17QJ0",[u])),t("div",null,null,[t("div",null,{class:"flex justify-between items-center mb-8"},[t("div",null,null,[t("h1",null,{class:"text-3xl font-bold text-gray-900"},"Pages",3,null),t("p",null,{class:"text-gray-600 mt-2"},"Manage your visual pages and landing pages",3,null)],3,null),t("button",null,{class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50",disabled:g(d=>d.value,[l],"p0.value"),onClick$:C("s_XklD0zp44XY",[s,a])},g(d=>d.value?"Cancel":"Create Page",[a],'p0.value?"Cancel":"Create Page"'),3,null)],3,null),s.value&&t("div",null,{class:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6"},t("div",null,{class:"flex"},[t("div",null,{class:"flex-shrink-0"},t("svg",null,{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},t("path",null,{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,3,null),3,null),3,null),t("div",null,{class:"ml-3"},t("p",null,{class:"text-sm text-red-800"},g(d=>d.value,[s],"p0.value"),3,null),3,null)],3,null),3,"h8_0"),a.value&&t("div",null,{class:"bg-white rounded-lg shadow-sm border p-6 mb-8"},[t("h2",null,{class:"text-xl font-semibold mb-4"},"Create New Page",3,null),t("div",null,{class:"space-y-4"},[t("div",null,null,[t("label",null,{class:"block text-sm font-medium text-gray-700 mb-2"},"Page Title *",3,null),t("input",null,{type:"text",class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter page title",value:g(d=>d.value,[r],"p0.value"),disabled:g(d=>d.value,[l],"p0.value"),onInput$:C("s_iUIdYKxt004",[r,m])},null,3,null)],3,null),t("div",null,null,[t("label",null,{class:"block text-sm font-medium text-gray-700 mb-2"},["Page URL Slug",t("span",null,{class:"text-gray-500 text-xs"},"(auto-generated from title)",3,null)],3,null),t("div",null,{class:"flex"},[t("span",null,{class:"inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm"},"/",3,null),t("input",null,{type:"text",class:"flex-1 border border-gray-300 rounded-r-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"your-page-url",value:g(d=>d.value,[o],"p0.value"),disabled:g(d=>d.value,[l],"p0.value"),onInput$:C("s_P0uR1QIAYP0",[o])},null,3,null)],3,null)],3,null),t("div",null,null,[t("label",null,{class:"block text-sm font-medium text-gray-700 mb-2"},"Description (Optional)",3,null),t("textarea",null,{class:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of the page",rows:3,value:g(d=>d.value,[i],"p0.value"),disabled:g(d=>d.value,[l],"p0.value"),onInput$:C("s_0CoyY4fcrIQ",[i])},null,3,null)],3,null),t("div",null,{class:"flex gap-2"},[t("button",null,{class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",disabled:g((d,h)=>d.value||!h.value.trim(),[l,r],"p0.value||!p1.value.trim()"),onClick$:c},[l.value&&t("svg",null,{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",null,{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,3,null),t("path",null,{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,3,null)],3,"h8_1"),g(d=>d.value?"Creating...":"Create Page",[l],'p0.value?"Creating...":"Create Page"')],1,null),t("button",null,{class:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 disabled:opacity-50",disabled:g(d=>d.value,[l],"p0.value"),onClick$:C("s_NId9t3ngBME",[s,i,o,r,a])},"Cancel",3,null)],1,null)],1,null)],1,"h8_2"),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b flex items-center justify-between"},[t("h2",null,{class:"text-lg font-semibold"},"Your Pages",3,null),!e.value&&n.value.length>0&&t("span",null,{class:"text-sm text-gray-500"},[g(d=>d.value.length,[n],"p0.value.length")," page",g(d=>d.value.length===1?"":"s",[n],'p0.value.length===1?"":"s"')],3,"h8_3")],1,null),t("div",null,{class:"divide-y"},e.value?t("div",null,{class:"px-6 py-8 text-center text-gray-500"},t("div",null,{class:"flex items-center justify-center"},[t("svg",null,{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24"},[t("circle",null,{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,3,null),t("path",null,{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,3,null)],3,null),"Loading pages..."],3,null),3,"h8_4"):n.value.length===0?t("div",null,{class:"px-6 py-12 text-center text-gray-500"},[t("svg",null,{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",null,{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"},null,3,null),3,null),t("h3",null,{class:"mt-2 text-sm font-medium text-gray-900"},"No pages",3,null),t("p",null,{class:"mt-1 text-sm text-gray-500"},"Get started by creating your first page.",3,null),t("div",null,{class:"mt-6"},t("button",null,{class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",onClick$:C("s_7wN6ZaymF0U",[s,a])},[t("svg",null,{class:"-ml-1 mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",null,{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"},null,3,null),3,null),"Create Page"],3,null),3,null)],3,"h8_5"):n.value.map(d=>t("div",null,{class:"px-6 py-4 hover:bg-gray-50 transition-colors"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,{class:"min-w-0 flex-1"},[t("div",null,{class:"flex items-center"},[t("h3",null,{class:"font-medium text-gray-900 truncate"},S(d,"title"),1,null),t("span",{class:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${d.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},null,d.published?"Published":"Draft",1,null)],1,null),t("div",null,{class:"mt-1 flex items-center text-sm text-gray-500"},[t("span",null,null,["/",S(d,"slug")],1,null),d.description&&$(Fe,{children:[t("span",null,{class:"mx-2"},"•",3,null),t("span",null,{class:"truncate"},S(d,"description"),1,null)]},1,"h8_6")],1,null),t("div",null,{class:"mt-2 flex items-center text-xs text-gray-400"},[t("span",null,null,["Created ",new Date(d.created_at).toLocaleDateString()],1,null),t("span",null,{class:"mx-2"},"•",3,null),t("span",null,null,[S(d,"view_count")," view",d.view_count===1?"":"s"],1,null),t("span",null,{class:"mx-2"},"•",3,null),t("span",null,{class:"capitalize"},[S(d,"template")," template"],1,null)],1,null)],1,null),t("div",null,{class:"ml-4 flex items-center space-x-2"},[t("a",{href:`/${d.slug}`},{class:"text-blue-600 hover:text-blue-800 text-sm font-medium",target:"_blank",rel:"noopener noreferrer"},"View →",3,null),t("button",null,{class:"text-gray-400 hover:text-gray-600"},t("svg",null,{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",null,{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"},null,3,null),3,null),3,null)],1,null)],1,null),1,d.id)),1,null)],1,null)],1,"h8_7")},Ts=O(y(Cs,"s_Z1neaZRFYyU")),Ps={title:"Pages - Content Management",meta:[{name:"description",content:"Manage your visual pages and landing pages"}]},Rs=Object.freeze(Object.defineProperty({__proto__:null,default:Ts,head:Ps},Symbol.toStringTag,{value:"Module"})),Ms=async()=>{const[n,e]=P();try{const l=await fetch("/api/content/posts");if(l.ok){const s=await l.json();e.value=s.posts||[]}}catch{}finally{n.value=!1}},As=()=>{const[n]=P();n()},Ds=async()=>{const[n,e,l]=P();try{(await fetch("/api/content/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)})).ok&&(e.value={title:"",content:"",published:!1},l.value=!1,await n())}catch{}},$s=()=>{const n=w([]),e=w(!0),l=w(!1),s=w({title:"",content:"",published:!1}),a=y(Ms,"s_1WTH03jRCsU",[e,n]);z(y(As,"s_540yPc3E2RA",[a]));const r=y(Ds,"s_V24BuGzIqHI",[a,s,l]);return t("div",null,null,[t("div",null,{class:"flex justify-between items-center mb-8"},[t("div",null,null,[t("h1",null,{class:"text-3xl font-bold text-gray-900"},"Posts",3,null),t("p",null,{class:"text-gray-600 mt-2"},"Manage your blog posts and articles",3,null)],3,null),t("button",null,{class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",onClick$:C("s_Oc2O0zQdsgE",[l])},g(o=>o.value?"Cancel":"New Post",[l],'p0.value?"Cancel":"New Post"'),3,null)],3,null),l.value&&t("div",null,{class:"bg-white rounded-lg shadow-sm border p-6 mb-8"},[t("h2",null,{class:"text-xl font-semibold mb-4"},"Create New Post",3,null),t("div",null,{class:"space-y-4"},[t("div",null,null,[t("label",null,{class:"block text-sm font-medium text-gray-700 mb-2"},"Title",3,null),t("input",null,{type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:g(o=>o.value.title,[s],"p0.value.title"),onInput$:C("s_Et0psVOr3QA",[s])},null,3,null)],3,null),t("div",null,null,[t("label",null,{class:"block text-sm font-medium text-gray-700 mb-2"},"Content",3,null),t("textarea",null,{rows:6,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:g(o=>o.value.content,[s],"p0.value.content"),onInput$:C("s_RJ3Ap4n0gmY",[s])},null,3,null)],3,null),t("div",null,{class:"flex items-center"},[t("input",null,{type:"checkbox",id:"published",class:"mr-2",checked:g(o=>o.value.published,[s],"p0.value.published"),onChange$:C("s_q00lGzU6qCM",[s])},null,3,null),t("label",null,{for:"published",class:"text-sm font-medium text-gray-700"},"Publish immediately",3,null)],3,null),t("div",null,{class:"flex space-x-3"},[t("button",null,{class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",onClick$:r},"Create Post",3,null),t("button",null,{class:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",onClick$:C("s_bIZQZkM05f0",[l])},"Cancel",3,null)],3,null)],3,null)],3,"J4_0"),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Your Posts",3,null),3,null),t("div",null,{class:"divide-y"},e.value?t("div",null,{class:"px-6 py-8 text-center text-gray-500"},"Loading posts...",3,"J4_1"):n.value.length===0?t("div",null,{class:"px-6 py-8 text-center text-gray-500"},[t("p",null,null,"No posts found.",3,null),t("p",null,{class:"text-sm mt-2"},"Create your first blog post above.",3,null)],3,"J4_2"):n.value.map(o=>{var i;return t("div",null,{class:"px-6 py-4 hover:bg-gray-50"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},S(o,"title"),1,null),t("p",null,{class:"text-sm text-gray-500 mt-1"},[(i=o.content)==null?void 0:i.substring(0,100),"..."],1,null),t("p",null,{class:"text-xs text-gray-400 mt-1"},["Created: ",new Date(o.created_at).toLocaleDateString()],1,null)],1,null),t("div",null,{class:"flex items-center space-x-3"},[t("span",{class:`px-2 py-1 text-xs rounded-full ${o.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},null,o.published?"Published":"Draft",1,null),t("a",{href:`/posts/${o.slug}`},{class:"text-blue-600 hover:text-blue-800 text-sm"},"View →",3,null)],1,null)],1,null),1,o.id)}),1,null)],1,null)],1,"J4_3")},Os=O(y($s,"s_RWtIVOCEnf0")),Ls={title:"Posts - Content Management",meta:[{name:"description",content:"Manage your blog posts and articles"}]},Fs=Object.freeze(Object.defineProperty({__proto__:null,default:Os,head:Ls},Symbol.toStringTag,{value:"Module"})),Is=async({cookie:n})=>{const e=await X(n);if(!e)return null;const l=M(),{count:s}=await l.from("posts").select("*",{count:"exact",head:!0}).eq("author_id",e.id),{data:a}=await l.from("posts").select("id, title, published, created_at").eq("author_id",e.id).order("created_at",{ascending:!1}).limit(5),{data:r}=await l.from("user_file_stats").select("*").eq("user_id",e.id).single(),{count:o}=await l.from("builder_pages").select("*",{count:"exact",head:!0}).eq("user_id",e.id),{count:i}=await l.from("design_system_components").select("*",{count:"exact",head:!0}).eq("created_by",e.id),u=new Date(Date.now()-3e5).toISOString(),{count:c}=await l.from("user_sessions").select("*",{count:"exact",head:!0}).eq("user_id",e.id).gte("last_activity",u).eq("active",!0);return{user:e,stats:{postsCount:s||0,pagesCount:o||0,componentsCount:i||0,totalFiles:(r==null?void 0:r.total_files)||0,totalSize:(r==null?void 0:r.total_size)||0,storageUsed:$e((r==null?void 0:r.total_size)||0),activeSessions:c||0},recentPosts:a||[]}},De=ue(y(Is,"s_rzz0Rmkfnsc"));function $e(n){const e=["B","KB","MB","GB","TB"];if(n===0)return"0 B";const l=Math.floor(Math.log(n)/Math.log(1024));return`${(n/Math.pow(1024,l)).toFixed(1)} ${e[l]}`}const zs=async()=>{const[n]=P();try{const e=await fetch("/api/dashboard/stats",{headers:{Cookie:document.cookie}});if(e.ok){const l=await e.json();n.value=l}}catch(e){p.error("Failed to fetch realtime stats",{error:e instanceof Error?e.message:String(e)})}},Us=()=>{const n=De(),e=w(null);return z(y(zs,"s_FyInf7hQmPU",[e])),n.value?t("div",null,null,[t("h1",null,{class:"text-3xl font-bold text-gray-900 mb-8"},["Welcome back, ",g(l=>l.value.user.email,[n],"p0.value.user.email"),"!"],3,null),t("div",null,{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},[t("div",null,{class:"bg-white p-6 rounded-lg shadow"},t("div",null,{class:"flex items-center"},[t("div",null,{class:"text-2xl mr-3"},"📝",3,null),t("div",null,null,[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Posts",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},g(l=>l.value.stats.postsCount,[n],"p0.value.stats.postsCount"),3,null)],3,null)],3,null),3,null),t("div",null,{class:"bg-white p-6 rounded-lg shadow"},t("div",null,{class:"flex items-center"},[t("div",null,{class:"text-2xl mr-3"},"📄",3,null),t("div",null,null,[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Pages",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},g(l=>l.value.stats.pagesCount,[n],"p0.value.stats.pagesCount"),3,null)],3,null)],3,null),3,null),t("div",null,{class:"bg-white p-6 rounded-lg shadow"},t("div",null,{class:"flex items-center"},[t("div",null,{class:"text-2xl mr-3"},"🧩",3,null),t("div",null,null,[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Components",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},g(l=>l.value.stats.componentsCount,[n],"p0.value.stats.componentsCount"),3,null)],3,null)],3,null),3,null),t("div",null,{class:"bg-white p-6 rounded-lg shadow"},t("div",null,{class:"flex items-center"},[t("div",null,{class:"text-2xl mr-3"},"📁",3,null),t("div",null,null,[t("h3",null,{class:"text-sm font-medium text-gray-500"},"Media Files",3,null),t("p",null,{class:"text-3xl font-bold text-gray-900"},g((l,s)=>{var a;return((a=s.value)==null?void 0:a.totalFiles)||l.value.stats.totalFiles||0},[n,e],"p1.value?.totalFiles||p0.value.stats.totalFiles||0"),3,null)],3,null)],3,null),3,null)],3,null),t("div",null,{class:"grid lg:grid-cols-3 gap-8 mb-8"},[t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Quick Actions",3,null),3,null),t("div",null,{class:"p-6 space-y-3"},[t("a",null,{href:"/dashboard/pages",class:"block bg-blue-50 hover:bg-blue-100 p-4 rounded-lg transition-colors"},t("div",null,{class:"flex items-center"},[t("span",null,{class:"text-xl mr-3"},"📄",3,null),t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"Create Page",3,null),t("p",null,{class:"text-sm text-gray-600"},"Build with Builder.io",3,null)],3,null)],3,null),3,null),t("a",null,{href:"/dashboard/posts",class:"block bg-green-50 hover:bg-green-100 p-4 rounded-lg transition-colors"},t("div",null,{class:"flex items-center"},[t("span",null,{class:"text-xl mr-3"},"📝",3,null),t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"Write Post",3,null),t("p",null,{class:"text-sm text-gray-600"},"Create blog content",3,null)],3,null)],3,null),3,null),t("a",null,{href:"/dashboard/media",class:"block bg-purple-50 hover:bg-purple-100 p-4 rounded-lg transition-colors"},t("div",null,{class:"flex items-center"},[t("span",null,{class:"text-xl mr-3"},"📁",3,null),t("div",null,null,[t("h3",null,{class:"font-medium text-gray-900"},"Upload Media",3,null),t("p",null,{class:"text-sm text-gray-600"},"Add files and images",3,null)],3,null)],3,null),3,null)],3,null)],3,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"Design System Status",3,null),3,null),t("div",null,{class:"p-6 space-y-3"},[["DS Button","DS Card","DS Input","DS File Upload"].map(l=>t("div",null,{class:"flex items-center justify-between"},[t("span",null,{class:"text-sm font-medium"},l,1,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},"✅ Active",3,null)],1,l)),t("a",null,{href:"/dashboard/components",class:"block text-center bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors text-sm text-blue-600 font-medium"},"Manage Components →",3,null)],1,null)],1,null),t("div",null,{class:"bg-white rounded-lg shadow-sm border"},[t("div",null,{class:"px-6 py-4 border-b"},t("h2",null,{class:"text-lg font-semibold"},"System Health",3,null),3,null),t("div",null,{class:"p-6 space-y-3"},[t("div",null,{class:"flex items-center justify-between"},[t("span",null,{class:"text-sm font-medium"},"Builder.io",3,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},"✅ Connected",3,null)],3,null),t("div",null,{class:"flex items-center justify-between"},[t("span",null,{class:"text-sm font-medium"},"Supabase",3,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},"✅ Connected",3,null)],3,null),t("div",null,{class:"flex items-center justify-between"},[t("span",null,{class:"text-sm font-medium"},"R2 Storage",3,null),t("span",null,{class:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full"},"✅ Connected",3,null)],3,null),t("a",null,{href:"/dashboard/analytics",class:"block text-center bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors text-sm text-blue-600 font-medium"},"View Analytics →",3,null)],3,null)],3,null)],1,null),t("div",null,{class:"bg-white rounded-lg shadow"},[t("div",null,{class:"px-6 py-4 border-b border-gray-200"},t("h2",null,{class:"text-lg font-semibold text-gray-900"},"Recent Posts",3,null),3,null),t("div",null,{class:"divide-y divide-gray-200"},n.value.recentPosts.length===0?t("div",null,{class:"px-6 py-4 text-gray-500"},"No posts yet",3,"we_1"):n.value.recentPosts.map(l=>t("div",null,{class:"px-6 py-4 hover:bg-gray-50"},t("div",null,{class:"flex items-center justify-between"},[t("div",null,null,[t("h3",null,{class:"text-sm font-medium text-gray-900"},S(l,"title"),1,null),t("p",null,{class:"text-sm text-gray-500"},new Date(l.created_at).toLocaleDateString(),1,null)],1,null),t("span",{class:`px-2 py-1 text-xs rounded-full ${l.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`},null,l.published?"Published":"Draft",1,null)],1,null),1,l.id)),1,null)],1,null)],1,"we_2"):t("div",null,null,"Loading...",3,"we_0")},js=O(y(Us,"s_tKEjWeTgiGA")),Bs={title:"Dashboard - Qwik + LIT + Builder.io",meta:[{name:"description",content:"User dashboard"}]},qs=Object.freeze(Object.defineProperty({__proto__:null,_auto_formatFileSize:$e,default:js,head:Bs,useDashboardData:De},Symbol.toStringTag,{value:"Module"})),Ns=async()=>{const[n,e,l,s,a]=P();l.value=!0,e.value="";try{const{error:r}=await ce.signIn(n.value,a.value);if(r)throw r;await s("/dashboard")}catch(r){e.value=r instanceof Error?r.message:"Login failed"}finally{l.value=!1}},Gs=async n=>{const[e,l]=P();l.value=!0,e.value="";try{const{error:s}=await ce.signInWithOAuth(n);if(s)throw s}catch(s){e.value=s instanceof Error?s.message:"OAuth login failed",l.value=!1}},Vs=async()=>{const[n,e,l]=P();if(!n.value){e.value="Please enter your email";return}l.value=!0,e.value="";try{const{error:s}=await ce.signInWithMagicLink(n.value);if(s)throw s;e.value="Check your email for the login link!"}catch(s){e.value=s instanceof Error?s.message:"Failed to send magic link"}finally{l.value=!1}},Hs=()=>{const n=Ie(),e=w(""),l=w(""),s=w(!1),a=w(""),r=y(Ns,"s_M7uVWgz5fLo",[e,a,s,n,l]),o=y(Gs,"s_1Fz1nHxVqXo",[a,s]),i=y(Vs,"s_F9kiKsoYGLc",[e,a,s]);return t("div",null,{class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},t("div",null,{class:"max-w-md w-full space-y-8"},[t("div",null,null,t("h2",null,{class:"mt-6 text-center text-3xl font-extrabold text-gray-900"},"Sign in to your account",3,null),3,null),t("div",null,{class:"mt-8 space-y-6"},[a.value&&t("div",null,{class:"rounded-md bg-red-50 p-4"},t("p",null,{class:"text-sm text-red-800"},g(u=>u.value,[a],"p0.value"),3,null),3,"V7_0"),t("div",null,{class:"space-y-3"},[t("button",null,{disabled:g(u=>u.value,[s],"p0.value"),class:"w-full flex justify-center items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",onClick$:C("s_DIXakIIbtmc",[o])},[t("svg",null,{class:"w-5 h-5 mr-2",viewBox:"0 0 24 24"},[t("path",null,{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"},null,3,null),t("path",null,{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"},null,3,null),t("path",null,{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"},null,3,null),t("path",null,{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"},null,3,null)],3,null),"Continue with Google"],3,null),t("button",null,{disabled:g(u=>u.value,[s],"p0.value"),class:"w-full flex justify-center items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",onClick$:C("s_0Ck2IrGMcgM",[o])},[t("svg",null,{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},t("path",null,{"fill-rule":"evenodd",d:"M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z","clip-rule":"evenodd"},null,3,null),3,null),"Continue with GitHub"],3,null)],3,null),t("div",null,{class:"relative"},[t("div",null,{class:"absolute inset-0 flex items-center"},t("div",null,{class:"w-full border-t border-gray-300"},null,3,null),3,null),t("div",null,{class:"relative flex justify-center text-sm"},t("span",null,{class:"px-2 bg-gray-50 text-gray-500"},"Or continue with",3,null),3,null)],3,null),t("div",null,{class:"space-y-4"},[t("div",null,null,[t("label",null,{for:"email",class:"block text-sm font-medium text-gray-700"},"Email address",3,null),t("input",null,{id:"email",type:"email",autoComplete:"email",required:!0,value:g(u=>u.value,[e],"p0.value"),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",onInput$:C("s_DYgs0Z65Quc",[e])},null,3,null)],3,null),t("div",null,null,[t("label",null,{for:"password",class:"block text-sm font-medium text-gray-700"},"Password",3,null),t("input",null,{id:"password",type:"password",autoComplete:"current-password",required:!0,value:g(u=>u.value,[l],"p0.value"),class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",onInput$:C("s_oWetVDGIFg4",[l])},null,3,null)],3,null),t("div",null,{class:"flex items-center justify-between"},[t("button",null,{disabled:g(u=>u.value,[s],"p0.value"),class:"flex-1 mr-2 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",onClick$:r},g(u=>u.value?"Signing in...":"Sign in",[s],'p0.value?"Signing in...":"Sign in"'),3,null),t("button",null,{disabled:g(u=>u.value,[s],"p0.value"),class:"flex-1 ml-2 flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",onClick$:i},"Email magic link",3,null)],3,null)],3,null),t("div",null,{class:"text-center"},t("a",null,{href:"/signup",class:"text-sm text-blue-600 hover:text-blue-500"},"Don't have an account? Sign up",3,null),3,null)],1,null)],1,null),1,"V7_1")},Ws=O(y(Hs,"s_aJcwFH6Iesk")),Ks={title:"Login - Qwik + LIT + Builder.io",meta:[{name:"description",content:"Sign in to your account"}]},Qs=Object.freeze(Object.defineProperty({__proto__:null,default:Ws,head:Ks},Symbol.toStringTag,{value:"Module"})),K=async({json:n})=>{n(404,{error:{code:"NOT_FOUND",message:"API endpoint not found"}})},Js=K,Ys=K,Zs=K,Xs=K,en=Object.freeze(Object.defineProperty({__proto__:null,onDelete:Zs,onGet:K,onPatch:Xs,onPost:Js,onPut:Ys},Symbol.toStringTag,{value:"Module"})),tn=()=>t("div",null,{class:"min-h-[60vh] flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-50"},t("div",null,{class:"text-center max-w-md mx-auto p-8"},[t("div",null,{class:"text-8xl mb-6"},"🚀",3,null),t("h1",null,{class:"text-6xl font-bold text-gray-900 mb-4"},"404",3,null),t("p",null,{class:"text-xl text-gray-600 mb-8"},"This page doesn't exist in our production stack",3,null),t("div",null,{class:"space-y-4"},[t("a",null,{href:"/",class:"inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium transition-colors"},"🏠 Back to Home",3,null),t("div",null,{class:"text-sm text-gray-500"},"Or explore our live features:",3,null),t("div",null,{class:"flex justify-center space-x-4 text-sm"},[t("a",null,{href:"/dashboard",class:"text-blue-600 hover:text-blue-800"},"📊 Dashboard",3,null),t("a",null,{href:"/dashboard/analytics",class:"text-purple-600 hover:text-purple-800"},"📈 Analytics",3,null),t("a",null,{href:"/api/health",class:"text-green-600 hover:text-green-800"},"💚 Health Check",3,null)],3,null)],3,null)],3,null),3,"q5_0"),ln=O(y(tn,"s_dUKnuUOG7r8")),sn={title:"404 - Page Not Found",meta:[{name:"description",content:"The page you are looking for does not exist"}]},nn=Object.freeze(Object.defineProperty({__proto__:null,default:ln,head:sn},Symbol.toStringTag,{value:"Module"}));class an{constructor(){this.defaultConfig={ALLOWED_TAGS:["p","br","strong","em","u","b","i","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","code","pre","div","span"],ALLOWED_ATTR:["class","id","style"],ALLOW_DATA_ATTR:!1,SANITIZE_DOM:!0,KEEP_CONTENT:!0,USE_PROFILES:{html:!0}},this.imageConfig={...this.defaultConfig,ALLOWED_TAGS:[...this.defaultConfig.ALLOWED_TAGS||[],"img"],ALLOWED_ATTR:[...this.defaultConfig.ALLOWED_ATTR||[],"src","alt","width","height","loading"]},this.linkConfig={...this.defaultConfig,ALLOWED_TAGS:[...this.defaultConfig.ALLOWED_TAGS||[],"a"],ALLOWED_ATTR:[...this.defaultConfig.ALLOWED_ATTR||[],"href","target","rel"]},this.richConfig={...this.linkConfig,ALLOWED_TAGS:[...this.linkConfig.ALLOWED_TAGS||[],"img","table","thead","tbody","tr","td","th"],ALLOWED_ATTR:[...this.linkConfig.ALLOWED_ATTR||[],"src","alt","width","height","loading","colspan","rowspan"]}}sanitizeBasic(e){return!e||typeof e!="string"?"":j.sanitize(e,this.defaultConfig)}sanitizeWithImages(e){return!e||typeof e!="string"?"":j.sanitize(e,this.imageConfig)}sanitizeWithLinks(e){return!e||typeof e!="string"?"":j.sanitize(e,this.linkConfig).replace(/<a\s+href="https?:\/\/[^"]*"/gi,s=>`${s} target="_blank" rel="noopener noreferrer"`)}sanitizeRich(e){return!e||typeof e!="string"?"":j.sanitize(e,this.richConfig).replace(/<a\s+href="https?:\/\/[^"]*"/gi,s=>`${s} target="_blank" rel="noopener noreferrer"`)}sanitizeCustom(e,l){if(!e||typeof e!="string")return"";const s={ALLOWED_TAGS:l.allowedTags||this.defaultConfig.ALLOWED_TAGS,ALLOWED_ATTR:l.allowedAttributes||this.defaultConfig.ALLOWED_ATTR,SANITIZE_DOM:!0,KEEP_CONTENT:!0};return l.allowImages&&s.ALLOWED_TAGS&&(s.ALLOWED_TAGS.push("img"),s.ALLOWED_ATTR&&s.ALLOWED_ATTR.push("src","alt","width","height","loading")),l.allowLinks&&s.ALLOWED_TAGS&&(s.ALLOWED_TAGS.push("a"),s.ALLOWED_ATTR&&s.ALLOWED_ATTR.push("href","target","rel")),j.sanitize(e,s)}stripHTML(e){return!e||typeof e!="string"?"":j.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[],KEEP_CONTENT:!0})}isSafe(e){return!e||typeof e!="string"?!0:this.sanitizeBasic(e)===e}getSecurityWarnings(e){const l=[];if(!e||typeof e!="string")return l;const s=[{pattern:/<script/i,warning:"Contains script tags"},{pattern:/javascript:/i,warning:"Contains javascript: protocol"},{pattern:/on\w+\s*=/i,warning:"Contains event handlers"},{pattern:/<iframe/i,warning:"Contains iframe elements"},{pattern:/<object/i,warning:"Contains object elements"},{pattern:/<embed/i,warning:"Contains embed elements"},{pattern:/<form/i,warning:"Contains form elements"},{pattern:/data:/i,warning:"Contains data: protocol"}];for(const{pattern:a,warning:r}of s)a.test(e)&&l.push(r);return l}}const rn=new an,_e=n=>rn.sanitizeRich(n),on=async({params:n,status:e})=>{const l=n.slug;if(!l)return e(404),null;try{const s=await W.getPage(l,!0);return!s||!s.published?(e(404),null):(W.incrementViewCount(s.id).catch(()=>{}),s)}catch(s){return p.error("Error loading page",{slug:l},s),e(500),null}},ge=ue(y(on,"s_bgpN1vdANm8")),un=async()=>{try{return{params:(await W.getPublishedPages({limit:100})).data.map(e=>({slug:e.slug}))}}catch(n){return p.error("Error generating static pages",{},n),{params:[]}}},cn=n=>{const e=n.block.properties||{};switch(n.block.component_name||n.block.block_type){case"ds-button":return t("ds-button",{variant:e.variant||"primary",size:e.size||"md",disabled:e.disabled||!1},null,e.label||"Button",1,"FM_0");case"ds-card":return t("div",null,{class:"bg-white border border-gray-200 rounded-lg p-6 shadow-sm"},[e.title&&t("h3",null,{class:"text-lg font-semibold text-gray-900 mb-2"},S(e,"title"),1,"FM_1"),e.subtitle&&t("p",null,{class:"text-gray-600 mb-4"},S(e,"subtitle"),1,"FM_2"),e.content&&t("div",{dangerouslySetInnerHTML:_e(e.content)},null,null,3,"FM_3"),n.block.children&&n.block.children.length>0&&t("div",null,null,n.block.children.map((a,r)=>$(I,{block:a},3,`${n.block.id}-child-${r}`)),1,"FM_4")],1,null);case"ds-input":return t("ds-input",{type:e.type||"text",label:e.label||"Input",placeholder:e.placeholder||"",required:e.required||!1,disabled:e.disabled||!1},null,null,3,null);case"ds-file-upload":return t("div",null,{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"},[t("p",null,{class:"text-gray-600"},e.label||"Upload File",1,null),t("p",null,{class:"text-sm text-gray-500 mt-2"},[e.accept||"*/*"," • Max ",((e.maxSize||10485760)/1024/1024).toFixed(1),"MB"],1,null)],1,null);case"heading":const l=e.level||2,s=`font-bold text-gray-900 ${l===1?"text-4xl":l===2?"text-3xl":l===3?"text-2xl":l===4?"text-xl":l===5?"text-lg":"text-base"}`;return l===1?t("h1",{class:s},null,e.text||"Heading",1,"FM_5"):l===2?t("h2",{class:s},null,e.text||"Heading",1,"FM_6"):l===3?t("h3",{class:s},null,e.text||"Heading",1,"FM_7"):l===4?t("h4",{class:s},null,e.text||"Heading",1,"FM_8"):l===5?t("h5",{class:s},null,e.text||"Heading",1,"FM_9"):t("h6",{class:s},null,e.text||"Heading",1,null);case"paragraph":return t("p",null,{class:"text-gray-700 leading-relaxed"},e.text||"Paragraph text",1,null);case"image":return t("div",null,{class:"my-6"},[t("img",{src:e.src||"/placeholder.jpg",alt:e.alt||"",class:`max-w-full h-auto ${e.className||""}`,width:e.width||"800",height:e.height||"600"},{loading:"lazy"},null,3,null),e.caption&&t("p",null,{class:"text-sm text-gray-500 mt-2 text-center"},S(e,"caption"),1,"FM_10")],1,null);case"spacer":return t("div",{style:{height:`${e.height||32}px`}},{class:"w-full"},null,3,null);case"html":return t("div",{class:e.className||"",dangerouslySetInnerHTML:_e(e.html||"")},null,null,3,null);default:return t("div",null,{class:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},[t("p",null,{class:"text-yellow-800 text-sm"},["Unknown component: ",g(a=>a.block.component_name||a.block.block_type,[n],"p0.block.component_name||p0.block.block_type")],3,null),process.env.NODE_ENV==="development"&&t("pre",null,{class:"text-xs text-yellow-600 mt-2 overflow-auto"},JSON.stringify(e,null,2),1,"FM_11")],1,null)}},I=O(y(cn,"s_hTWVJJoJphc")),dn=n=>{const l=(n.page.blocks||[]).reduce((s,a)=>{const r=a.region||"main";return s[r]||(s[r]=[]),s[r].push(a),s},{});switch(Object.keys(l).forEach(s=>{l[s].sort((a,r)=>a.order_index-r.order_index)}),n.template){case"landing":return t("div",null,{class:"min-h-screen"},[l.header&&t("header",null,{class:"bg-white shadow-sm"},t("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},l.header.map(s=>$(I,{block:s},3,s.id)),1,null),1,"FM_12"),t("main",null,{class:"flex-1"},l.main&&t("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12"},t("div",null,{class:"space-y-12"},l.main.map(s=>$(I,{block:s},3,s.id)),1,null),1,"FM_13"),1,null),l.footer&&t("footer",null,{class:"bg-gray-50 border-t"},t("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},l.footer.map(s=>$(I,{block:s},3,s.id)),1,null),1,"FM_14")],1,"FM_15");case"blog":return t("article",null,{class:"min-h-screen bg-white"},t("div",null,{class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12"},[t("header",null,{class:"mb-12"},[t("h1",null,{class:"text-4xl font-bold text-gray-900 mb-4"},g(s=>s.page.title,[n],"p0.page.title"),3,null),n.page.description&&t("p",null,{class:"text-xl text-gray-600 mb-6"},g(s=>s.page.description,[n],"p0.page.description"),3,"FM_16"),t("div",null,{class:"flex items-center text-sm text-gray-500"},[t("time",null,{dateTime:g(s=>s.page.created_at,[n],"p0.page.created_at")},new Date(n.page.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),1,null),t("span",null,{class:"mx-2"},"•",3,null),t("span",null,null,[g(s=>s.page.view_count,[n],"p0.page.view_count")," views"],3,null)],1,null)],1,null),t("div",null,{class:"prose prose-lg max-w-none"},l.main&&l.main.map(s=>$(I,{block:s},3,s.id)),1,null)],1,null),1,null);default:return t("div",null,{class:"min-h-screen bg-gray-50"},t("div",null,{class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},[t("header",null,{class:"mb-8"},[t("h1",null,{class:"text-3xl font-bold text-gray-900"},g(s=>s.page.title,[n],"p0.page.title"),3,null),n.page.description&&t("p",null,{class:"text-gray-600 mt-2"},g(s=>s.page.description,[n],"p0.page.description"),3,"FM_17")],1,null),t("div",{class:`grid gap-8 ${l.sidebar?"grid-cols-1 lg:grid-cols-3":"grid-cols-1"}`},null,[t("main",{class:l.sidebar?"lg:col-span-2":"col-span-1"},null,l.main&&t("div",null,{class:"space-y-6"},l.main.map(s=>$(I,{block:s},3,s.id)),1,"FM_18"),1,null),l.sidebar&&t("aside",null,{class:"lg:col-span-1"},t("div",null,{class:"bg-white rounded-lg shadow-sm p-6 space-y-6"},l.sidebar.map(s=>$(I,{block:s},3,s.id)),1,null),1,"FM_19")],1,null)],1,null),1,null)}},Oe=O(y(dn,"s_mzLcv8PuSf4")),gn=()=>{const n=ge();return $(ze,{value:n,onPending:()=>t("div",null,{class:"min-h-screen bg-gray-50 flex items-center justify-center"},t("div",null,{class:"text-center"},[t("svg",null,{class:"animate-spin -ml-1 mr-3 h-8 w-8 text-gray-400 mx-auto",fill:"none",viewBox:"0 0 24 24"},[t("circle",null,{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,3,null),t("path",null,{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,3,null)],3,null),t("p",null,{class:"text-gray-500 mt-2"},"Loading page...",3,null)],3,null),3,"FM_20"),onRejected:e=>t("div",null,{class:"min-h-screen bg-gray-50 flex items-center justify-center"},t("div",null,{class:"text-center"},[t("h1",null,{class:"text-2xl font-bold text-gray-900 mb-4"},"Page Not Found",3,null),t("p",null,{class:"text-gray-600 mb-6"},"The page you're looking for doesn't exist.",3,null),t("a",null,{href:"/",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},"Go Home",3,null)],3,null),3,"FM_21"),onResolved:e=>(ie(),e?$(Oe,{page:e,get template(){return e.template},[R]:{template:ae(e,"template")}},3,"FM_23"):t("div",null,{class:"min-h-screen bg-gray-50 flex items-center justify-center"},t("div",null,{class:"text-center"},[t("h1",null,{class:"text-2xl font-bold text-gray-900 mb-4"},"Page Not Found",3,null),t("p",null,{class:"text-gray-600 mb-6"},"The page you're looking for doesn't exist.",3,null),t("a",null,{href:"/",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},"Go Home",3,null)],3,null),3,"FM_22")),[R]:{value:R,onPending:R,onRejected:R,onResolved:R}},3,"FM_24")},pn=O(y(gn,"s_O9a4FXDqDuI")),mn=({resolveValue:n})=>{const e=n(ge);if(!e)return{title:"Page Not Found",meta:[{name:"description",content:"The requested page could not be found."}]};const l=[{name:"description",content:e.seo_description||e.description||`${e.title} - Learn more about this page.`},{name:"robots",content:e.published?"index, follow":"noindex, nofollow"},{property:"og:title",content:e.seo_title||e.title},{property:"og:description",content:e.seo_description||e.description||""},{property:"og:type",content:"article"},{property:"og:url",content:`/${e.slug}`},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:e.seo_title||e.title},{name:"twitter:description",content:e.seo_description||e.description||""}];return e.featured_image&&l.push({property:"og:image",content:e.featured_image}),e.social_image?(l.push({property:"og:image",content:e.social_image}),l.push({name:"twitter:image",content:e.social_image})):e.featured_image&&l.push({name:"twitter:image",content:e.featured_image}),{title:e.seo_title||e.title,meta:l}},hn=Object.freeze(Object.defineProperty({__proto__:null,_auto_ContentBlockRenderer:I,_auto_PageLayout:Oe,default:pn,head:mn,onStaticGenerate:un,usePageData:ge},Symbol.toStringTag,{value:"Module"})),fn=[We],B=()=>Je,q=()=>lt,k=()=>ct,bn=[["/",[k,()=>bt],"/",["q-BM7C_UDP.js","q-D0YHQ4UN.js"]],["manifest.json",[k,()=>xt],"/manifest.json",["q-BM7C_UDP.js"]],["api/analytics/dashboard/",[k,()=>Ct],"/api/analytics/dashboard/",["q-BM7C_UDP.js"]],["api/auth/status/",[k,()=>Pt],"/api/auth/status/",["q-BM7C_UDP.js"]],["api/cache/analytics/",[k,()=>$t],"/api/cache/analytics/",["q-BM7C_UDP.js"]],["api/content/media/",[k,()=>Qt],"/api/content/media/",["q-BM7C_UDP.js"]],["api/content/pages/",[k,()=>sl],"/api/content/pages/",["q-BM7C_UDP.js"]],["api/content/posts/",[k,()=>rl],"/api/content/posts/",["q-BM7C_UDP.js"]],["api/content/search/",[k,()=>il],"/api/content/search/",["q-BM7C_UDP.js"]],["api/dashboard/stats/",[k,()=>cl],"/api/dashboard/stats/",["q-BM7C_UDP.js"]],["api/files/list/",[k,()=>Ot],"/api/files/list/",["q-BM7C_UDP.js"]],["api/storage/signed-url/",[k,()=>gl],"/api/storage/signed-url/",["q-BM7C_UDP.js"]],["api/storage/proxy/[.path]",[k,()=>fl],"/api/storage/proxy/[.path]",["q-BM7C_UDP.js"]],["api/cache/",[k,()=>vl],"/api/cache/",["q-BM7C_UDP.js"]],["api/content/",[k,()=>_l],"/api/content/",["q-BM7C_UDP.js"]],["api/docs/",[k,()=>Cl],"/api/docs/",["q-BM7C_UDP.js","q-dJrNT4a9.js"]],["api/errors/",[k,()=>Al],"/api/errors/",["q-BM7C_UDP.js"]],["api/health/",[k,()=>Nl],"/api/health/",["q-BM7C_UDP.js"]],["api/logs/",[k,()=>Ql],"/api/logs/",["q-BM7C_UDP.js"]],["api/upload/",[k,()=>Ht],"/api/upload/",["q-BM7C_UDP.js"]],["auth/callback/",[k,()=>Xl],"/auth/callback/",["q-BM7C_UDP.js","q-Bw0Nh8OY.js"]],["dashboard/analytics/",[k,q,B,()=>as],"/dashboard/analytics/",["q-BM7C_UDP.js","q-Xy1PofCr.js","q-CihQVREz.js","q-B8twWM4u.js"]],["dashboard/components/",[k,q,B,()=>cs],"/dashboard/components/",["q-BM7C_UDP.js","q-Xy1PofCr.js","q-CihQVREz.js","q-VHghVM1a.js"]],["dashboard/media/",[k,q,B,()=>ws],"/dashboard/media/",["q-BM7C_UDP.js","q-Xy1PofCr.js","q-CihQVREz.js","q-3cjEDl2P.js"]],["dashboard/pages/",[k,q,B,()=>Rs],"/dashboard/pages/",["q-BM7C_UDP.js","q-Xy1PofCr.js","q-CihQVREz.js","q-Cbw_MhfE.js"]],["dashboard/posts/",[k,q,B,()=>Fs],"/dashboard/posts/",["q-BM7C_UDP.js","q-Xy1PofCr.js","q-CihQVREz.js","q-DglP-iIl.js"]],["dashboard/",[k,q,B,()=>qs],"/dashboard/",["q-BM7C_UDP.js","q-Xy1PofCr.js","q-CihQVREz.js","q-BS_V3Yul.js"]],["login/",[k,()=>Qs],"/login/",["q-BM7C_UDP.js","q-DhpERLpC.js"]],["api/[.404]",[k,()=>en],"/api/[.404]",["q-BM7C_UDP.js","q-DRbnYsbH.js"]],["[.catchall]",[k,()=>nn],"/[.catchall]",["q-BM7C_UDP.js","q-BdOQCAoa.js"]],["[...slug]",[k,()=>hn],"/[...slug]",["q-BM7C_UDP.js","q-BYy-4fjg.js"]]],yn=[],xn=!0,vn="/",wn=!0,Cn={routes:bn,serverPlugins:fn,menus:yn,trailingSlash:xn,basePathname:vn,cacheModules:wn};export{vn as b,wn as c,p as l,yn as m,Cn as q,bn as r,fn as s,xn as t};
