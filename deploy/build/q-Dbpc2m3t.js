import{l as e}from"./q-CnDdutek.js";import{addBreadcrumb as r,captureError as t}from"./q-BC1bz0tk.js";import"./q-Ccds0Gka.js";import"./q-DFVw1sOS.js";class o{constructor(){this.errorReports=[],this.maxReports=100,this.setupGlobalHandlers()}static getInstance(){return o.instance||(o.instance=new o),o.instance}setupGlobalHandlers(){"undefined"!=typeof window&&(window.addEventListener("error",e=>{this.handleError(e.error,{category:"system",severity:"high",metadata:{filename:e.filename,lineno:e.lineno,colno:e.colno}})}),window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(e.reason),{category:"system",severity:"high",metadata:{type:"unhandledrejection",reason:e.reason}})}),window.addEventListener("offline",()=>{this.handleError(new Error("Network offline"),{category:"network",severity:"medium",metadata:{type:"offline"}})}))}handleError(e,r){const t={error:e,context:{timestamp:new Date,route:"undefined"!=typeof window?window.location.pathname:void 0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:void 0,...r.context,metadata:{...r.context?.metadata,...r.metadata}},severity:r.severity,category:r.category};this.recordError(t),this.reportError(t),this.attemptRecovery(t)}recordError(e){if(this.errorReports.unshift(e),this.errorReports.length>this.maxReports&&(this.errorReports=this.errorReports.slice(0,this.maxReports)),"critical"===e.severity&&"undefined"!=typeof localStorage)try{const r=JSON.parse(localStorage.getItem("critical_errors")||"[]");r.unshift({message:e.error.message,stack:e.error.stack,context:e.context,timestamp:e.context.timestamp.toISOString()}),localStorage.setItem("critical_errors",JSON.stringify(r.slice(0,10)))}catch(r){}}async reportError(o){if(o.error.message.includes("Failed to report error")||o.error.message.includes("fetch")||o.error.message.includes("SyntaxError: Invalid or unexpected token")||o.context.metadata?.isErrorReportingError)return;r(`${o.category.toUpperCase()} Error occurred`,"error",{severity:o.severity,route:o.context.route,userId:o.context.userId,...o.context.metadata});const a=t(o.error,{category:o.category,severity:o.severity,component:"error-handler",...o.context.metadata}),n="critical"===o.severity?"critical":"high"===o.severity?"error":"medium"===o.severity?"warn":"info";e.log(n,`${o.category.toUpperCase()} Error: ${o.error.message}`,{category:o.category,severity:o.severity,userId:o.context.userId,sessionId:o.context.sessionId,route:o.context.route,sentryEventId:a,...o.context.metadata},o.error);try{"undefined"!=typeof fetch&&await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o.error.message,stack:o.error.stack,context:o.context,severity:o.severity,category:o.category,sentryEventId:a})})}catch(s){e.error("Failed to report error to API",{originalError:o.error.message},s instanceof Error?s:new Error(String(s)))}}attemptRecovery(e){switch(e.category){case"network":e.context.metadata?.retryable&&setTimeout(()=>{"undefined"!=typeof window&&navigator.onLine&&window.location.reload()},5e3);break;case"data":"undefined"!=typeof localStorage&&(localStorage.removeItem("app_cache"),localStorage.removeItem("user_data"));break;case"ui":"critical"===e.severity&&setTimeout(()=>{"undefined"!=typeof window&&(window.location.href="/")},3e3)}}getRecentErrors(e=10){return this.errorReports.slice(0,e)}clearErrors(){this.errorReports=[],"undefined"!=typeof localStorage&&localStorage.removeItem("critical_errors")}static handleUIError(e,r){o.getInstance().handleError(e,{category:"ui",severity:"medium",context:r})}static handleAPIError(e,r){o.getInstance().handleError(e,{category:"api",severity:"high",context:r})}static handleAuthError(e,r){o.getInstance().handleError(e,{category:"auth",severity:"high",context:r})}static handleDataError(e,r){o.getInstance().handleError(e,{category:"data",severity:"high",context:r})}static handleCriticalError(e,r){o.getInstance().handleError(e,{category:"system",severity:"critical",context:r})}}const a=o.getInstance(),{handleUIError:n,handleAPIError:s,handleAuthError:i,handleDataError:c,handleCriticalError:d}=o;export{o as GlobalErrorHandler,a as errorHandler,s as handleAPIError,i as handleAuthError,d as handleCriticalError,c as handleDataError,n as handleUIError};
