import{addBreadcrumb as e,captureError as r}from"./q-CLlqVEZn.js";const t=new class{constructor(e={}){this.logQueue=[],this.flushInterval=5e3,this.maxQueueSize=100,this.config={level:"info",service:"qwik-lit-builder",version:"1.0.0",environment:"development",enableConsole:!0,enableRemote:!1,...e},this.startFlushTimer()}levelToNumber(e){return{debug:0,info:1,warn:2,error:3,critical:4}[e]}shouldLog(e){return this.levelToNumber(e)>=this.levelToNumber(this.config.level)}get configuration(){return this.config}createLogEntry(e,r,t,o){const n={timestamp:(new Date).toISOString(),level:e,message:r,context:{service:this.config.service,version:this.config.version,environment:this.config.environment,...t}};return"undefined"!=typeof window&&(n.route=window.location.pathname,n.userAgent=navigator.userAgent),o&&(n.stack=o.stack,n.context={...n.context,errorName:o.name,errorMessage:o.message}),n}logToConsole(e){if(!this.config.enableConsole)return;"critical"===e.level||"error"===e.level||e.level,e.timestamp,e.level.toUpperCase();this.config.environment}queueForRemote(e){this.config.enableRemote&&(this.logQueue.push(e),"critical"!==e.level?this.logQueue.length>=this.maxQueueSize&&this.flushLogs():this.flushLogs())}startFlushTimer(){"undefined"!=typeof window&&(this.flushTimer=window.setInterval(()=>{this.flushLogs()},this.flushInterval))}async flushLogs(){if(0===this.logQueue.length)return;const e=[...this.logQueue];this.logQueue=[];try{this.config.remoteEndpoint&&"undefined"!=typeof fetch&&await fetch(this.config.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:e})})}catch(r){this.logQueue.length<this.maxQueueSize&&this.logQueue.unshift(...e.slice(0,this.maxQueueSize-this.logQueue.length))}}log(e,r,t,o){if(!this.shouldLog(e))return;const n=this.createLogEntry(e,r,t,o);this.logToConsole(n),this.queueForRemote(n)}debug(e,r){this.log("debug",e,r)}info(e,r){this.log("info",e,r)}warn(e,r){this.log("warn",e,r)}error(e,r,t){this.log("error",e,r,t)}critical(e,r,t){this.log("critical",e,r,t)}apiCall(e,r,t,o,n){this.info(`API ${e} ${r}`,{...n,method:e,url:r,statusCode:t,duration:o,type:"api_call"})}userAction(e,r,t){this.info(`User action: ${e}`,{...t,userId:r,action:e,type:"user_action"})}performance(e,r,t){this.info(`Performance: ${e}`,{...t,metric:e,value:r,type:"performance"})}security(e,r,t){const o="critical"===r?"critical":"high"===r?"error":"medium"===r?"warn":"info";this.log(o,`Security event: ${e}`,{...t,event:e,severity:r,type:"security"})}destroy(){this.flushTimer&&clearInterval(this.flushTimer),this.flushLogs()}}({level:"debug",environment:"development",enableRemote:!1,remoteEndpoint:"/api/logs"});"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{t.destroy()});const o=Object.freeze(Object.defineProperty({__proto__:null,logger:t},Symbol.toStringTag,{value:"Module"}));class n{constructor(){this.errorReports=[],this.maxReports=100,this.setupGlobalHandlers()}static getInstance(){return n.instance||(n.instance=new n),n.instance}setupGlobalHandlers(){"undefined"!=typeof window&&(window.addEventListener("error",e=>{this.handleError(e.error,{category:"system",severity:"high",metadata:{filename:e.filename,lineno:e.lineno,colno:e.colno}})}),window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(e.reason),{category:"system",severity:"high",metadata:{type:"unhandledrejection",reason:e.reason}})}),window.addEventListener("offline",()=>{this.handleError(new Error("Network offline"),{category:"network",severity:"medium",metadata:{type:"offline"}})}))}handleError(e,r){const t={error:e,context:{timestamp:new Date,route:"undefined"!=typeof window?window.location.pathname:void 0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:void 0,...r.context,metadata:{...r.context?.metadata,...r.metadata}},severity:r.severity,category:r.category};this.recordError(t),this.reportError(t),this.attemptRecovery(t)}recordError(e){if(this.errorReports.unshift(e),this.errorReports.length>this.maxReports&&(this.errorReports=this.errorReports.slice(0,this.maxReports)),"critical"===e.severity&&"undefined"!=typeof localStorage)try{const r=JSON.parse(localStorage.getItem("critical_errors")||"[]");r.unshift({message:e.error.message,stack:e.error.stack,context:e.context,timestamp:e.context.timestamp.toISOString()}),localStorage.setItem("critical_errors",JSON.stringify(r.slice(0,10)))}catch(r){}}async reportError(o){if(o.error.message.includes("Failed to report error")||o.error.message.includes("fetch")||o.error.message.includes("SyntaxError: Invalid or unexpected token")||o.context.metadata?.isErrorReportingError)return;e(`${o.category.toUpperCase()} Error occurred`,"error",{severity:o.severity,route:o.context.route,userId:o.context.userId,...o.context.metadata});const n=r(o.error,{category:o.category,severity:o.severity,component:"error-handler",...o.context.metadata}),i="critical"===o.severity?"critical":"high"===o.severity?"error":"medium"===o.severity?"warn":"info";t.log(i,`${o.category.toUpperCase()} Error: ${o.error.message}`,{category:o.category,severity:o.severity,userId:o.context.userId,sessionId:o.context.sessionId,route:o.context.route,sentryEventId:n,...o.context.metadata},o.error);try{"undefined"!=typeof fetch&&await fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o.error.message,stack:o.error.stack,context:o.context,severity:o.severity,category:o.category,sentryEventId:n})})}catch(a){t.error("Failed to report error to API",{originalError:o.error.message},a instanceof Error?a:new Error(String(a)))}}attemptRecovery(e){switch(e.category){case"network":e.context.metadata?.retryable&&setTimeout(()=>{"undefined"!=typeof window&&navigator.onLine&&window.location.reload()},5e3);break;case"data":"undefined"!=typeof localStorage&&(localStorage.removeItem("app_cache"),localStorage.removeItem("user_data"));break;case"ui":"critical"===e.severity&&setTimeout(()=>{"undefined"!=typeof window&&(window.location.href="/")},3e3)}}getRecentErrors(e=10){return this.errorReports.slice(0,e)}clearErrors(){this.errorReports=[],"undefined"!=typeof localStorage&&localStorage.removeItem("critical_errors")}static handleUIError(e,r){n.getInstance().handleError(e,{category:"ui",severity:"medium",context:r})}static handleAPIError(e,r){n.getInstance().handleError(e,{category:"api",severity:"high",context:r})}static handleAuthError(e,r){n.getInstance().handleError(e,{category:"auth",severity:"high",context:r})}static handleDataError(e,r){n.getInstance().handleError(e,{category:"data",severity:"high",context:r})}static handleCriticalError(e,r){n.getInstance().handleError(e,{category:"system",severity:"critical",context:r})}}const i=n.getInstance(),{handleUIError:a,handleAPIError:s,handleAuthError:c,handleDataError:l,handleCriticalError:h}=n,d=Object.freeze(Object.defineProperty({__proto__:null,GlobalErrorHandler:n,errorHandler:i,handleAPIError:s,handleAuthError:c,handleCriticalError:h,handleDataError:l,handleUIError:a},Symbol.toStringTag,{value:"Module"}));export{o as a,d as e,t as l};
