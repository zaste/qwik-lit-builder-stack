<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Testing - LIT Components</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .test-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            background: #f9fafb;
        }
        .test-result {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: #d1f2eb; color: #0d5d3a; }
        .error { background: #fadbd8; color: #a93226; }
        .warning { background: #fcf3cf; color: #7d6608; }
        .info { background: #d6eaf8; color: #1b4f72; }
        h2 { color: #2563eb; }
        h3 { color: #059669; }
    </style>
</head>
<body>
    <h1>üß™ Comprehensive Integration Testing</h1>
    <p>Testing all implemented systems from Day 1-4 with real functionality</p>

    <div class="test-section">
        <h2>üìä Test Results Log</h2>
        <div id="test-log"></div>
    </div>

    <div class="test-section">
        <h2>üß© LIT Components Test</h2>
        <h3>DS-Button Component</h3>
        <ds-button 
            id="test-button"
            text="Test Button" 
            variant="primary" 
            size="medium"
            icon="check"
            icon-position="right">
        </ds-button>
        
        <h3>DS-Input Component</h3>
        <ds-input 
            id="test-input"
            label="Test Input Field"
            placeholder="Type something..."
            type="text"
            variant="default"
            size="medium"
            required="true">
        </ds-input>

        <h3>DS-Card Component</h3>
        <ds-card 
            id="test-card"
            variant="elevated"
            padding="medium"
            shadow="medium"
            header="Test Card"
            footer="Card Footer">
            <p>This is the card content area for testing purposes.</p>
        </ds-card>

        <h3>DS-File-Upload Component</h3>
        <ds-file-upload 
            id="test-upload"
            multiple="false"
            accept="image/*,.pdf"
            max-file-size="5"
            upload-text="Drag & drop files for testing"
            show-progress="true">
        </ds-file-upload>
    </div>

    <div class="test-section">
        <h2>üîÑ Advanced Workflow Components Test</h2>
        <h3>Multi-Step Form</h3>
        <ds-multi-step-form 
            id="test-form"
            title="Test Multi-Step Form"
            show-progress="true"
            allow-navigation="true">
        </ds-multi-step-form>

        <h3>File Gallery</h3>
        <ds-file-gallery 
            id="test-gallery"
            filter-type="all"
            sort-by="date"
            layout="grid">
        </ds-file-gallery>
    </div>

    <div class="test-section">
        <h2>üé® Style System Test</h2>
        <button onclick="testThemeSwitch()">Test Theme Switch</button>
        <div id="theme-status">Current theme: Default</div>
    </div>

    <div class="test-section">
        <h2>‚ö° Cache System Test</h2>
        <button onclick="testCacheOperations()">Test Cache Operations</button>
        <div id="cache-results"></div>
    </div>

    <div class="test-section">
        <h2>üîç Validation System Test</h2>
        <button onclick="testValidation()">Test Component Validation</button>
        <div id="validation-results"></div>
    </div>

    <!-- Import the LIT components -->
    <script type="module">
        let testResults = [];

        function logTest(name, status, message) {
            const result = { name, status, message, timestamp: new Date().toISOString() };
            testResults.push(result);
            updateTestLog();
        }

        function updateTestLog() {
            const log = document.getElementById('test-log');
            log.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.status}">
                    [${result.timestamp.split('T')[1].split('.')[0]}] ${result.name}: ${result.message}
                </div>`
            ).join('');
        }

        // Test LIT Components Loading
        function testComponentsLoading() {
            logTest('Components Loading', 'info', 'Starting component loading tests...');
            
            // Test if custom elements are defined
            const components = ['ds-button', 'ds-input', 'ds-card', 'ds-file-upload', 'ds-multi-step-form', 'ds-file-gallery'];
            
            components.forEach(componentName => {
                if (customElements.get(componentName)) {
                    logTest(`${componentName}`, 'success', 'Component registered successfully');
                } else {
                    logTest(`${componentName}`, 'error', 'Component NOT registered');
                }
            });
        }

        // Test Component Interactions
        function testComponentInteractions() {
            logTest('Component Interactions', 'info', 'Testing component interactions...');
            
            // Test button click
            const button = document.getElementById('test-button');
            if (button) {
                button.addEventListener('ds-click', (e) => {
                    logTest('Button Click', 'success', `Button clicked with data: ${JSON.stringify(e.detail)}`);
                });
                // Simulate click
                button.click();
            } else {
                logTest('Button Click', 'error', 'Button element not found');
            }

            // Test input changes
            const input = document.getElementById('test-input');
            if (input) {
                input.addEventListener('ds-input', (e) => {
                    logTest('Input Change', 'success', `Input changed: ${e.detail.value}`);
                });
                // Simulate input
                if (input.shadowRoot) {
                    const inputElement = input.shadowRoot.querySelector('input');
                    if (inputElement) {
                        inputElement.value = 'Test value';
                        inputElement.dispatchEvent(new Event('input'));
                    }
                }
            } else {
                logTest('Input Change', 'error', 'Input element not found');
            }

            // Test card interactions
            const card = document.getElementById('test-card');
            if (card) {
                card.addEventListener('ds-card-click', (e) => {
                    logTest('Card Click', 'success', `Card clicked: ${JSON.stringify(e.detail)}`);
                });
            }
        }

        // Theme testing
        window.testThemeSwitch = async function() {
            logTest('Theme Switch', 'info', 'Testing theme switching...');
            
            try {
                // Test if theme manager is available
                if (window.themeManager) {
                    const themes = window.themeManager.getThemes();
                    logTest('Theme Manager', 'success', `Found ${themes.length} themes`);
                    
                    // Test switching themes
                    for (const theme of themes) {
                        window.themeManager.setTheme(theme.name);
                        logTest('Theme Switch', 'success', `Switched to ${theme.name} theme`);
                        document.getElementById('theme-status').textContent = `Current theme: ${theme.name}`;
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                } else {
                    logTest('Theme Manager', 'error', 'Theme manager not available');
                }
            } catch (error) {
                logTest('Theme Switch', 'error', `Theme switching failed: ${error.message}`);
            }
        };

        // Cache testing
        window.testCacheOperations = async function() {
            logTest('Cache Operations', 'info', 'Testing cache system...');
            
            try {
                // Test cache analytics API
                const response = await fetch('/api/cache/analytics?action=metrics&window=60');
                if (response.ok) {
                    const data = await response.json();
                    logTest('Cache API', 'success', `Cache metrics retrieved: ${data.success}`);
                    document.getElementById('cache-results').innerHTML = `
                        <pre>${JSON.stringify(data.data.metrics, null, 2)}</pre>
                    `;
                } else {
                    logTest('Cache API', 'error', `Cache API failed: ${response.status}`);
                }

                // Test cache export
                const exportResponse = await fetch('/api/cache/analytics?action=export&window=30');
                if (exportResponse.ok) {
                    const exportData = await exportResponse.json();
                    logTest('Cache Export', 'success', `Cache export successful: ${exportData.success}`);
                } else {
                    logTest('Cache Export', 'error', `Cache export failed: ${exportResponse.status}`);
                }

            } catch (error) {
                logTest('Cache Operations', 'error', `Cache testing failed: ${error.message}`);
            }
        };

        // Validation testing
        window.testValidation = function() {
            logTest('Validation System', 'info', 'Testing validation system...');
            
            try {
                // Test if validation manager is available
                if (window.simpleValidationManager) {
                    // Test input validation
                    const result = window.simpleValidationManager.validateProperty('ds-input', 'label', '');
                    if (!result.isValid) {
                        logTest('Input Validation', 'success', `Validation working: ${result.message}`);
                    } else {
                        logTest('Input Validation', 'warning', 'Validation passed for empty label');
                    }

                    // Test button validation
                    const buttonResult = window.simpleValidationManager.validateProperty('ds-button', 'text', 'Valid button text');
                    if (buttonResult.isValid) {
                        logTest('Button Validation', 'success', 'Button validation passed');
                    } else {
                        logTest('Button Validation', 'error', `Button validation failed: ${buttonResult.message}`);
                    }

                    document.getElementById('validation-results').innerHTML = `
                        <div>Input validation result: ${JSON.stringify(result)}</div>
                        <div>Button validation result: ${JSON.stringify(buttonResult)}</div>
                    `;
                } else {
                    logTest('Validation Manager', 'error', 'Validation manager not available');
                }
            } catch (error) {
                logTest('Validation System', 'error', `Validation testing failed: ${error.message}`);
            }
        };

        // Start testing when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            logTest('DOM Ready', 'info', 'Starting comprehensive integration tests...');
            
            // Wait a bit for components to register
            setTimeout(() => {
                testComponentsLoading();
                testComponentInteractions();
            }, 1000);
        });

        // Test component loading after a delay
        setTimeout(() => {
            logTest('Late Component Check', 'info', 'Checking component registration after delay...');
            testComponentsLoading();
        }, 3000);

    </script>

    <!-- Try to load the actual LIT components -->
    <script type="module">
        try {
            // Import LIT components
            await import('./src/design-system/components/ds-button.js');
            logTest('DS-Button Import', 'success', 'ds-button.js imported successfully');
        } catch (error) {
            logTest('DS-Button Import', 'error', `Failed to import ds-button: ${error.message}`);
        }

        try {
            await import('./src/design-system/components/ds-input.js');
            logTest('DS-Input Import', 'success', 'ds-input.js imported successfully');
        } catch (error) {
            logTest('DS-Input Import', 'error', `Failed to import ds-input: ${error.message}`);
        }

        try {
            await import('./src/design-system/components/ds-card.js');
            logTest('DS-Card Import', 'success', 'ds-card.js imported successfully');
        } catch (error) {
            logTest('DS-Card Import', 'error', `Failed to import ds-card: ${error.message}`);
        }

        try {
            await import('./src/design-system/components/ds-file-upload.js');
            logTest('DS-File-Upload Import', 'success', 'ds-file-upload.js imported successfully');
        } catch (error) {
            logTest('DS-File-Upload Import', 'error', `Failed to import ds-file-upload: ${error.message}`);
        }

        try {
            await import('./src/design-system/workflows/multi-step-form.js');
            logTest('Multi-Step Form Import', 'success', 'multi-step-form.js imported successfully');
        } catch (error) {
            logTest('Multi-Step Form Import', 'error', `Failed to import multi-step-form: ${error.message}`);
        }

        try {
            await import('./src/design-system/workflows/file-gallery.js');
            logTest('File Gallery Import', 'success', 'file-gallery.js imported successfully');
        } catch (error) {
            logTest('File Gallery Import', 'error', `Failed to import file-gallery: ${error.message}`);
        }

        try {
            await import('./src/design-system/style-system.js');
            logTest('Style System Import', 'success', 'style-system.js imported successfully');
        } catch (error) {
            logTest('Style System Import', 'error', `Failed to import style-system: ${error.message}`);
        }

        try {
            await import('./src/design-system/builder-validation-simple.js');
            logTest('Validation System Import', 'success', 'builder-validation-simple.js imported successfully');
        } catch (error) {
            logTest('Validation System Import', 'error', `Failed to import validation system: ${error.message}`);
        }
    </script>
</body>
</html>